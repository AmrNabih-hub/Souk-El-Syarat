# ğŸ“‹ **Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…ÙØµÙ„ - Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª**
## **Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ**

---

## ğŸ¯ **Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…**

ØªÙ… ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠØ¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù†ÙØ±Ø¯ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù….

---

## ğŸ—ï¸ **Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠ Ù„Ù„Ù†Ø¸Ø§Ù…**

### **1. Ø·Ø¨Ù‚Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data Layer)**
```
Firebase Services:
â”œâ”€â”€ Firestore Database (Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)
â”œâ”€â”€ Realtime Database (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©)
â”œâ”€â”€ Authentication (Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©)
â”œâ”€â”€ Cloud Storage (ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª)
â”œâ”€â”€ Cloud Functions (Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©)
â””â”€â”€ Analytics (ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
```

### **2. Ø·Ø¨Ù‚Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© (State Management)**
```
Store Architecture:
â”œâ”€â”€ authStore.ts (Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©)
â”œâ”€â”€ appStore.ts (Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø§Ù…Ø©)
â”œâ”€â”€ realtimeStore.ts (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©)
â””â”€â”€ Store Integration (Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø®Ø§Ø²Ù†)
```

### **3. Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª (Services Layer)**
```
Services:
â”œâ”€â”€ Authentication Services
â”œâ”€â”€ Real-time Services
â”œâ”€â”€ Notification Services
â”œâ”€â”€ Order Management
â”œâ”€â”€ Product Management
â”œâ”€â”€ Analytics Services
â””â”€â”€ Error Handling
```

---

## ğŸ“Š **Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase**

### **ğŸ” Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†**
```javascript
// users/{userId}
{
  id: string,
  email: string,
  displayName: string,
  role: 'customer' | 'vendor' | 'admin',
  isActive: boolean,
  emailVerified: boolean,
  phoneNumber?: string,
  photoURL?: string,
  createdAt: Date,
  updatedAt: Date,
  lastLoginAt?: Date,
  preferences: {
    language: 'ar' | 'en',
    currency: 'EGP' | 'USD',
    notifications: {
      email: boolean,
      sms: boolean,
      push: boolean
    }
  },
  address?: {
    street: string,
    city: string,
    governorate: string,
    postalCode?: string,
    country: string,
    coordinates?: { lat: number, lng: number }
  }
}
```

### **ğŸ›’ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø´Ø®ØµÙŠØ©**
```javascript
// user_carts/{userId}
{
  userId: string,
  items: [
    {
      productId: string,
      name: string,
      price: number,
      image: string,
      quantity: number,
      category?: string,
      selectedOptions?: Record<string, string>,
      addedAt: Date
    }
  ],
  updatedAt: Date
}

// user_favorites/{userId}
{
  userId: string,
  favorites: string[], // Array of product IDs
  updatedAt: Date
}
```

### **ğŸ“¦ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª**
```javascript
// orders/{orderId}
{
  id: string,
  customerId: string,
  vendorId: string,
  items: OrderItem[],
  status: 'pending' | 'confirmed' | 'processing' | 'shipped' | 'delivered' | 'cancelled',
  paymentStatus: 'pending' | 'completed' | 'failed' | 'refunded',
  paymentMethod: 'cash_on_delivery' | 'bank_transfer' | 'credit_card',
  totalAmount: number,
  shippingAddress: Address,
  trackingNumber?: string,
  realTimeStatus: string,
  estimatedDelivery?: Date,
  trackingUpdates: [
    {
      status: string,
      timestamp: Date,
      location?: string,
      description: string
    }
  ],
  createdAt: Date,
  updatedAt: Date
}
```

### **ğŸ›ï¸ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª**
```javascript
// products/{productId}
{
  id: string,
  vendorId: string,
  title: string,
  description: string,
  category: ProductCategory,
  subcategory: string,
  price: number,
  originalPrice?: number,
  quantity: number,
  condition: 'new' | 'used' | 'refurbished',
  status: 'draft' | 'published' | 'sold' | 'inactive',
  isActive: boolean,
  images: [
    {
      id: string,
      url: string,
      alt: string,
      isPrimary: boolean,
      order: number
    }
  ],
  specifications: [
    {
      name: string,
      value: string,
      category: string
    }
  ],
  features: string[],
  tags: string[],
  viewCount: number,
  favoriteCount: number,
  isLive: boolean,
  createdAt: Date,
  updatedAt: Date
}
```

### **ğŸ”” Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª**
```javascript
// notifications/{notificationId}
{
  id: string,
  userId: string,
  type: 'order' | 'booking' | 'payment' | 'general' | 'promotion',
  title: string,
  titleEn?: string,
  message: string,
  messageEn?: string,
  icon: string,
  isRead: boolean,
  priority: 'low' | 'medium' | 'high' | 'urgent',
  category: 'order' | 'product' | 'message' | 'system' | 'promotion',
  actionUrl?: string,
  metadata?: {
    orderId?: string,
    bookingId?: string,
    amount?: number,
    itemName?: string,
    [key: string]: any
  },
  timestamp: Date,
  createdAt: Date,
  expiresAt?: Date
}
```

### **ğŸ‘¥ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ù†Ø´Ø§Ø·**
```javascript
// user_presence/{userId}
{
  userId: string,
  status: 'online' | 'offline' | 'away',
  lastSeen: Date,
  currentPage?: string,
  isTyping?: boolean
}

// activity_feed/{activityId}
{
  id: string,
  type: 'order' | 'product' | 'user' | 'system',
  userId: string,
  userName: string,
  action: string,
  timestamp: Date,
  metadata?: Record<string, any>
}
```

### **ğŸ“Š Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©**
```javascript
// analytics/live
{
  activeUsers: number,
  todayOrders: number,
  todayRevenue: number,
  popularProducts: string[],
  recentActivities: [
    {
      type: string,
      userId: string,
      timestamp: Date,
      description: string
    }
  ],
  updatedAt: Date
}
```

---

## ğŸ”„ **Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ**

### **1. AppStore - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù…ÙØ¶Ù„Ø©**
```typescript
// src/stores/appStore.ts
interface AppStore {
  // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  cartItems: CartItem[];
  favorites: string[];
  
  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
  isOnline: boolean;
  syncStatus: 'idle' | 'syncing' | 'synced' | 'error';
  lastSyncTime: Date | null;
  
  // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø©
  addToCart: (item: CartItem) => Promise<void>;
  removeFromCart: (productId: string) => Promise<void>;
  updateCartItemQuantity: (productId: string, quantity: number) => Promise<void>;
  addToFavorites: (productId: string) => Promise<void>;
  removeFromFavorites: (productId: string) => Promise<void>;
  
  // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
  initializeRealtimeSync: (userId: string) => Promise<void>;
  disconnectRealtimeSync: () => void;
  forceSyncToFirebase: () => Promise<void>;
}
```

### **2. RealtimeStore - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©**
```typescript
// src/stores/realtimeStore.ts
interface RealtimeStore {
  // Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ§Ù„ØªÙ‡ÙŠØ¦Ø©
  isConnected: boolean;
  isInitialized: boolean;
  connectionError: string | null;
  
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±
  currentUserPresence: UserPresence | null;
  onlineUsers: Record<string, UserPresence>;
  totalOnlineUsers: number;
  
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
  notifications: LiveNotification[];
  unreadNotifications: number;
  notificationSettings: NotificationSettings;
  
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
  userOrders: LiveOrder[];
  vendorOrders: LiveOrder[];
  orderUpdates: Record<string, LiveOrder>;
  activeOrderTracking: Record<string, boolean>;
  
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
  featuredProducts: LiveProduct[];
  userViewedProducts: LiveProduct[];
  productUpdates: Record<string, LiveProduct>;
  inventoryAlerts: InventoryAlert[];
  
  // Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
  liveAnalytics: LiveAnalytics | null;
  vendorMetrics: VendorMetrics;
  
  // ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø´Ø§Ø·
  activityFeed: ActivityItem[];
  
  // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡
  lastSyncTimes: Record<string, Date>;
  syncErrors: Record<string, string>;
}
```

### **3. AuthStore - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©**
```typescript
// src/stores/authStore.ts
interface AuthStore {
  // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  user: User | null;
  isLoading: boolean;
  error: string | null;
  authChecked: boolean;
  isInitialized: boolean;
  
  // Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø©
  signIn: (email: string, password: string) => Promise<void>;
  signUp: (email: string, password: string, displayName: string) => Promise<void>;
  signInWithGoogle: () => Promise<void>;
  signOut: () => Promise<void>;
  
  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
  initializeAuth: () => void;
}
```

---

## ğŸ› ï¸ **Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©**

### **1. Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©**
```typescript
// src/services/auth.service.ts
class AuthService {
  static async signIn(email: string, password: string): Promise<User>
  static async signUp(email: string, password: string, displayName: string): Promise<User>
  static async signInWithGoogle(): Promise<User>
  static async signOut(): Promise<void>
  static async resetPassword(email: string): Promise<void>
  static async updateProfile(userId: string, updates: Partial<User>): Promise<User>
  static onAuthStateChange(callback: (user: User | null) => void): Unsubscribe
}
```

### **2. Ø®Ø¯Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©**
```typescript
// src/services/realtime.service.ts
class RealtimeService {
  static getInstance(): RealtimeService
  
  // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¶ÙˆØ±
  async updateUserPresence(userId: string, presence: UserPresence): Promise<void>
  listenToUserPresence(userId: string, callback: Function): Unsubscribe
  
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  async sendMessage(chatId: string, message: ChatMessage): Promise<void>
  listenToMessages(chatId: string, callback: Function): Unsubscribe
  async markChatAsRead(chatId: string): Promise<void>
  
  // ØªØªØ¨Ø¹ Ø§Ù„Ù†Ø´Ø§Ø·
  async trackActivity(userId: string, activity: UserActivity): Promise<void>
  listenToActivityFeed(callback: Function): Unsubscribe
}
```

### **3. Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª**
```typescript
// src/services/notification.service.ts
class NotificationService {
  static getInstance(): NotificationService
  
  async sendNotification(notification: Notification): Promise<string>
  async markAsRead(notificationId: string): Promise<void>
  async markAllAsRead(userId: string): Promise<void>
  async updateNotificationPreferences(preferences: NotificationPreferences): Promise<void>
  subscribeToUserNotifications(userId: string, callback: Function): Unsubscribe
}
```

---

## ğŸ”§ **Ø¢Ù„ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©**

### **1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…**
```mermaid
sequenceDiagram
    participant User
    participant AuthStore
    participant AppStore
    participant RealtimeStore
    participant Firebase
    
    User->>AuthStore: signIn(email, password)
    AuthStore->>Firebase: authenticate
    Firebase-->>AuthStore: user data
    AuthStore->>AppStore: initializeRealtimeSync(userId)
    AuthStore->>RealtimeStore: initializeRealtimeServices(userId, role)
    AppStore->>Firebase: setup cart/favorites listeners
    RealtimeStore->>Firebase: setup all real-time listeners
    Firebase-->>User: fully synchronized system
```

### **2. Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©**
```mermaid
sequenceDiagram
    participant User
    participant UI
    participant AppStore
    participant Firebase
    participant OtherDevices
    
    User->>UI: click "Add to Cart"
    UI->>AppStore: addToCart(item)
    AppStore->>UI: optimistic update (immediate)
    AppStore->>Firebase: sync to cloud
    Firebase-->>OtherDevices: real-time update
    Firebase-->>AppStore: confirmation
    AppStore->>UI: sync status update
```

### **3. Ø¥Ø´Ø¹Ø§Ø± ÙÙˆØ±ÙŠ**
```mermaid
sequenceDiagram
    participant System
    participant NotificationService
    participant Firebase
    participant RealtimeStore
    participant UI
    participant User
    
    System->>NotificationService: sendNotification()
    NotificationService->>Firebase: store notification
    Firebase-->>RealtimeStore: real-time listener
    RealtimeStore->>UI: update notifications
    UI->>User: show notification
```

---

## ğŸ“± **ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø³Ù†Ø©**

### **1. Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©**
```typescript
// src/components/ui/SyncStatusIndicator.tsx
const SyncStatusIndicator: React.FC = () => {
  const { syncStatus, isOnline, lastSyncTime } = useAppStore();
  
  const getStatusConfig = () => {
    switch (syncStatus) {
      case 'syncing': return { icon: CloudArrowUpIcon, color: 'text-blue-500', label: 'ÙŠØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...' };
      case 'synced': return { icon: CloudIcon, color: 'text-green-500', label: 'Ù…ØªØ²Ø§Ù…Ù†' };
      case 'error': return { icon: ExclamationTriangleIcon, color: 'text-red-500', label: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©' };
      default: return { icon: WifiIcon, color: 'text-gray-500', label: 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' };
    }
  };
  
  // UI implementation with animations
};
```

### **2. Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø­Ø³Ù†**
```typescript
// src/components/layout/Navbar.tsx
const Navbar: React.FC = () => {
  const { user, signOut } = useAuthStore();
  const { getCartItemsCount, favorites, syncStatus, isOnline } = useAppStore();
  
  const getUserProfileInfo = () => {
    switch (user?.role) {
      case 'admin': return { icon: ShieldCheckIcon, color: 'text-red-600', dashboardPath: '/admin/dashboard' };
      case 'vendor': return { icon: BuildingStorefrontIcon, color: 'text-blue-600', dashboardPath: '/vendor/dashboard' };
      case 'customer': return { icon: UserCircleIcon, color: 'text-green-600', dashboardPath: '/dashboard' };
    }
  };
  
  // Enhanced UI with role-based styling and sync status
};
```

---

## ğŸ”’ **Ø£Ù…Ø§Ù† ÙˆÙ‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**

### **Ù‚ÙˆØ§Ø¹Ø¯ Firestore Ø§Ù„Ø£Ù…Ù†ÙŠØ©**
```javascript
// firestore.rules
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - Protected user data
    match /users/{userId} {
      allow read: if request.auth != null && (request.auth.uid == userId || isAdmin());
      allow create: if request.auth != null && request.auth.uid == userId;
      allow update: if request.auth != null && (request.auth.uid == userId || isAdmin());
      allow delete: if isAdmin();
    }
    
    // User carts - Personal data
    match /user_carts/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // User favorites - Personal data
    match /user_favorites/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Products - Public read, vendor/admin write
    match /products/{productId} {
      allow read: if true;
      allow create, update: if request.auth != null && (isVendor() || isAdmin());
      allow delete: if isAdmin();
    }
    
    // Orders - Role-based access
    match /orders/{orderId} {
      allow read: if request.auth != null && (
        resource.data.customerId == request.auth.uid ||
        resource.data.vendorId == request.auth.uid ||
        isAdmin()
      );
      allow create: if request.auth != null;
      allow update: if request.auth != null && (
        resource.data.vendorId == request.auth.uid ||
        isAdmin()
      );
    }
    
    // Notifications - User-specific
    match /notifications/{notificationId} {
      allow read, write: if request.auth != null && resource.data.userId == request.auth.uid;
    }
    
    // Analytics - Admin only
    match /analytics/{document=**} {
      allow read, write: if isAdmin();
    }
    
    // Helper functions
    function isAdmin() {
      return request.auth != null && 
             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    function isVendor() {
      return request.auth != null && 
             exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'vendor';
    }
  }
}
```

---

## âš¡ **ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡**

### **1. Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…ØªÙØ§Ø¦Ù„Ø© (Optimistic Updates)**
```typescript
const addToCart = async (newItem: CartItem) => {
  // 1. ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
  const updatedItems = [...cartItems, newItem];
  set({ cartItems: updatedItems, syncStatus: 'syncing' });
  
  // 2. Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
  try {
    await setDoc(doc(db, COLLECTIONS.USER_CARTS, userId), {
      items: updatedItems,
      updatedAt: new Date(),
      userId
    }, { merge: true });
    set({ syncStatus: 'synced', lastSyncTime: new Date() });
  } catch (error) {
    // 3. Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
    set({ cartItems, syncStatus: 'error' });
    toast.error('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬');
  }
};
```

### **2. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ø°ÙƒÙŠØ©**
```typescript
const listeners = new Map<string, Unsubscribe>();

// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù…Ø¹ ØªØªØ¨Ø¹
const addListener = (key: string, unsubscribe: Unsubscribe) => {
  if (listeners.has(key)) {
    listeners.get(key)!(); // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚
  }
  listeners.set(key, unsubscribe);
};

// ØªÙ†Ø¸ÙŠÙ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
const cleanup = () => {
  listeners.forEach((unsubscribe) => unsubscribe());
  listeners.clear();
};
```

### **3. Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø°ÙƒÙŠ**
```typescript
const cache = new Map<string, { data: any; timestamp: number; ttl: number }>();

const getCachedData = (key: string) => {
  const cached = cache.get(key);
  if (cached && Date.now() - cached.timestamp < cached.ttl) {
    return cached.data;
  }
  cache.delete(key);
  return null;
};

const setCachedData = (key: string, data: any, ttl: number = 5 * 60 * 1000) => {
  cache.set(key, { data, timestamp: Date.now(), ttl });
};
```

---

## ğŸ§ª **Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…**

### **1. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ø¨Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©**
```bash
# Device 1: Login and add items
curl -X POST "https://souk-el-syarat.web.app/api/cart" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"productId": "car-1", "quantity": 1}'

# Device 2: Check for real-time sync
# Should see the item appear immediately
```

### **2. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…ØªØµÙ„Ø©**
```javascript
// Simulate offline
window.navigator.onLine = false;
window.dispatchEvent(new Event('offline'));

// Add items (should work locally)
await addToCart(item);

// Go back online
window.navigator.onLine = true;
window.dispatchEvent(new Event('online'));

// Should auto-sync
```

---

## ğŸš€ **Ù†Ø´Ø± Ø§Ù„Ù†Ø¸Ø§Ù…**

### **1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©**
```bash
# .env.production
VITE_FIREBASE_API_KEY=AIzaSyAdkK2OlebHPUsWFCEqY5sWHs5ZL3wUk0Q
VITE_FIREBASE_AUTH_DOMAIN=souk-el-syarat.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=souk-el-syarat
VITE_FIREBASE_STORAGE_BUCKET=souk-el-syarat.firebasestorage.app
VITE_FIREBASE_MESSAGING_SENDER_ID=505765285633
VITE_FIREBASE_APP_ID=1:505765285633:web:1bc55f947c68b46d75d500
VITE_FIREBASE_MEASUREMENT_ID=G-46RKPHQLVB
VITE_FIREBASE_DATABASE_URL=https://souk-el-syarat-default-rtdb.europe-west1.firebasedatabase.app/
```

### **2. Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù†Ø´Ø±**
```bash
# Build for production
npm run build

# Deploy to Firebase
firebase deploy --only hosting

# Deploy with token (for CI/CD)
firebase deploy --only hosting --token $FIREBASE_TOKEN
```

---

## ğŸ“Š **Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø¸Ø§Ù…**

### **1. Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©**
```typescript
interface PerformanceMetrics {
  syncLatency: number;        // Ø²Ù…Ù† Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© (ms)
  errorRate: number;          // Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ (%)
  activeConnections: number;  // Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
  dataTransfer: number;       // Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (KB)
  userSatisfaction: number;   // Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (1-10)
}
```

### **2. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«**
```typescript
const logEvent = (event: string, data: any) => {
  console.log(`ğŸ”¥ [${new Date().toISOString()}] ${event}:`, data);
  
  // Send to analytics
  if (typeof window !== 'undefined' && window.gtag) {
    window.gtag('event', event, data);
  }
};
```

---

## ğŸ”§ **Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ¥ØµÙ„Ø§Ø­Ù‡Ø§**

### **Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø© ÙˆØ­Ù„ÙˆÙ„Ù‡Ø§**

#### **1. Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©**
```
Ø§Ù„Ø®Ø·Ø£: syncStatus === 'error'
Ø§Ù„Ø­Ù„: 
- ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
- ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙˆÙƒÙ†
- Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
```

#### **2. ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**
```
Ø§Ù„Ø®Ø·Ø£: Ù„Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
Ø§Ù„Ø­Ù„:
- ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ§Ø¹Ø¯ Firestore
- ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
- ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
```

#### **3. Ø¹Ø¯Ù… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©**
```
Ø§Ù„Ø®Ø·Ø£: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø© ÙÙŠ Firebase Ù„ÙƒÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ø§ ØªØªØ­Ø¯ÙŠØ«
Ø§Ù„Ø­Ù„:
- ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª
- ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
- Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª
```

### **Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ**
```typescript
// Debug helper
const debugSync = () => {
  const { syncStatus, lastSyncTime, isOnline } = useAppStore.getState();
  const { isConnected, connectionError } = useRealtimeStore.getState();
  
  console.log('ğŸ” Sync Debug Info:', {
    appStoreSync: { syncStatus, lastSyncTime, isOnline },
    realtimeSync: { isConnected, connectionError },
    userId: localStorage.getItem('currentUserId'),
    userRole: localStorage.getItem('currentUserRole')
  });
};

// Call in browser console
window.debugSync = debugSync;
```

---

## ğŸ“ˆ **Ø®Ø·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©**

### **Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© - ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©**
1. **ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© ØªÙØ§Ø¶Ù„ÙŠØ©**: Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙ‚Ø· Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©
2. **ğŸ—œï¸ Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**: ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø©
3. **âš¡ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙØ¹ÙŠØ©**: ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
4. **ğŸ” ÙÙ‡Ø±Ø³Ø© Ø°ÙƒÙŠØ©**: ØªØ­Ø³ÙŠÙ† Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
5. **ğŸ“± Ø¯Ø¹Ù… PWA**: ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ ØªÙ‚Ø¯Ù…ÙŠ ÙƒØ§Ù…Ù„
6. **ğŸŒ Ø¯Ø¹Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚**: Ù†Ø´Ø± Ø¹Ø§Ù„Ù…ÙŠ

### **ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©**
1. **ğŸ” ØªØ´ÙÙŠØ± Ø´Ø§Ù…Ù„**: ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
2. **ğŸ›¡ï¸ Ø­Ù…Ø§ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©**: Ù…Ù†Ø¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª ÙˆØ§Ù„ØªÙ„Ø§Ø¹Ø¨
3. **ğŸ“Š Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ù…Ø§Ù†**: ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
4. **ğŸ”‘ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­**: Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙØ§ØªÙŠØ­ Ù…ØªÙ‚Ø¯Ù…

---

## ğŸ“ **Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„ØµÙŠØ§Ù†Ø©**

### **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„**
- **Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ**: Claude AI Assistant
- **Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù…**: React + TypeScript + Firebase
- **Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…**: v2.0.0
- **ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«**: 2024

### **Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©**
1. **ÙŠÙˆÙ…ÙŠØ§Ù‹**: Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡
2. **Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹**: ØªØ­Ø¯ÙŠØ« Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø£Ù…Ø§Ù†
3. **Ø´Ù‡Ø±ÙŠØ§Ù‹**: ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù…
4. **Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ§Ù‹**: Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù†Ø¸Ø§Ù…

---

## ğŸ¯ **Ø§Ù„Ø®Ù„Ø§ØµØ©**

ØªÙ… ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙˆÙØ±:

âœ… **Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©** Ù„Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©  
âœ… **ØªØ®Ø²ÙŠÙ† Ù…Ù†ÙØ±Ø¯ Ø¢Ù…Ù†** Ù„ÙƒÙ„ Ù…Ø³ØªØ®Ø¯Ù…  
âœ… **Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø³Ø±ÙŠØ¹** Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©  
âœ… **Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ù…ØªÙ‚Ø¯Ù…Ø©** Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡  
âœ… **ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªØ®Ø¯Ù… ØªÙØ§Ø¹Ù„ÙŠØ©** Ù…Ø¹ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø©  
âœ… **Ø£Ù…Ø§Ù† Ø¹Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰** Ù…Ø¹ Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ø­ÙƒÙ…Ø©  
âœ… **Ø£Ø¯Ø§Ø¡ Ù…Ø­Ø³Ù†** Ù…Ø¹ ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…ØªÙØ§Ø¦Ù„Ø©  
âœ… **Ù…Ø±Ø§Ù‚Ø¨Ø© Ø´Ø§Ù…Ù„Ø©** Ù„Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡  

Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠ ÙˆÙŠØ¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹! ğŸš€