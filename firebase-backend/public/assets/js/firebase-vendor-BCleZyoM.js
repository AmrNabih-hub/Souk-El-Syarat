var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=Reflect.get,l=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,c=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&l(e,n,t[n]);if(i)for(var n of i(t))o.call(t,n)&&l(e,n,t[n]);return e},u=(e,i)=>t(e,n(i)),h=(e,t)=>{var n={};for(var r in e)s.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&i)for(var r of i(e))t.indexOf(r)<0&&o.call(e,r)&&(n[r]=e[r]);return n},d=(e,t,n)=>a(r(e),n,t),f=(e,t,n)=>new Promise((i,r)=>{var s=e=>{try{a(n.next(e))}catch(t){r(t)}},o=e=>{try{a(n.throw(e))}catch(t){r(t)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(s,o);a((n=n.apply(e,t)).next())}),p={};const g=function(e,t){if(!e)throw m(t)},m=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},_=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},y={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<e.length;r+=3){const t=e[r],s=r+1<e.length,o=s?e[r+1]:0,a=r+2<e.length,l=a?e[r+2]:0,c=t>>2,u=(3&t)<<4|o>>4;let h=(15&o)<<2|l>>6,d=63&l;a||(d=64,s||(h=64)),i.push(n[c],n[u],n[h],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(_(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<e.length;){const t=n[e.charAt(r++)],s=r<e.length?n[e.charAt(r)]:0;++r;const o=r<e.length?n[e.charAt(r)]:64;++r;const a=r<e.length?n[e.charAt(r)]:64;if(++r,null==t||null==s||null==o||null==a)throw new v;const l=t<<2|s>>4;if(i.push(l),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class v extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const w=function(e){const t=_(e);return y.encodeByteArray(t,!0)},T=function(e){return w(e).replace(/\./g,"")},I=function(e){try{return y.decodeString(e,!0)}catch(t){}return null};function E(e){return b(void 0,e)}function b(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&C(n)&&(e[n]=b(e[n],t[n]));return e}function C(e){return"__proto__"!==e}const S=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const e=p.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&I(e[1]);return t&&JSON.parse(t)})()}catch(e){return}},k=e=>{var t,n;return null==(n=null==(t=S())?void 0:t.emulatorHosts)?void 0:n[e]},N=e=>{const t=k(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},A=()=>{var e;return null==(e=S())?void 0:e.config},R=e=>{var t;return null==(t=S())?void 0:t[`_${e}`]};class P{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function D(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}function O(e){return f(this,null,function*(){return(yield fetch(e,{credentials:"include"})).ok})}function x(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=c({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[T(JSON.stringify({alg:"none",type:"JWT"})),T(JSON.stringify(s)),""].join(".")}const L={};let M=!1;function U(e,t){if("undefined"==typeof window||"undefined"==typeof document||!D(window.location.host)||L[e]===t||L[e]||M)return;function n(e){return`__firebase__banner__${e}`}L[e]=t;const i="__firebase__banner",r=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(L))L[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(i),t=n("text"),s=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),l=n("preprendIcon"),c=document.getElementById(l)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{M=!0,function(){const e=document.getElementById(i);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(c,l),t.append(c,s,a,n),document.body.appendChild(t)}r?(s.innerText="Preview backend disconnected.",c.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(c.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function F(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function V(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(F())}function q(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function j(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function B(){try{return"object"==typeof indexedDB}catch(e){return!1}}function z(){return new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null==(e=r.error)?void 0:e.message)||"")}}catch(n){t(n)}})}function $(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class H extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,H.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,W.prototype.create)}}class W{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(K,(e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`})}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new H(i,o,n)}}const K=/\{\$([^}]+)}/g;function G(e){return JSON.parse(e)}function Q(e){return JSON.stringify(e)}const Y=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=G(I(s[0])||""),n=G(I(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(s){}return{header:t,claims:n,data:i,signature:r}};function X(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Z(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ee(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function te(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(ne(n)&&ne(s)){if(!te(n,s))return!1}else if(n!==s)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function ne(e){return null!==e&&"object"==typeof e}function ie(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function re(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function se(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class oe{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(i=l^o&(a^l),r=1518500249):(i=o^a^l,r=1859775393):u<60?(i=o&a|l&(o|a),r=2400959708):(i=o^a^l,r=3395469782);const e=(s<<5|s>>>27)+i+c+r+n[u]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=s,s=e}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}class ae{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=le),void 0===i.error&&(i.error=le),void 0===i.complete&&(i.complete=le);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function le(){}function ce(e,t){return`${e} failed: ${t} argument `}const ue=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function he(e,t=1e3,n=2){const i=t*Math.pow(n,e),r=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+r)}function de(e){return e&&e._delegate?e._delegate:e}class fe{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const pe="[DEFAULT]";class ge{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new P;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!=(t=null==e?void 0:e.optional)&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:pe})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});n.resolve(e)}catch(t){}}}}clearInstance(e=pe){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return f(this,null,function*(){const e=Array.from(this.instances.values());yield Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return null!=this.component}isInitialized(e=pe){return this.instances.has(e)}getOptions(e=pe){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,s]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&s.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!=(n=this.onInitCallbacks.get(i))?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(i){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===pe?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(r){}var i;return n||null}normalizeInstanceIdentifier(e=pe){return this.component?this.component.multipleInstances?e:pe:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class me{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ge(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var _e,ye;(ye=_e||(_e={}))[ye.DEBUG=0]="DEBUG",ye[ye.VERBOSE=1]="VERBOSE",ye[ye.INFO=2]="INFO",ye[ye.WARN=3]="WARN",ye[ye.ERROR=4]="ERROR",ye[ye.SILENT=5]="SILENT";const ve={debug:_e.DEBUG,verbose:_e.VERBOSE,info:_e.INFO,warn:_e.WARN,error:_e.ERROR,silent:_e.SILENT},we=_e.INFO,Te={[_e.DEBUG]:"log",[_e.VERBOSE]:"log",[_e.INFO]:"info",[_e.WARN]:"warn",[_e.ERROR]:"error"},Ie=(e,t,...n)=>{if(!(t<e.logLevel||((new Date).toISOString(),Te[t])))throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Ee{constructor(e){this.name=e,this._logLevel=we,this._logHandler=Ie,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _e))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ve[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_e.DEBUG,...e),this._logHandler(this,_e.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_e.VERBOSE,...e),this._logHandler(this,_e.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_e.INFO,...e),this._logHandler(this,_e.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_e.WARN,...e),this._logHandler(this,_e.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_e.ERROR,...e),this._logHandler(this,_e.ERROR,...e)}}let be,Ce;const Se=new WeakMap,ke=new WeakMap,Ne=new WeakMap,Ae=new WeakMap,Re=new WeakMap;let Pe={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ke.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Ne.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Oe(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function De(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Ce||(Ce=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(xe(this),e),Oe(Se.get(this))}:function(...e){return Oe(t.apply(xe(this),e))}:function(e,...n){const i=t.call(xe(this),e,...n);return Ne.set(i,e.sort?e.sort():[e]),Oe(i)}:(e instanceof IDBTransaction&&function(e){if(ke.has(e))return;const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});ke.set(e,t)}(e),n=e,(be||(be=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>n instanceof e)?new Proxy(e,Pe):e);var t,n}function Oe(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(Oe(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&Se.set(t,e)}).catch(()=>{}),Re.set(t,e),t}(e);if(Ae.has(e))return Ae.get(e);const t=De(e);return t!==e&&(Ae.set(e,t),Re.set(t,e)),t}const xe=e=>Re.get(e),Le=["get","getKey","getAll","getAllKeys","count"],Me=["put","add","delete","clear"],Ue=new Map;function Fe(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Ue.get(t))return Ue.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=Me.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Le.includes(n))return;const s=function(e,...t){return f(this,null,function*(){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(yield Promise.all([o[n](...t),r&&s.done]))[0]})};return Ue.set(t,s),s}var Ve;Pe=u(c({},Ve=Pe),{get:(e,t,n)=>Fe(e,t)||Ve.get(e,t,n),has:(e,t)=>!!Fe(e,t)||Ve.has(e,t)});class qe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const je="@firebase/app",Be="0.14.1",ze=new Ee("@firebase/app"),$e="@firebase/app-compat",He="@firebase/analytics-compat",We="@firebase/analytics",Ke="@firebase/app-check-compat",Ge="@firebase/app-check",Qe="@firebase/auth",Ye="@firebase/auth-compat",Xe="@firebase/database",Je="@firebase/data-connect",Ze="@firebase/database-compat",et="@firebase/functions",tt="@firebase/functions-compat",nt="@firebase/installations",it="@firebase/installations-compat",rt="@firebase/messaging",st="@firebase/messaging-compat",ot="@firebase/performance",at="@firebase/performance-compat",lt="@firebase/remote-config",ct="@firebase/remote-config-compat",ut="@firebase/storage",ht="@firebase/storage-compat",dt="@firebase/firestore",ft="@firebase/ai",pt="@firebase/firestore-compat",gt="firebase",mt="[DEFAULT]",_t={[je]:"fire-core",[$e]:"fire-core-compat",[We]:"fire-analytics",[He]:"fire-analytics-compat",[Ge]:"fire-app-check",[Ke]:"fire-app-check-compat",[Qe]:"fire-auth",[Ye]:"fire-auth-compat",[Xe]:"fire-rtdb",[Je]:"fire-data-connect",[Ze]:"fire-rtdb-compat",[et]:"fire-fn",[tt]:"fire-fn-compat",[nt]:"fire-iid",[it]:"fire-iid-compat",[rt]:"fire-fcm",[st]:"fire-fcm-compat",[ot]:"fire-perf",[at]:"fire-perf-compat",[lt]:"fire-rc",[ct]:"fire-rc-compat",[ut]:"fire-gcs",[ht]:"fire-gcs-compat",[dt]:"fire-fst",[pt]:"fire-fst-compat",[ft]:"fire-vertex","fire-js":"fire-js",[gt]:"fire-js-all"},yt=new Map,vt=new Map,wt=new Map;function Tt(e,t){try{e.container.addComponent(t)}catch(n){ze.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function It(e){const t=e.name;if(wt.has(t))return ze.debug(`There were multiple attempts to register component ${t}.`),!1;wt.set(t,e);for(const n of yt.values())Tt(n,e);for(const n of vt.values())Tt(n,e);return!0}function Et(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function bt(e){return null!=e&&void 0!==e.settings}const Ct=new W("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class St{constructor(e,t,n){this._isDeleted=!1,this._options=c({},e),this._config=c({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new fe("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ct.create("app-deleted",{appName:this._name})}}const kt="12.1.0";function Nt(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=c({name:mt,automaticDataCollectionEnabled:!0},t),r=i.name;if("string"!=typeof r||!r)throw Ct.create("bad-app-name",{appName:String(r)});if(n||(n=A()),!n)throw Ct.create("no-options");const s=yt.get(r);if(s){if(te(n,s.options)&&te(i,s.config))return s;throw Ct.create("duplicate-app",{appName:r})}const o=new me(r);for(const l of wt.values())o.addComponent(l);const a=new St(n,i,o);return yt.set(r,a),a}function At(e=mt){const t=yt.get(e);if(!t&&e===mt&&A())return Nt();if(!t)throw Ct.create("no-app",{appName:e});return t}function Rt(e,t,n){var i;let r=null!=(i=_t[e])?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ze.warn(e.join(" "))}It(new fe(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const Pt="firebase-heartbeat-store";let Dt=null;function Ot(){return Dt||(Dt=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=Oe(o);return i&&o.addEventListener("upgradeneeded",e=>{i(Oe(o.result),e.oldVersion,e.newVersion,Oe(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Pt)}catch(n){}}}).catch(e=>{throw Ct.create("idb-open",{originalErrorMessage:e.message})})),Dt}function xt(e,t){return f(this,null,function*(){try{const n=(yield Ot()).transaction(Pt,"readwrite"),i=n.objectStore(Pt);yield i.put(t,Lt(e)),yield n.done}catch(n){if(n instanceof H)ze.warn(n.message);else{const e=Ct.create("idb-set",{originalErrorMessage:null==n?void 0:n.message});ze.warn(e.message)}}})}function Lt(e){return`${e.name}!${e.options.appId}`}class Mt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ft(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}triggerHeartbeat(){return f(this,null,function*(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ut();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(e=>e.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){ze.warn(n)}})}getHeartbeatsHeader(){return f(this,null,function*(){var e;try{if(null===this._heartbeatsCache&&(yield this._heartbeatsCachePromise),null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ut(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),Vt(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Vt(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=T(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return ze.warn(t),""}})}}function Ut(){return(new Date).toISOString().substring(0,10)}class Ft{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return f(this,null,function*(){return!!B()&&z().then(()=>!0).catch(()=>!1)})}read(){return f(this,null,function*(){if(yield this._canUseIndexedDBPromise){const e=yield function(e){return f(this,null,function*(){try{const t=(yield Ot()).transaction(Pt),n=yield t.objectStore(Pt).get(Lt(e));return yield t.done,n}catch(t){if(t instanceof H)ze.warn(t.message);else{const e=Ct.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});ze.warn(e.message)}}})}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}})}overwrite(e){return f(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const n=yield this.read();return xt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})}add(e){return f(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const n=yield this.read();return xt(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}})}}function Vt(e){return T(JSON.stringify({version:2,heartbeats:e})).length}It(new fe("platform-logger",e=>new qe(e),"PRIVATE")),It(new fe("heartbeat",e=>new Mt(e),"PRIVATE")),Rt(je,Be,""),Rt(je,Be,"esm2020"),Rt("fire-js",""),Rt("firebase","12.1.0","app");const qt=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},jt=new W("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Bt=new Ee("@firebase/auth");function zt(e,...t){Bt.logLevel<=_e.ERROR&&Bt.error(`Auth (${kt}): ${e}`,...t)}function $t(e,...t){throw Gt(e,...t)}function Ht(e,...t){return Gt(e,...t)}function Wt(e,t,n){const i=u(c({},qt()),{[t]:n});return new W("auth","Firebase",i).create(t,{appName:e.name})}function Kt(e){return Wt(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Gt(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return jt.create(e,...t)}function Qt(e,t,...n){if(!e)throw Gt(t,...n)}function Yt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw zt(t),new Error(t)}function Xt(e,t){e||Yt(t)}function Jt(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function Zt(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class en{constructor(e,t){this.shortDelay=e,this.longDelay=t,Xt(t>e,"Short delay should be less than long delay!"),this.isMobile=V()||j()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Zt()||"https:"===Zt()||q()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function tn(e,t){Xt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class nn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Yt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Yt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Yt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const rn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},sn=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],on=new en(3e4,6e4);function an(e,t){return e.tenantId&&!t.tenantId?u(c({},t),{tenantId:e.tenantId}):t}function ln(e,t,n,i){return f(this,arguments,function*(e,t,n,i,r={}){return cn(e,r,()=>f(null,null,function*(){let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});const o=ie(c({key:e.config.apiKey},s)).slice(1),a=yield e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);const l=c({method:t,headers:a},r);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&D(e.emulatorConfig.host)&&(l.credentials="include"),nn.fetch()(yield hn(e,e.config.apiHost,n,o),l)}))})}function cn(e,t,n){return f(this,null,function*(){e._canInitEmulator=!1;const i=c(c({},rn),t);try{const t=new fn(e),r=yield Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=yield r.json();if("needConfirmation"in s)throw pn(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw pn(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw pn(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw pn(e,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Wt(e,a,o);$t(e,a)}}catch(r){if(r instanceof H)throw r;$t(e,"network-request-failed",{message:String(r)})}})}function un(e,t,n,i){return f(this,arguments,function*(e,t,n,i,r={}){const s=yield ln(e,t,n,i,r);return"mfaPendingCredential"in s&&$t(e,"multi-factor-auth-required",{_serverResponse:s}),s})}function hn(e,t,n,i){return f(this,null,function*(){const r=`${t}${n}?${i}`,s=e,o=s.config.emulator?tn(e.config,r):`${e.config.apiScheme}://${r}`;return sn.includes(n)&&(yield s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(o).toString():o})}function dn(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class fn{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Ht(this.auth,"network-request-failed")),on.get())})}}function pn(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=Ht(e,t,i);return r.customData._tokenResponse=n,r}function gn(e){return void 0!==e&&void 0!==e.enterprise}class mn{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return dn(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}function _n(e,t){return f(this,null,function*(){return ln(e,"POST","/v1/accounts:lookup",t)})}function yn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function vn(e){return 1e3*Number(e)}function wn(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return zt("JWT malformed, contained fewer than 3 sections"),null;try{const e=I(n);return e?JSON.parse(e):(zt("Failed to decode base64 JWT payload"),null)}catch(r){return zt("Caught error parsing JWT payload as JSON",null==r?void 0:r.toString()),null}}function Tn(e){const t=wn(e);return Qt(t,"internal-error"),Qt(void 0!==t.exp,"internal-error"),Qt(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}function In(e,t,n=!1){return f(this,null,function*(){if(n)return t;try{return yield t}catch(i){throw i instanceof H&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(i)&&e.auth.currentUser===e&&(yield e.auth.signOut()),i}})}class En{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(()=>f(this,null,function*(){yield this.iteration()}),t)}iteration(){return f(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()})}}class bn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=yn(this.lastLoginAt),this.creationTime=yn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Cn(e){return f(this,null,function*(){var t;const n=e.auth,i=yield e.getIdToken(),r=yield In(e,_n(n,{idToken:i}));Qt(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];e._notifyReloadListener(s);const o=(null==(t=s.providerUserInfo)?void 0:t.length)?Sn(s.providerUserInfo):[],a=(l=e.providerData,c=o,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const u=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!u&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new bn(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)})}function Sn(e){return e.map(e=>{var t=e,{providerId:n}=t,i=h(t,["providerId"]);return{providerId:n,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}class kn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Qt(e.idToken,"internal-error"),Qt(void 0!==e.idToken,"internal-error"),Qt(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Tn(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Qt(0!==e.length,"internal-error");const t=Tn(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return f(this,null,function*(){return t||!this.accessToken||this.isExpired?(Qt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return f(this,null,function*(){const{accessToken:n,refreshToken:i,expiresIn:r}=yield function(e,t){return f(this,null,function*(){const n=yield cn(e,{},()=>f(null,null,function*(){const n=ie({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=yield hn(e,i,"/v1/token",`key=${r}`),o=yield e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const a={method:"POST",headers:o,body:n};return e.emulatorConfig&&D(e.emulatorConfig.host)&&(a.credentials="include"),nn.fetch()(s,a)}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}})}(e,t);this.updateTokensAndExpiration(n,i,Number(r))})}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new kn;return n&&(Qt("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(Qt("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(Qt("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new kn,this.toJSON())}_performRefresh(){return Yt("not implemented")}}function Nn(e,t){Qt("string"==typeof e||void 0===e,"internal-error",{appName:t})}class An{constructor(e){var t=e,{uid:n,auth:i,stsTokenManager:r}=t,s=h(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new En(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new bn(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return f(this,null,function*(){const t=yield In(this,this.stsTokenManager.getToken(this.auth,e));return Qt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return function(e,t=!1){return f(this,null,function*(){const n=de(e),i=yield n.getIdToken(t),r=wn(i);Qt(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:yn(vn(r.auth_time)),issuedAtTime:yn(vn(r.iat)),expirationTime:yn(vn(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}})}(this,e)}reload(){return function(e){return f(this,null,function*(){const t=de(e);yield Cn(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}(this)}_assign(e){this!==e&&(Qt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>c({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new An(u(c({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Qt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return f(this,null,function*(){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&(yield Cn(this)),yield this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)})}delete(){return f(this,null,function*(){if(bt(this.auth.app))return Promise.reject(Kt(this.auth));const e=yield this.getIdToken();return yield In(this,function(e,t){return f(this,null,function*(){return ln(e,"POST","/v1/accounts:delete",t)})}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return u(c({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>c({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,l,u;const h=null!=(n=t.displayName)?n:void 0,d=null!=(i=t.email)?i:void 0,f=null!=(r=t.phoneNumber)?r:void 0,p=null!=(s=t.photoURL)?s:void 0,g=null!=(o=t.tenantId)?o:void 0,m=null!=(a=t._redirectEventId)?a:void 0,_=null!=(l=t.createdAt)?l:void 0,y=null!=(u=t.lastLoginAt)?u:void 0,{uid:v,emailVerified:w,isAnonymous:T,providerData:I,stsTokenManager:E}=t;Qt(v&&E,e,"internal-error");const b=kn.fromJSON(this.name,E);Qt("string"==typeof v,e,"internal-error"),Nn(h,e.name),Nn(d,e.name),Qt("boolean"==typeof w,e,"internal-error"),Qt("boolean"==typeof T,e,"internal-error"),Nn(f,e.name),Nn(p,e.name),Nn(g,e.name),Nn(m,e.name),Nn(_,e.name),Nn(y,e.name);const C=new An({uid:v,auth:e,email:d,emailVerified:w,displayName:h,isAnonymous:T,photoURL:p,phoneNumber:f,tenantId:g,stsTokenManager:b,createdAt:_,lastLoginAt:y});return I&&Array.isArray(I)&&(C.providerData=I.map(e=>c({},e))),m&&(C._redirectEventId=m),C}static _fromIdTokenResponse(e,t,n=!1){return f(this,null,function*(){const i=new kn;i.updateFromServerResponse(t);const r=new An({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return yield Cn(r),r})}static _fromGetAccountInfoResponse(e,t,n){return f(this,null,function*(){const i=t.users[0];Qt(void 0!==i.localId,"internal-error");const r=void 0!==i.providerUserInfo?Sn(i.providerUserInfo):[],s=!(i.email&&i.passwordHash||(null==r?void 0:r.length)),o=new kn;o.updateFromIdToken(n);const a=new An({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new bn(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||(null==r?void 0:r.length))};return Object.assign(a,l),a})}}const Rn=new Map;function Pn(e){Xt(e instanceof Function,"Expected a class definition");let t=Rn.get(e);return t?(Xt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Rn.set(e,t),t)}class Dn{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return f(this,null,function*(){return!0})}_set(e,t){return f(this,null,function*(){this.storage[e]=t})}_get(e){return f(this,null,function*(){const t=this.storage[e];return void 0===t?null:t})}_remove(e){return f(this,null,function*(){delete this.storage[e]})}_addListener(e,t){}_removeListener(e,t){}}Dn.type="NONE";const On=Dn;function xn(e,t,n){return`firebase:${e}:${t}:${n}`}class Ln{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=xn(this.userKey,i.apiKey,r),this.fullPersistenceKey=xn("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return f(this,null,function*(){const e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=yield _n(this.auth,{idToken:e}).catch(()=>{});return t?An._fromGetAccountInfoResponse(this.auth,t,e):null}return An._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return f(this,null,function*(){if(this.persistence===e)return;const t=yield this.getCurrentUser();return yield this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,n="authUser"){return f(this,null,function*(){if(!t.length)return new Ln(Pn(On),e,n);const i=(yield Promise.all(t.map(e=>f(null,null,function*(){if(yield e._isAvailable())return e})))).filter(e=>e);let r=i[0]||Pn(On);const s=xn(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=yield n._get(s);if(t){let i;if("string"==typeof t){const n=yield _n(e,{idToken:t}).catch(()=>{});if(!n)break;i=yield An._fromGetAccountInfoResponse(e,n,t)}else i=An._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(l){}const a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length?(r=a[0],o&&(yield r._set(s,o.toJSON())),yield Promise.all(t.map(e=>f(null,null,function*(){if(e!==r)try{yield e._remove(s)}catch(l){}}))),new Ln(r,e,n)):new Ln(r,e,n)})}}function Mn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(qn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Un(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Bn(t))return"Blackberry";if(zn(t))return"Webos";if(Fn(t))return"Safari";if((t.includes("chrome/")||Vn(t))&&!t.includes("edge/"))return"Chrome";if(jn(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Un(e=F()){return/firefox\//i.test(e)}function Fn(e=F()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Vn(e=F()){return/crios\//i.test(e)}function qn(e=F()){return/iemobile/i.test(e)}function jn(e=F()){return/android/i.test(e)}function Bn(e=F()){return/blackberry/i.test(e)}function zn(e=F()){return/webos/i.test(e)}function $n(e=F()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Hn(e=F()){return $n(e)||jn(e)||zn(e)||Bn(e)||/windows phone/i.test(e)||qn(e)}function Wn(e,t=[]){let n;switch(e){case"Browser":n=Mn(F());break;case"Worker":n=`${Mn(F())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${kt}/${i}`}class Kn{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,i)=>{try{n(e(t))}catch(r){i(r)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}runMiddleware(e){return f(this,null,function*(){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)yield n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(i){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==n?void 0:n.message})}})}}class Gn{constructor(e){var t,n,i,r;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(i=null==(n=e.allowedNonAlphanumericCharacters)?void 0:n.join(""))?i:"",this.forceUpgradeOnSignin=null!=(r=e.forceUpgradeOnSignin)&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null==(t=a.meetsMinPasswordLength)||t),a.isValid&&(a.isValid=null==(n=a.meetsMaxPasswordLength)||n),a.isValid&&(a.isValid=null==(i=a.containsLowercaseLetter)||i),a.isValid&&(a.isValid=null==(r=a.containsUppercaseLetter)||r),a.isValid&&(a.isValid=null==(s=a.containsNumericCharacter)||s),a.isValid&&(a.isValid=null==(o=a.containsNonAlphanumericCharacter)||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class Qn{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Xn(this),this.idTokenSubscription=new Xn(this),this.beforeStateQueue=new Kn(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=jt,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Pn(t)),this._initializationPromise=this.queue(()=>f(this,null,function*(){var n,i,r;if(!this._deleted&&(this.persistenceManager=yield Ln.create(this,e),null==(n=this._resolvePersistenceManagerAvailable)||n.call(this),!this._deleted)){if(null==(i=this._popupRedirectResolver)?void 0:i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(s){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(r=this.currentUser)?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return f(this,null,function*(){if(this._deleted)return;const e=yield this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(yield this.currentUser.getIdToken())):void(yield this._updateCurrentUser(e,!0)):void 0})}initializeCurrentUserFromIdToken(e){return f(this,null,function*(){try{const t=yield _n(this,{idToken:e}),n=yield An._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(n)}catch(t){yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return f(this,null,function*(){var t;if(bt(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=yield this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();const n=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,o=yield this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{yield this.beforeStateQueue.runMiddleware(i)}catch(s){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Qt(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)})}tryRedirectSignIn(e){return f(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return f(this,null,function*(){try{yield Cn(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){return f(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return f(this,null,function*(){if(bt(this.app))return Promise.reject(Kt(this));const t=e?de(e):null;return t&&Qt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return f(this,null,function*(){if(!this._deleted)return e&&Qt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>f(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return f(this,null,function*(){return bt(this.app)?Promise.reject(Kt(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return bt(this.app)?Promise.reject(Kt(this)):this.queue(()=>f(this,null,function*(){yield this.assertedPersistence.setPersistence(Pn(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return f(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return f(this,null,function*(){const e=yield function(e){return f(this,arguments,function*(e,t={}){return ln(e,"GET","/v2/passwordPolicy",an(e,t))})}(this),t=new Gn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new W("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}revokeAccessToken(e){return f(this,null,function*(){if(this.currentUser){const t=yield this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};null!=this.tenantId&&(n.tenantId=this.tenantId),yield function(e,t){return f(this,null,function*(){return ln(e,"POST","/v2/accounts:revokeToken",an(e,t))})}(this,n)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}_setRedirectUser(e,t){return f(this,null,function*(){const n=yield this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return f(this,null,function*(){if(!this.redirectPersistenceManager){const t=e&&Pn(e)||this._popupRedirectResolver;Qt(t,this,"argument-error"),this.redirectPersistenceManager=yield Ln.create(this,[Pn(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return f(this,null,function*(){var t,n;return this._isInitialized&&(yield this.queue(()=>f(this,null,function*(){}))),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return f(this,null,function*(){if(e===this.currentUser)return this.queue(()=>f(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Qt(o,this,"internal-error"),o.then(()=>{s||r(this.currentUser)}),"function"==typeof t){const r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}directlySetCurrentUser(e){return f(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Qt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Wn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return f(this,null,function*(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=yield null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader();n&&(t["X-Firebase-Client"]=n);const i=yield this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t})}_getAppCheckToken(){return f(this,null,function*(){var e;if(bt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=yield null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken();return(null==t?void 0:t.error)&&function(e,...t){Bt.logLevel<=_e.WARN&&Bt.warn(`Auth (${kt}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token})}}function Yn(e){return de(e)}class Xn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e){const t=new ae(e,void 0);return t.subscribe.bind(t)}(e=>this.observer=e)}get next(){return Qt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Jn={loadJS(){return f(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Zn(e){return Jn.loadJS(e)}class ei{constructor(){this.enterprise=new ti}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class ti{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const ni="NO_RECAPTCHA";class ii{constructor(e){this.type="recaptcha-enterprise",this.auth=Yn(e)}verify(e="verify",t=!1){return f(this,null,function*(){function n(t,n,i){const r=window.grecaptcha;gn(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(ni)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new ei).execute("siteKey",{action:"verify"}):new Promise((e,i)=>{(function(e){return f(this,null,function*(){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((t,n)=>f(null,null,function*(){(function(e,t){return f(this,null,function*(){return ln(e,"GET","/v2/recaptchaConfig",an(e,t))})})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new mn(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})}))})})(this.auth).then(r=>{if(!t&&gn(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=Jn.recaptchaEnterpriseScript;0!==t.length&&(t+=r),Zn(t).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})})}}function ri(e,t,n,i=!1,r=!1){return f(this,null,function*(){const s=new ii(e);let o;if(r)o=ni;else try{o=yield s.verify(n)}catch(l){o=yield s.verify(n,!0)}const a=c({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a})}function si(e,t,n,i,r){return f(this,null,function*(){var r;if(null==(r=e._getRecaptchaConfig())?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=yield ri(e,t,n,"getOobCode"===n);return i(e,r)}return i(e,t).catch(r=>f(null,null,function*(){if("auth/missing-recaptcha-token"===r.code){const r=yield ri(e,t,n,"getOobCode"===n);return i(e,r)}return Promise.reject(r)}))})}function oi(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ai(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class li{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Yt("not implemented")}_getIdTokenResponse(e){return Yt("not implemented")}_linkToIdToken(e,t){return Yt("not implemented")}_getReauthenticationResolver(e){return Yt("not implemented")}}function ci(e,t){return f(this,null,function*(){return ln(e,"POST","/v1/accounts:signUp",t)})}function ui(e,t){return f(this,null,function*(){return un(e,"POST","/v1/accounts:signInWithPassword",an(e,t))})}function hi(e,t){return f(this,null,function*(){return ln(e,"POST","/v1/accounts:sendOobCode",an(e,t))})}function di(e,t){return f(this,null,function*(){return hi(e,t)})}class fi extends li{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new fi(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new fi(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return f(this,null,function*(){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return si(e,t,"signInWithPassword",ui);case"emailLink":return function(e,t){return f(this,null,function*(){return un(e,"POST","/v1/accounts:signInWithEmailLink",an(e,t))})}(e,{email:this._email,oobCode:this._password});default:$t(e,"internal-error")}})}_linkToIdToken(e,t){return f(this,null,function*(){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return si(e,n,"signUpPassword",ci);case"emailLink":return function(e,t){return f(this,null,function*(){return un(e,"POST","/v1/accounts:signInWithEmailLink",an(e,t))})}(e,{idToken:t,email:this._email,oobCode:this._password});default:$t(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}function pi(e,t){return f(this,null,function*(){return un(e,"POST","/v1/accounts:signInWithIdp",an(e,t))})}class gi extends li{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new gi(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):$t("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=h(t,["providerId","signInMethod"]);if(!n||!i)return null;const s=new gi(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return pi(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,pi(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,pi(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ie(t)}return e}}class mi{constructor(e){var t,n,i,r,s,o;const a=re(se(e)),l=null!=(t=a.apiKey)?t:null,c=null!=(n=a.oobCode)?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(i=a.mode)?i:null);Qt(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!=(r=a.continueUrl)?r:null,this.languageCode=null!=(s=a.lang)?s:null,this.tenantId=null!=(o=a.tenantId)?o:null}static parseLink(e){const t=function(e){const t=re(se(e)).link,n=t?re(se(t)).deep_link_id:null,i=re(se(e)).deep_link_id;return(i?re(se(i)).link:null)||i||n||t||e}(e);try{return new mi(t)}catch(n){return null}}}class _i{constructor(){this.providerId=_i.PROVIDER_ID}static credential(e,t){return fi._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=mi.parseLink(t);return Qt(n,"argument-error"),fi._fromEmailAndCode(e,n.code,n.tenantId)}}_i.PROVIDER_ID="password",_i.EMAIL_PASSWORD_SIGN_IN_METHOD="password",_i.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class yi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class vi extends yi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class wi extends vi{constructor(){super("facebook.com")}static credential(e){return gi._fromParams({providerId:wi.PROVIDER_ID,signInMethod:wi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wi.credentialFromTaggedObject(e)}static credentialFromError(e){return wi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return wi.credential(e.oauthAccessToken)}catch(t){return null}}}wi.FACEBOOK_SIGN_IN_METHOD="facebook.com",wi.PROVIDER_ID="facebook.com";class Ti extends vi{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return gi._fromParams({providerId:Ti.PROVIDER_ID,signInMethod:Ti.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ti.credentialFromTaggedObject(e)}static credentialFromError(e){return Ti.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ti.credential(t,n)}catch(i){return null}}}Ti.GOOGLE_SIGN_IN_METHOD="google.com",Ti.PROVIDER_ID="google.com";class Ii extends vi{constructor(){super("github.com")}static credential(e){return gi._fromParams({providerId:Ii.PROVIDER_ID,signInMethod:Ii.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ii.credentialFromTaggedObject(e)}static credentialFromError(e){return Ii.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ii.credential(e.oauthAccessToken)}catch(t){return null}}}Ii.GITHUB_SIGN_IN_METHOD="github.com",Ii.PROVIDER_ID="github.com";class Ei extends vi{constructor(){super("twitter.com")}static credential(e,t){return gi._fromParams({providerId:Ei.PROVIDER_ID,signInMethod:Ei.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ei.credentialFromTaggedObject(e)}static credentialFromError(e){return Ei.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ei.credential(t,n)}catch(i){return null}}}function bi(e,t){return f(this,null,function*(){return un(e,"POST","/v1/accounts:signUp",an(e,t))})}Ei.TWITTER_SIGN_IN_METHOD="twitter.com",Ei.PROVIDER_ID="twitter.com";class Ci{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,n,i=!1){return f(this,null,function*(){const r=yield An._fromIdTokenResponse(e,n,i),s=Si(n);return new Ci({user:r,providerId:s,_tokenResponse:n,operationType:t})})}static _forOperation(e,t,n){return f(this,null,function*(){yield e._updateTokensIfNecessary(n,!0);const i=Si(n);return new Ci({user:e,providerId:i,_tokenResponse:n,operationType:t})})}}function Si(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ki extends H{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,ki.prototype),this.customData={appName:e.name,tenantId:null!=(r=e.tenantId)?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new ki(e,t,n,i)}}function Ni(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw ki._fromErrorAndOperation(e,n,t,i);throw n})}function Ai(e,t,n=!1){return f(this,null,function*(){if(bt(e.app))return Promise.reject(Kt(e));const i="signIn",r=yield Ni(e,i,t),s=yield Ci._fromIdTokenResponse(e,i,r);return n||(yield e._updateCurrentUser(s.user)),s})}function Ri(e){return f(this,null,function*(){const t=Yn(e);t._getPasswordPolicyInternal()&&(yield t._updatePasswordPolicy())})}function Pi(e,t,n){return f(this,null,function*(){const n=Yn(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};yield si(n,i,"getOobCode",di)})}function Di(e,t,n){return f(this,null,function*(){if(bt(e.app))return Promise.reject(Kt(e));const i=Yn(e),r=si(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",bi),s=yield r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Ri(e),t}),o=yield Ci._fromIdTokenResponse(i,"signIn",s);return yield i._updateCurrentUser(o.user),o})}function Oi(e,t,n){return bt(e.app)?Promise.reject(Kt(e)):function(e,t){return f(this,null,function*(){return Ai(Yn(e),t)})}(de(e),_i.credential(t,n)).catch(t=>f(null,null,function*(){throw"auth/password-does-not-meet-requirements"===t.code&&Ri(e),t}))}function xi(e,t){return f(this,null,function*(){const n=de(e),i={requestType:"VERIFY_EMAIL",idToken:yield e.getIdToken()};t&&function(e,t,n){var i;Qt((null==(i=n.url)?void 0:i.length)>0,e,"invalid-continue-uri"),Qt(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),Qt(void 0===n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Qt(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(Qt(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}(n.auth,i,t);const{email:r}=yield function(e,t){return f(this,null,function*(){return hi(e,t)})}(n.auth,i);r!==e.email&&(yield e.reload())})}function Li(e,t){return f(this,arguments,function*(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const i=de(e),r={idToken:yield i.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=yield In(i,function(e,t){return f(this,null,function*(){return ln(e,"POST","/v1/accounts:update",t)})}(i.auth,r));i.displayName=s.displayName||null,i.photoURL=s.photoUrl||null;const o=i.providerData.find(({providerId:e})=>"password"===e);o&&(o.displayName=i.displayName,o.photoURL=i.photoURL),yield i._updateTokensIfNecessary(s)})}function Mi(e,t){return function(e,t,n){return f(this,null,function*(){const{auth:t}=e,i={idToken:yield e.getIdToken(),returnSecureToken:!0};n&&(i.password=n);const r=yield In(e,function(e,t){return f(this,null,function*(){return ln(e,"POST","/v1/accounts:update",t)})}(t,i));yield e._updateTokensIfNecessary(r,!0)})}(de(e),0,t)}function Ui(e,t,n,i){return de(e).onAuthStateChanged(t,n,i)}function Fi(e){return de(e).signOut()}function Vi(e){return f(this,null,function*(){return de(e).delete()})}const qi="__sak";class ji{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(qi,"1"),this.storage.removeItem(qi),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Bi extends ji{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Hn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);!function(){const e=F();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||r===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){return f(this,null,function*(){yield d(Bi.prototype,this,"_set").call(this,e,t),this.localCache[e]=JSON.stringify(t)})}_get(e){return f(this,null,function*(){const t=yield d(Bi.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(t),t})}_remove(e){return f(this,null,function*(){yield d(Bi.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}Bi.type="LOCAL";const zi=Bi;class $i extends ji{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}$i.type="SESSION";const Hi=$i;class Wi{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Wi(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}handleEvent(e){return f(this,null,function*(){const t=e,{eventId:n,eventType:i,data:r}=t.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map(e=>f(this,null,function*(){return e(t.origin,r)})),a=yield function(e){return Promise.all(e.map(e=>f(null,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ki(e="",t=10){let n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}Wi.receivers=[];class Gi{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,n=50){return f(this,null,function*(){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise((o,a)=>{const l=Ki("",20);i.port1.start();const c=setTimeout(()=>{a(new Error("unsupported_event"))},n);s={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),r=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(c),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})})}}function Qi(){return window}function Yi(){return void 0!==Qi().WorkerGlobalScope&&"function"==typeof Qi().importScripts}const Xi="firebaseLocalStorageDb",Ji="firebaseLocalStorage",Zi="fbase_key";class er{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tr(e,t){return e.transaction([Ji],t?"readwrite":"readonly").objectStore(Ji)}function nr(){const e=indexedDB.open(Xi,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Ji,{keyPath:Zi})}catch(i){n(i)}}),e.addEventListener("success",()=>f(null,null,function*(){const n=e.result;n.objectStoreNames.contains(Ji)?t(n):(n.close(),yield function(){const e=indexedDB.deleteDatabase(Xi);return new er(e).toPromise()}(),t(yield nr()))}))})}function ir(e,t,n){return f(this,null,function*(){const i=tr(e,!0).put({[Zi]:t,value:n});return new er(i).toPromise()})}function rr(e,t){const n=tr(e,!0).delete(t);return new er(n).toPromise()}class sr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return f(this,null,function*(){return this.db||(this.db=yield nr()),this.db})}_withRetries(e){return f(this,null,function*(){let t=0;for(;;)try{const t=yield this._openDb();return yield e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return f(this,null,function*(){return Yi()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return f(this,null,function*(){this.receiver=Wi._getInstance(Yi()?self:null),this.receiver._subscribe("keyChanged",(e,t)=>f(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(t.key)}})),this.receiver._subscribe("ping",(e,t)=>f(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return f(this,null,function*(){var e,t;if(this.activeServiceWorker=yield function(){return f(this,null,function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(e){return null}})}(),!this.activeServiceWorker)return;this.sender=new Gi(this.activeServiceWorker);const n=yield this.sender._send("ping",{},800);n&&(null==(e=n[0])?void 0:e.fulfilled)&&(null==(t=n[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return f(this,null,function*(){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(n){}})}_isAvailable(){return f(this,null,function*(){try{if(!indexedDB)return!1;const e=yield nr();return yield ir(e,qi,"1"),yield rr(e,qi),!0}catch(e){}return!1})}_withPendingWrite(e){return f(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,t){return f(this,null,function*(){return this._withPendingWrite(()=>f(this,null,function*(){return yield this._withRetries(n=>ir(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)}))})}_get(e){return f(this,null,function*(){const t=yield this._withRetries(t=>function(e,t){return f(this,null,function*(){const n=tr(e,!1).get(t),i=yield new er(n).toPromise();return void 0===i?null:i.value})}(t,e));return this.localCache[e]=t,t})}_remove(e){return f(this,null,function*(){return this._withPendingWrite(()=>f(this,null,function*(){return yield this._withRetries(t=>rr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return f(this,null,function*(){const e=yield this._withRetries(e=>{const t=tr(e,!1).getAll();return new er(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t})}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>f(this,null,function*(){return this._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}sr.type="LOCAL";const or=sr;function ar(e,t){return t?Pn(t):(Qt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}new en(3e4,6e4);class lr extends li{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return pi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return pi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return pi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function cr(e){return Ai(e.auth,new lr(e),e.bypassAuthState)}function ur(e){const{auth:t,user:n}=e;return Qt(n,t,"internal-error"),function(e,t,n=!1){return f(this,null,function*(){const{auth:i}=e;if(bt(i.app))return Promise.reject(Kt(i));const r="reauthenticate";try{const s=yield In(e,Ni(i,r,t,e),n);Qt(s.idToken,i,"internal-error");const o=wn(s.idToken);Qt(o,i,"internal-error");const{sub:a}=o;return Qt(e.uid===a,i,"user-mismatch"),Ci._forOperation(e,r,s)}catch(s){throw"auth/user-not-found"===(null==s?void 0:s.code)&&$t(i,"user-mismatch"),s}})}(n,new lr(e),e.bypassAuthState)}function hr(e){return f(this,null,function*(){const{auth:t,user:n}=e;return Qt(n,t,"internal-error"),function(e,t,n=!1){return f(this,null,function*(){const i=yield In(e,t._linkToIdToken(e.auth,yield e.getIdToken()),n);return Ci._forOperation(e,"link",i)})}(n,new lr(e),e.bypassAuthState)})}class dr{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>f(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}onAuthEvent(e){return f(this,null,function*(){const{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(o)(a))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cr;case"linkViaPopup":case"linkViaRedirect":return hr;case"reauthViaPopup":case"reauthViaRedirect":return ur;default:$t(this.auth,"internal-error")}}resolve(e){Xt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Xt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const fr=new en(2e3,1e4);function pr(e,t,n){return f(this,null,function*(){if(bt(e.app))return Promise.reject(Ht(e,"operation-not-supported-in-this-environment"));const i=Yn(e);!function(e,t){if(!(t instanceof yi))throw yi.name!==t.constructor.name&&$t(e,"argument-error"),Wt(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t);const r=ar(i,n);return new gr(i,"signInViaPopup",t,r).executeNotNull()})}class gr extends dr{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,gr.currentPopupAction&&gr.currentPopupAction.cancel(),gr.currentPopupAction=this}executeNotNull(){return f(this,null,function*(){const e=yield this.execute();return Qt(e,this.auth,"internal-error"),e})}onExecution(){return f(this,null,function*(){Xt(1===this.filter.length,"Popup operations only handle one event");const e=Ki();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Ht(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(Ht(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,gr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null==(n=null==(t=this.authWindow)?void 0:t.window)?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ht(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,fr.get())};e()}}gr.currentPopupAction=null;const mr=new Map;class _r extends dr{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}execute(){return f(this,null,function*(){let e=mr.get(this.auth._key());if(!e){try{const t=(yield function(e,t){return f(this,null,function*(){const n=function(e){return xn("pendingRedirect",e.config.apiKey,e.name)}(t),i=function(e){return Pn(e._redirectPersistence)}(e);if(!(yield i._isAvailable()))return!1;const r="true"===(yield i._get(n));return yield i._remove(n),r})}(this.resolver,this.auth))?yield d(_r.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}mr.set(this.auth._key(),e)}return this.bypassAuthState||mr.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return f(this,null,function*(){if("signInViaRedirect"===e.type)return d(_r.prototype,this,"onAuthEvent").call(this,e);if("unknown"!==e.type){if(e.eventId){const t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,d(_r.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}}else this.resolve(null)})}onExecution(){return f(this,null,function*(){})}cleanUp(){}}function yr(e,t){mr.set(e._key(),t)}function vr(e,t,n=!1){return f(this,null,function*(){if(bt(e.app))return Promise.reject(Kt(e));const i=Yn(e),r=ar(i,t),s=new _r(i,r,n),o=yield s.execute();return o&&!n&&(delete o.user._redirectEventId,yield i._persistUserIfCurrent(o.user),yield i._setRedirectUser(null,t)),o})}class wr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ir(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Ir(e)){const i=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ht(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Tr(e))}saveEventToCache(e){this.cachedEventUids.add(Tr(e)),this.lastProcessedEventTime=Date.now()}}function Tr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ir({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Er=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,br=/^https?/;function Cr(e){const t=Jt(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!br.test(n))return!1;if(Er.test(e))return i===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const Sr=new en(3e4,6e4);function kr(){const e=Qi().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let Nr=null;const Ar=new en(5e3,15e3),Rr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Pr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Dr(e){const t=e.config;Qt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?tn(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:kt},r=Pr.get(e.config.apiHost);r&&(i.eid=r);const s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${ie(i).slice(1)}`}function Or(e){return f(this,null,function*(){const t=yield function(e){return Nr=Nr||function(e){return new Promise((t,n)=>{var i,r,s;function o(){kr(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{kr(),n(Ht(e,"network-request-failed"))},timeout:Sr.get()})}if(null==(r=null==(i=Qi().gapi)?void 0:i.iframes)?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null==(s=Qi().gapi)?void 0:s.load)){const t=`__iframefcb${Math.floor(1e6*Math.random())}`;return Qi()[t]=()=>{gapi.load?o():n(Ht(e,"network-request-failed"))},Zn(`${Jn.gapiScript}?onload=${t}`).catch(e=>n(e))}o()}}).catch(e=>{throw Nr=null,e})}(e),Nr}(e),n=Qi().gapi;return Qt(n,e,"internal-error"),t.open({where:document.body,url:Dr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Rr,dontclear:!0},t=>new Promise((n,i)=>f(null,null,function*(){yield t.restyle({setHideOnLeave:!1});const r=Ht(e,"network-request-failed"),s=Qi().setTimeout(()=>{i(r)},Ar.get());function o(){Qi().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})})))})}const xr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Lr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Mr=encodeURIComponent("fac");function Ur(e,t,n,i,r,s){return f(this,null,function*(){Qt(e.config.authDomain,e,"auth-domain-config-required"),Qt(e.config.apiKey,e,"invalid-api-key");const s={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:kt,eventId:r};if(t instanceof yi){t.setDefaultLanguage(e.languageCode),s.providerId=t.providerId||"",Z(t.getCustomParameters())||(s.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))s[e]=t}if(t instanceof vi){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(s.scopes=e.join(","))}e.tenantId&&(s.tid=e.tenantId);const o=s;for(const e of Object.keys(o))void 0===o[e]&&delete o[e];const a=yield e._getAppCheckToken(),l=a?`#${Mr}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?tn(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${ie(o).slice(1)}${l}`})}const Fr="webStorageSupport",Vr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Hi,this._completeRedirectFn=vr,this._overrideRedirectResult=yr}_openPopup(e,t,n,i){return f(this,null,function*(){var r;Xt(null==(r=this.eventManagers[e._key()])?void 0:r.manager,"_initialize() not called before _openPopup()");const s=yield Ur(e,t,n,Jt(),i);return function(e,t,n,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const l=u(c({},xr),{width:i.toString(),height:r.toString(),top:s,left:o}),h=F().toLowerCase();n&&(a=Vn(h)?"_blank":n),Un(h)&&(t=t||"http://localhost",l.scrollbars="yes");const d=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=F()){var t;return $n(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(h)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new Lr(null);const f=window.open(t||"",a,d);Qt(f,e,"popup-blocked");try{f.focus()}catch(p){}return new Lr(f)}(e,s,Ki())})}_openRedirect(e,t,n,i){return f(this,null,function*(){return yield this._originValidation(e),r=yield Ur(e,t,n,Jt(),i),Qi().location.href=r,new Promise(()=>{});var r})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Xt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}initAndGetManager(e){return f(this,null,function*(){const t=yield Or(e),n=new wr(e);return t.register("authEvent",t=>(Qt(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Fr,{type:Fr},n=>{var i;const r=null==(i=null==n?void 0:n[0])?void 0:i[Fr];void 0!==r&&t(!!r),$t(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=function(e){return f(this,null,function*(){if(e.config.emulator)return;const{authorizedDomains:t}=yield function(e){return f(this,arguments,function*(e,t={}){return ln(e,"GET","/v1/projects",t)})}(e);for(const e of t)try{if(Cr(e))return}catch(n){}$t(e,"unauthorized-domain")})}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Hn()||Fn()||$n()}};var qr="@firebase/auth",jr="1.11.0";class Br{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}getToken(e){return f(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Qt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const zr=R("authIdTokenMaxAge")||300;let $r=null;function Hr(e=At()){const t=Et(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=Et(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(te(n.getOptions(),null!=t?t:{}))return e;$t(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Vr,persistence:[or,zi,Hi]}),i=R("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),e=>f(null,null,function*(){const t=e&&(yield e.getIdTokenResult()),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>zr)return;const i=null==t?void 0:t.token;$r!==i&&($r=i,yield fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))}));!function(e,t,n){de(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e){de(e).onIdTokenChanged(e=>t(e),void 0,void 0)}(n)}}var r;const s=k("auth");return s&&function(e,t){const n=Yn(e);Qt(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const i=oi(t),{host:r,port:s}=function(e){const t=oi(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const e=r[1];return{host:e,port:ai(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:ai(t)}}}(t),o=null===s?"":`:${s}`,a={url:`${i}//${r}${o}/`},l=Object.freeze({host:r,port:s,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator)return Qt(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void Qt(te(a,n.config.emulator)&&te(l,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=a,n.emulatorConfig=l,n.settings.appVerificationDisabledForTesting=!0,D(r)?(O(`${i}//${r}${o}`),U("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info,"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}var Wr;Jn={loadJS:e=>new Promise((t,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=Ht("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!=(s=null==(r=document.getElementsByTagName("head"))?void 0:r[0])?s:document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Wr="Browser",It(new fe("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Qt(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Wr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Wn(Wr)},l=new Qn(n,i,r,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Pn);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),It(new fe("auth-internal",e=>{const t=Yn(e.getProvider("auth").getImmediate());return new Br(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Rt(qr,jr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Wr)),Rt(qr,jr,"esm2020");var Kr,Gr,Qr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],o=t+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=(n=(r=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^t&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(s^t))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(s^t))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^t^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^t)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~t))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(t^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+s&4294967295}function i(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var i=t-this.blockSize,r=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=i;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(r[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,r),s=0;break}}else for(;o<t;)if(r[s++]=e[o++],s==this.blockSize){n(this,r),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var r={};function s(e){return-128<=e&&128>e?function(e){var t=r;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new i([0|e],0>e?-1:0)}(e)}(e):new i([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(0>e)return d(o(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new i(t,0)}var a=s(0),l=s(1),c=s(16777216);function u(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(l)}function f(e,t){return e.add(d(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function m(e,t){if(u(t))throw Error("division by zero");if(u(e))return new g(a,a);if(h(e))return t=m(d(e),t),new g(d(t.g),d(t.h));if(h(t))return t=m(e,d(t)),new g(d(t.g),t.h);if(30<e.g.length){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,i=t;0>=i.l(e);)n=_(n),i=_(i);var r=y(n,1),s=y(i,1);for(i=y(i,2),n=y(n,2);!u(i);){var c=s.add(i);0>=c.l(e)&&(r=r.add(n),s=c),i=y(i,1),n=y(n,1)}return t=f(e,r.j(t)),new g(r,t)}for(r=a;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),c=(s=o(n)).j(t);h(c)||0<c.l(e);)c=(s=o(n-=i)).j(t);u(s)&&(s=l),r=r.add(s),e=f(e,c)}return new g(r,e)}function _(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function y(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],o=0;o<r;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new i(s,e.h)}(e=i.prototype).m=function(){if(h(this))return-d(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(h(this))return"-"+d(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,i="";;){var r=m(n,t).g,s=((0<(n=f(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(u(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=f(this,e))?-1:u(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var o=r+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new i(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(0>this.l(c)&&0>e.l(c))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var l=this.i(r)>>>16,f=65535&this.i(r),g=e.i(s)>>>16,m=65535&e.i(s);n[2*r+2*s]+=f*m,p(n,2*r+2*s),n[2*r+2*s+1]+=l*m,p(n,2*r+2*s+1),n[2*r+2*s+1]+=f*g,p(n,2*r+2*s+1),n[2*r+2*s+2]+=l*g,p(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},e.A=function(e){return m(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Gr=t,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=o,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=o(Math.pow(n,8)),r=a,s=0;s<t.length;s+=8){var l=Math.min(8,t.length-s),c=parseInt(t.substring(s,s+l),n);8>l?(l=o(Math.pow(n,l)),r=r.j(l).add(o(c))):r=(r=r.j(i)).add(o(c))}return r},Kr=i}).apply(void 0!==Qr?Qr:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Yr,Xr,Jr,Zr,es,ts,ns,is,rs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof rs&&rs];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,i){if(i)e:{var r=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in r))break e;r=r[o]}(i=i(s=r[e=e[e.length-1]]))!=s&&null!=i&&t(r,e,{configurable:!0,writable:!0,value:i})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(0,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,function(e,t){return t})}});var i=i||{},r=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function d(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function f(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(s(t)){const n=e.length||0,i=t.length||0;e.length=n+i;for(let r=0;r<i;r++)e[n+r]=t[r]}else e.push(t)}}function p(e){return/^[\s\xa0]*$/.test(e)}function g(){var e=r.navigator;return e&&(e=e.userAgent)?e:""}function m(e){return m[" "](e),e}m[" "]=function(){};var _=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function y(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function v(e){const t={};for(const n in e)t[n]=e[n];return t}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(e,t){let n,i;for(let r=1;r<arguments.length;r++){for(n in i=arguments[r],i)e[n]=i[n];for(let t=0;t<w.length;t++)n=w[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function I(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function E(e){r.setTimeout(()=>{throw e},0)}function b(){var e=A;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var C=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new S,e=>e.reset());class S{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let k,N=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){const n=C.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},R=()=>{const e=r.Promise.resolve(void 0);k=()=>{e.then(P)}};var P=()=>{for(var e;e=b();){try{e.h.call(e.g)}catch(n){E(n)}var t=C;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}N=!1};function D(){this.s=this.s,this.C=this.C}function O(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}D.prototype.s=!1,D.prototype.ma=function(){this.s||(this.s=!0,this.N())},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},O.prototype.h=function(){this.defaultPrevented=!0};var x=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch(n){}return e}();function L(e,t){if(O.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(_){e:{try{m(t.nodeName);var r=!0;break e}catch(s){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:M[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&L.aa.h.call(this)}}h(L,O);var M={2:"touch",3:"pen",4:"mouse"};L.prototype.h=function(){L.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),F=0;function V(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++F,this.da=this.fa=!1}function q(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function j(e){this.src=e,this.g={},this.h=0}function B(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=Array.prototype.indexOf.call(r,t,void 0);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(q(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function z(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==i)return r}return-1}j.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=z(e,t,i,r);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new V(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var $="closure_lm_"+(1e6*Math.random()|0),H={};function W(e,t,n,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++)W(e,t[s],n,i,r);return null}return n=Z(n),e&&e[U]?e.K(t,n,!!o(i)&&!!i.capture,r):function(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var a=o(r)?!!r.capture:!!r,l=X(e);if(l||(e[$]=l=new j(e)),(n=l.add(t,n,i,a,s)).proxy)return n;if(i=function(){const e=Y;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)x||(r=a),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(Q(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}(e,t,n,!1,i,r)}function K(e,t,n,i,r){if(Array.isArray(t))for(var s=0;s<t.length;s++)K(e,t[s],n,i,r);else i=o(i)?!!i.capture:!!i,n=Z(n),e&&e[U]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=z(s=e.g[t],n,i,r))&&(q(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=X(e))&&(t=e.g[t.toString()],e=-1,t&&(e=z(t,n,i,r)),(n=-1<e?t[e]:null)&&G(n))}function G(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[U])B(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Q(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=X(t))?(B(n,e),0==n.h&&(n.src=null,t[$]=null)):q(e)}}}function Q(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new L(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&G(e),e=n.call(i,t)}return e}function X(e){return(e=e[$])instanceof j?e:null}var J="__closure_events_fn_"+(1e9*Math.random()>>>0);function Z(e){return"function"==typeof e?e:(e[J]||(e[J]=function(t){return e.handleEvent(t)}),e[J])}function ee(){D.call(this),this.i=new j(this),this.M=this,this.F=null}function te(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new O(t,e);else if(t instanceof O)t.target=t.target||e;else{var r=t;T(t=new O(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=ne(o,i,!0,t)&&r}if(r=ne(o=t.g=e,i,!0,t)&&r,r=ne(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=ne(o=t.g=n[s],i,!1,t)&&r}function ne(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.fa&&B(e.i,o),r=!1!==a.call(l,i)&&r}}return r&&!i.defaultPrevented}function ie(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:r.setTimeout(e,t||0)}function re(e){e.g=ie(()=>{e.g=null,e.i&&(e.i=!1,re(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}h(ee,D),ee.prototype[U]=!0,ee.prototype.removeEventListener=function(e,t,n,i){K(this,e,t,n,i)},ee.prototype.N=function(){if(ee.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)q(n[i]);delete t.g[e],t.h--}}this.F=null},ee.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ee.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class se extends D{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:re(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oe(e){D.call(this),this.h=e,this.g={}}h(oe,D);var ae=[];function le(e){y(e.g,function(e,t){this.g.hasOwnProperty(t)&&G(e)},e),e.g={}}oe.prototype.N=function(){oe.aa.N.call(this),le(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ce=r.JSON.stringify,ue=r.JSON.parse,he=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function de(){}function fe(e){return e.h||(e.h=e.i())}function pe(){}de.prototype.h=null;var ge={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function me(){O.call(this,"d")}function _e(){O.call(this,"c")}h(me,O),h(_e,O);var ye={},ve=null;function we(){return ve=ve||new ee}function Te(e){O.call(this,ye.La,e)}function Ie(e){const t=we();te(t,new Te(t))}function Ee(e,t){O.call(this,ye.STAT_EVENT,e),this.stat=t}function be(e){const t=we();te(t,new Ee(t,e))}function Ce(e,t){O.call(this,ye.Ma,e),this.size=t}function Se(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout(function(){e()},t)}function ke(){this.g=!0}function Ne(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return ce(n)}catch(a){return t}}(e,n)+(i?" "+i:"")})}ye.La="serverreachability",h(Te,O),ye.STAT_EVENT="statevent",h(Ee,O),ye.Ma="timingevent",h(Ce,O),ke.prototype.xa=function(){this.g=!1},ke.prototype.info=function(){};var Ae,Re={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function De(){}function Oe(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new oe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new xe}function xe(){this.i=null,this.g="",this.h=!1}h(De,de),De.prototype.g=function(){return new XMLHttpRequest},De.prototype.i=function(){return{}},Ae=new De;var Le={},Me={};function Ue(e,t,n){e.L=1,e.v=ct(rt(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),je(e),e.A=rt(e.v);var n=e.A,i=e.R;Array.isArray(i)||(i=[String(i)]),It(n.i,"t",i),e.C=0,n=e.j.J,e.h=new xe,e.g=un(e.j,n?t:null,!e.m),0<e.O&&(e.M=new se(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,i=e.ca;var r="readystatechange";Array.isArray(r)||(r&&(ae[0]=r.toString()),r=ae);for(var s=0;s<r.length;s++){var o=W(n,r[s],i||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?v(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ie(),function(e,t,n,i,r,s){e.info(function(){if(e.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ve(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function qe(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Me:(n=Number(t.substring(n,i)),isNaN(n)?Le:(i+=1)+n>t.length?Me:(t=t.slice(i,i+n),e.C=i+n,t))}function je(e){e.S=Date.now()+e.I,Be(e,e.I)}function Be(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Se(c(e.ba,e),t)}function ze(e){e.B&&(r.clearTimeout(e.B),e.B=null)}function $e(e){0==e.j.G||e.J||sn(e.j,e)}function He(e){ze(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,le(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function We(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Xe(n.h,e)))if(!e.K&&Xe(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(u){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;rn(n),Kt(n)}en(n),be(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=Se(c(n.Za,n),6e3));if(1>=Ye(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else an(n,11)}else if((e.K||n.g==e)&&rn(n),!p(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let c=r[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const r=c[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.L=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Je(s,s.h),s.h=null))}if(i.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,lt(i.I,i.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((i=n).qa=cn(i,i.J?i.ia:null,i.W),o.K){Ze(i.h,o);var a=o,l=i.L;l&&(a.I=l),a.B&&(ze(a),je(a)),i.g=o}else Zt(i);0<n.i.length&&Qt(n)}else"stop"!=c[0]&&"close"!=c[0]||an(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?an(n,7):Wt(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}Ie()}catch(u){}}Oe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Bt(e)?t.j():this.Y(e)},Oe.prototype.Y=function(e){try{if(e==this.g)e:{const d=Bt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||zt(this.g)))){this.J||4!=d||7==t||Ie(),ze(this);var n=this.g.Z();this.X=n;t:if(Ve(this)){var i=zt(this.g);e="";var s=i.length,o=4==Bt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){He(this),$e(this);var a="";break t}this.h.i=new r.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(o&&t==s-1)});i.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,i,r,s,o){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var l,c=this.g;if((l=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,be(12),He(this),$e(this);break e}Ne(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,We(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=qe(this,a),e==Me){4==d&&(this.s=4,be(14),n=!1),Ne(this.i,this.l,null,"[Incomplete Response]");break}if(e==Le){this.s=4,be(15),Ne(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ne(this.i,this.l,e,null),We(this,e)}if(Ve(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,be(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),tn(h),h.M=!0,be(11))}}else Ne(this.i,this.l,a,"[Invalid Chunked Response]"),He(this),$e(this)}else Ne(this.i,this.l,a,null),We(this,a);4==d&&He(this),this.o&&!this.J&&(4==d?sn(this.j,this):(this.o=!1,je(this)))}else(function(e){const t={};e=(e.g&&2<=Bt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(p(e[i]))continue;var n=I(e[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[r]||[];t[r]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,be(12)):(this.s=0,be(13)),He(this),$e(this)}}}catch(d){}},Oe.prototype.cancel=function(){this.J=!0,He(this)},Oe.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Ie(),be(17)),He(this),this.s=2,$e(this)):Be(this,this.S-e)};var Ke=class{constructor(e,t){this.g=e,this.map=t}};function Ge(e){this.l=e||10,e=r.PerformanceNavigationTiming?0<(e=r.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ye(e){return e.h?1:e.g?e.g.size:0}function Xe(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Je(e,t){e.g?e.g.add(t):e.h=t}function Ze(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function et(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return d(e.i)}function tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,o=0;o<r;o++)t.call(void 0,i[o],n&&n[o],e)}Ge.prototype.cancel=function(){if(this.i=et(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function it(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof it){this.h=e.h,st(this,e.j),this.o=e.o,this.g=e.g,ot(this,e.s),this.l=e.l;var t=e.i,n=new yt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),at(this,n),this.m=e.m}else e&&(t=String(e).match(nt))?(this.h=!1,st(this,t[1]||"",!0),this.o=ut(t[2]||""),this.g=ut(t[3]||"",!0),ot(this,t[4]),this.l=ut(t[5]||"",!0),at(this,t[6]||"",!0),this.m=ut(t[7]||"")):(this.h=!1,this.i=new yt(null,this.h))}function rt(e){return new it(e)}function st(e,t,n){e.j=n?ut(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ot(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function at(e,t,n){t instanceof yt?(e.i=t,function(e,t){t&&!e.j&&(vt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(wt(this,t),It(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=ht(t,mt)),e.i=new yt(t,e.h))}function lt(e,t,n){e.i.set(t,n)}function ct(e){return lt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ut(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ht(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,dt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function dt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}it.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ht(t,ft,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ht(t,ft,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ht(n,"/"==n.charAt(0)?gt:pt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ht(n,_t)),e.join("")};var ft=/[#\/\?@]/g,pt=/[#\?:]/g,gt=/[#\?]/g,mt=/[#\?@]/g,_t=/#/g;function yt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function vt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function wt(e,t){vt(e),t=Et(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Tt(e,t){return vt(e),t=Et(e,t),e.g.has(t)}function It(e,t,n){wt(e,t),0<n.length&&(e.i=null,e.g.set(Et(e,t),d(n)),e.h+=n.length)}function Et(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function bt(e,t,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(s){}}function Ct(){this.g=new he}function St(e,t,n){const i=n||"";try{tt(e,function(e,n){let r=e;o(e)&&(r=ce(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(r){throw t.push(i+"type="+encodeURIComponent("_badmap")),r}}function kt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Nt(e,t){ee.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function At(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Rt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Pt(e)}function Pt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Dt(e){let t="";return y(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Ot(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Dt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):lt(e,t,n))}function xt(e){ee.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=yt.prototype).add=function(e,t){vt(this),this.i=null,e=Et(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){vt(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},e.na=function(){vt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},e.V=function(e){vt(this);let t=[];if("string"==typeof e)Tt(this,e)&&(t=t.concat(this.g.get(Et(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return vt(this),this.i=null,Tt(this,e=Et(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const s=encodeURIComponent(String(i)),o=this.V(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),e.push(r)}}return this.i=e.join("&")},h(kt,de),kt.prototype.g=function(){return new Nt(this.l,this.j)},kt.prototype.i=function(e){return function(){return e}}({}),h(Nt,ee),(e=Nt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Pt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||r).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Rt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Pt(this)),this.g&&(this.readyState=3,Pt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;At(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Rt(this):Pt(this),3==this.readyState&&At(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Rt(this))},e.Qa=function(e){this.g&&(this.response=e,Rt(this))},e.ga=function(){this.g&&Rt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Nt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(xt,ee);var Lt=/^https?$/i,Mt=["POST","PUT"];function Ut(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),qt(e)}function Ft(e){e.A||(e.A=!0,te(e,"complete"),te(e,"error"))}function Vt(e){if(e.h&&void 0!==i&&(!e.v[1]||4!=Bt(e)||2!=e.Z()))if(e.u&&4==Bt(e))ie(e.Ea,0,e);else if(te(e,"readystatechange"),4==Bt(e)){e.h=!1;try{const i=e.Z();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===i){var o=String(e.D).match(nt)[1]||null;!o&&r.self&&r.self.location&&(o=r.self.location.protocol.slice(0,-1)),s=!Lt.test(o?o.toLowerCase():"")}n=s}if(n)te(e,"complete"),te(e,"success");else{e.m=6;try{var a=2<Bt(e)?e.g.statusText:""}catch(l){a=""}e.l=a+" ["+e.Z()+"]",Ft(e)}}finally{qt(e)}}}function qt(e,t){if(e.g){jt(e);const i=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||te(e,"ready");try{i.onreadystatechange=r}catch(n){}}}function jt(e){e.I&&(r.clearTimeout(e.I),e.I=null)}function Bt(e){return e.g?e.g.readyState:0}function zt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function $t(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ht(e){this.Aa=0,this.i=[],this.j=new ke,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=$t("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=$t("baseRetryDelayMs",5e3,e),this.cb=$t("retryDelaySeedMs",1e4,e),this.Wa=$t("forwardChannelMaxRetries",2,e),this.wa=$t("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Ge(e&&e.concurrentRequestLimit),this.Da=new Ct,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Wt(e){if(Gt(e),3==e.G){var t=e.U++,n=rt(e.I);if(lt(n,"SID",e.K),lt(n,"RID",t),lt(n,"TYPE","terminate"),Xt(e,n),(t=new Oe(e,e.j,t)).L=2,t.v=ct(rt(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(t.v.toString(),"")}catch(i){}!n&&r.Image&&((new Image).src=t.v,n=!0),n||(t.g=un(t.j,null),t.g.ea(t.v)),t.F=Date.now(),je(t)}ln(e)}function Kt(e){e.g&&(tn(e),e.g.cancel(),e.g=null)}function Gt(e){Kt(e),e.u&&(r.clearTimeout(e.u),e.u=null),rn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&r.clearTimeout(e.s),e.s=null)}function Qt(e){if(!Qe(e.h)&&!e.s){e.s=!0;var t=e.Ga;k||R(),N||(k(),N=!0),A.add(t,e),e.B=0}}function Yt(e,t){var n;n=t?t.l:e.U++;const i=rt(e.I);lt(i,"SID",e.K),lt(i,"RID",n),lt(i,"AID",e.T),Xt(e,i),e.m&&e.o&&Ot(i,e.m,e.o),n=new Oe(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=Jt(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),Je(e.h,n),Ue(n,i,t)}function Xt(e,t){e.H&&y(e.H,function(e,n){lt(t,n,e)}),e.l&&tt({},function(e,n){lt(t,n,e)})}function Jt(e,t,n){n=Math.min(e.i.length,n);var i=e.l?c(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let a=0;a<n;a++){let n=r[a].g;const l=r[a].map;if(n-=t,0>n)t=Math.max(0,r[a].g-100),o=!1;else try{St(l,e,"req"+n+"_")}catch(s){i&&i(l)}}if(o){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function Zt(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;k||R(),N||(k(),N=!0),A.add(t,e),e.v=0}}function en(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Se(c(e.Fa,e),on(e,e.v)),e.v++,0))}function tn(e){null!=e.A&&(r.clearTimeout(e.A),e.A=null)}function nn(e){e.g=new Oe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=rt(e.qa);lt(t,"RID","rpc"),lt(t,"SID",e.K),lt(t,"AID",e.T),lt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&lt(t,"TO",e.ja),lt(t,"TYPE","xmlhttp"),Xt(e,t),e.m&&e.o&&Ot(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=ct(rt(t)),n.m=null,n.P=!0,Fe(n,e)}function rn(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function sn(e,t){var n=null;if(e.g==t){rn(e),tn(e),e.g=null;var i=2}else{if(!Xe(e.h,t))return;n=t.D,Ze(e.h,t),i=1}if(0!=e.G)if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var r=e.B;te(i=we(),new Ce(i,n)),Qt(e)}else Zt(e);else if(3==(r=t.s)||0==r&&0<t.X||!(1==i&&function(e,t){return!(Ye(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Se(c(e.Ga,e,t),on(e,e.B)),e.B++,0)))}(e,t)||2==i&&en(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),r){case 1:an(e,5);break;case 4:an(e,10);break;case 3:an(e,6);break;default:an(e,2)}}function on(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function an(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),i=e.Xa;const t=!i;i=new it(i||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||st(i,"https"),ct(i),t?function(e,t){const n=new ke;if(r.Image){const i=new Image;i.onload=u(bt,n,"TestLoadImage: loaded",!0,t,i),i.onerror=u(bt,n,"TestLoadImage: error",!1,t,i),i.onabort=u(bt,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=u(bt,n,"TestLoadImage: timeout",!1,t,i),r.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new ke;const n=new AbortController,i=setTimeout(()=>{n.abort(),bt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?bt(0,0,!0,t):bt(0,0,!1,t)}).catch(()=>{clearTimeout(i),bt(0,0,!1,t)})}(i.toString(),n)}else be(2);e.G=0,e.l&&e.l.sa(t),ln(e),Gt(e)}function ln(e){if(e.G=0,e.ka=[],e.l){const t=et(e.h);0==t.length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra()}}function cn(e,t,n){var i=n instanceof it?rt(n):new it(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ot(i,i.s);else{var s=r.location;i=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var o=new it(null);i&&st(o,i),t&&(o.g=t),s&&ot(o,s),n&&(o.l=n),i=o}return n=e.D,t=e.ya,n&&t&&lt(i,n,t),lt(i,"VER",e.la),Xt(e,i),i}function un(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new xt(new kt({eb:n})):new xt(e.pa)).Ha(e.J),t}function hn(){}function dn(){}function fn(e,t){ee.call(this),this.g=new Ht(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!p(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!p(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new mn(this)}function pn(e){me.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function gn(){_e.call(this),this.status=1}function mn(e){this.g=e}(e=xt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ae.g(),this.v=this.o?fe(this.o):fe(Ae),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ut(this,o)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=r.FormData&&e instanceof r.FormData,!(0<=Array.prototype.indexOf.call(Mt,t,void 0))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,a]of n)this.g.setRequestHeader(r,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{jt(this),this.u=!0,this.g.send(e),this.u=!1}catch(o){Ut(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,te(this,"complete"),te(this,"abort"),qt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qt(this,!0)),xt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Vt(this):this.bb())},e.bb=function(){Vt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Bt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ue(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ht.prototype).la=8,e.G=1,e.connect=function(e,t,n,i){be(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=cn(this,null,this.W),Qt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const r=new Oe(this,this.j,e);let s=this.o;if(this.S&&(s?(s=v(s),T(s,this.S)):s=this.S),null!==this.m||this.O||(r.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Jt(this,r,t),lt(n=rt(this.I),"RID",e),lt(n,"CVER",22),this.D&&lt(n,"X-HTTP-Session-Id",this.D),Xt(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Dt(s)))+"&"+t:this.m&&Ot(n,this.m,s)),Je(this.h,r),this.Ua&&lt(n,"TYPE","init"),this.P?(lt(n,"$req",t),lt(n,"SID","null"),r.T=!0,Ue(r,n,null)):Ue(r,n,t),this.G=2}}else 3==this.G&&(e?Yt(this,e):0==this.i.length||Qe(this.h)||Yt(this))},e.Fa=function(){if(this.u=null,nn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Se(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,be(10),Kt(this),nn(this))},e.Za=function(){null!=this.C&&(this.C=null,Kt(this),en(this),be(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=hn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},dn.prototype.g=function(e,t){return new fn(e,t)},h(fn,ee),fn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},fn.prototype.close=function(){Wt(this.g)},fn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ce(e),e=n);t.i.push(new Ke(t.Ya++,e)),3==t.G&&Qt(t)},fn.prototype.N=function(){this.g.l=null,delete this.j,Wt(this.g),delete this.g,fn.aa.N.call(this)},h(pn,me),h(gn,_e),h(mn,hn),mn.prototype.ua=function(){te(this.g,"a")},mn.prototype.ta=function(e){te(this.g,new pn(e))},mn.prototype.sa=function(e){te(this.g,new gn)},mn.prototype.ra=function(){te(this.g,"b")},dn.prototype.createWebChannel=dn.prototype.g,fn.prototype.send=fn.prototype.o,fn.prototype.open=fn.prototype.m,fn.prototype.close=fn.prototype.close,is=function(){return new dn},ns=function(){return we()},ts=ye,es={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Re.NO_ERROR=0,Re.TIMEOUT=8,Re.HTTP_ERROR=6,Zr=Re,Pe.COMPLETE="complete",Jr=Pe,pe.EventType=ge,ge.OPEN="a",ge.CLOSE="b",ge.ERROR="c",ge.MESSAGE="d",ee.prototype.listen=ee.prototype.K,Xr=pe,xt.prototype.listenOnce=xt.prototype.L,xt.prototype.getLastError=xt.prototype.Ka,xt.prototype.getLastErrorCode=xt.prototype.Ba,xt.prototype.getStatus=xt.prototype.Z,xt.prototype.getResponseJson=xt.prototype.Oa,xt.prototype.getResponseText=xt.prototype.oa,xt.prototype.send=xt.prototype.ea,xt.prototype.setWithCredentials=xt.prototype.Ha,Yr=xt}).apply(void 0!==rs?rs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ss="@firebase/firestore",os="4.9.0";class as{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}as.UNAUTHENTICATED=new as(null),as.GOOGLE_CREDENTIALS=new as("google-credentials-uid"),as.FIRST_PARTY=new as("first-party-uid"),as.MOCK_USER=new as("mock-user");let ls="12.0.0";const cs=new Ee("@firebase/firestore");function us(){return cs.logLevel}function hs(e,...t){if(cs.logLevel<=_e.DEBUG){const n=t.map(ps);cs.debug(`Firestore (${ls}): ${e}`,...n)}}function ds(e,...t){if(cs.logLevel<=_e.ERROR){const n=t.map(ps);cs.error(`Firestore (${ls}): ${e}`,...n)}}function fs(e,...t){if(cs.logLevel<=_e.WARN){const n=t.map(ps);cs.warn(`Firestore (${ls}): ${e}`,...n)}}function ps(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(n){return e}var t}function gs(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,ms(e,i,n)}function ms(e,t,n){let i=`FIRESTORE (${ls}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(r){i+=" CONTEXT: "+n}throw ds(i),new Error(i)}function _s(e,t,n,i){let r="Unexpected state";"string"==typeof n?r=n:i=n,e||ms(t,r,i)}function ys(e,t){return e}const vs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ws extends H{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ts{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Is{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Es{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(as.UNAUTHENTICATED))}shutdown(){}}class bs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Cs{constructor(e){this.t=e,this.currentUser=as.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){_s(void 0===this.o,42304);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new Ts;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Ts,e.enqueueRetryable(()=>i(this.currentUser))};const s=()=>{const t=r;e.enqueueRetryable(()=>f(this,null,function*(){yield t.promise,yield i(this.currentUser)}))},o=e=>{hs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(hs("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Ts)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(hs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(_s("string"==typeof t.accessToken,31837,{l:t}),new Is(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return _s(null===e||"string"==typeof e,2055,{h:e}),new as(e)}}class Ss{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=as.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ks{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Ss(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(as.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ns{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class As{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,bt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){_s(void 0===this.o,3512);const n=e=>{null!=e.error&&hs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,hs("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const i=e=>{hs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?i(e):hs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ns(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(_s("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Ns(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Rs(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}class Ps{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Rs(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function Ds(e,t){return e<t?-1:e>t?1:0}function Os(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.charAt(i),r=t.charAt(i);if(n!==r)return Ms(n)===Ms(r)?Ds(n,r):Ms(n)?1:-1}return Ds(e.length,t.length)}const xs=55296,Ls=57343;function Ms(e){const t=e.charCodeAt(0);return t>=xs&&t<=Ls}function Us(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}const Fs="__name__";class Vs{constructor(e,t,n){void 0===t?t=0:t>e.length&&gs(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&gs(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Vs.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Vs?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=Vs.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return Ds(e.length,t.length)}static compareSegments(e,t){const n=Vs.isNumericId(e),i=Vs.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?Vs.extractNumericId(e).compare(Vs.extractNumericId(t)):Os(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Kr.fromString(e.substring(4,e.length-2))}}class qs extends Vs{construct(e,t,n){return new qs(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new ws(vs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new qs(t)}static emptyPath(){return new qs([])}}const js=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Bs extends Vs{construct(e,t,n){return new Bs(e,t,n)}static isValidIdentifier(e){return js.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Bs.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Fs}static keyField(){return new Bs([Fs])}static fromServerFormat(e){const t=[];let n="",i=0;const r=()=>{if(0===n.length)throw new ws(vs.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new ws(vs.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ws(vs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(s=!s,i++):"."!==t||s?(n+=t,i++):(r(),i++)}if(r(),s)throw new ws(vs.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Bs(t)}static emptyPath(){return new Bs([])}}class zs{constructor(e){this.path=e}static fromPath(e){return new zs(qs.fromString(e))}static fromName(e){return new zs(qs.fromString(e).popFirst(5))}static empty(){return new zs(qs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===qs.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return qs.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new zs(new qs(e.slice()))}}function $s(e,t,n){if(!n)throw new ws(vs.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Hs(e){if(!zs.isDocumentKey(e))throw new ws(vs.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ws(e){if(zs.isDocumentKey(e))throw new ws(vs.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ks(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Gs(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":gs(12329,{type:typeof e})}function Qs(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ws(vs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Gs(e);throw new ws(vs.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Ys(e,t){const n={typeString:e};return t&&(n.value=t),n}function Xs(e,t){if(!Ks(e))throw new ws(vs.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in t)if(t[i]){const r=t[i].typeString,s="value"in t[i]?{value:t[i].value}:void 0;if(!(i in e)){n=`JSON missing required field: '${i}'`;break}const o=e[i];if(r&&typeof o!==r){n=`JSON field '${i}' must be a ${r}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${i}' field to equal '${s.value}'`;break}}if(n)throw new ws(vs.INVALID_ARGUMENT,n);return!0}const Js=-62135596800,Zs=1e6;class eo{static now(){return eo.fromMillis(Date.now())}static fromDate(e){return eo.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Zs);return new eo(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ws(vs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ws(vs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Js)throw new ws(vs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ws(vs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Zs}_compareTo(e){return this.seconds===e.seconds?Ds(this.nanoseconds,e.nanoseconds):Ds(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:eo._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Xs(e,eo._jsonSchema))return new eo(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Js;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}eo._jsonSchemaVersion="firestore/timestamp/1.0",eo._jsonSchema={type:Ys("string",eo._jsonSchemaVersion),seconds:Ys("number"),nanoseconds:Ys("number")};class to{static fromTimestamp(e){return new to(e)}static min(){return new to(new eo(0,0))}static max(){return new to(new eo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function no(e){return new io(e.readTime,e.key,-1)}class io{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new io(to.min(),zs.empty(),-1)}static max(){return new io(to.max(),zs.empty(),-1)}}function ro(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=zs.comparator(e.documentKey,t.documentKey),0!==n?n:Ds(e.largestBatchId,t.largestBatchId))}class so{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function oo(e){return f(this,null,function*(){if(e.code!==vs.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;hs("LocalStore","Unexpectedly lost primary lease")})}class ao{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&gs(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ao((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ao?t:ao.resolve(t)}catch(t){return ao.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ao.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ao.reject(t)}static resolve(e){return new ao((t,n)=>{t(e)})}static reject(e){return new ao((t,n)=>{n(e)})}static waitFor(e){return new ao((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=ao.resolve(!1);for(const n of e)t=t.next(e=>e?ao.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new ao((n,i)=>{const r=e.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const l=a;t(e[l]).next(e=>{s[l]=e,++o,o===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new ao((n,i)=>{const r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}function lo(e){return"IndexedDbTransactionError"===e.name}class co{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}function uo(e){return null==e}function ho(e){return 0===e&&1/e==-1/0}function fo(e,t){let n=t;const i=e.length;for(let r=0;r<i;r++){const t=e.charAt(r);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function po(e){return e+""}function go(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function mo(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function _o(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}co.ce=-1;let yo=class e{constructor(e,t){this.comparator=e,this.root=t||wo.EMPTY}insert(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,wo.BLACK,null,null))}remove(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,wo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vo(this.root,e,this.comparator,!1)}getReverseIterator(){return new vo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vo(this.root,e,this.comparator,!0)}},vo=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},wo=class e{constructor(t,n,i,r,s){this.key=t,this.value=n,this.color=null!=i?i:e.RED,this.left=null!=r?r:e.EMPTY,this.right=null!=s?s:e.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,i,r,s){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=i?i:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return e.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let i,r=this;if(n(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,n),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===n(t,r.key)){if(r.right.isEmpty())return e.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,n))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw gs(43730,{key:this.key,value:this.value});if(this.right.isRed())throw gs(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw gs(27949);return e+(this.isRed()?0:1)}};wo.EMPTY=null,wo.RED=!0,wo.BLACK=!1,wo.EMPTY=new class{constructor(){this.size=0}get key(){throw gs(57766)}get value(){throw gs(16141)}get color(){throw gs(16727)}get left(){throw gs(29726)}get right(){throw gs(36894)}copy(e,t,n,i,r){return this}insert(e,t,n){return new wo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class To{constructor(e){this.comparator=e,this.data=new yo(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Io(this.data.getIterator())}getIteratorFrom(e){return new Io(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof To))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new To(this.comparator);return t.data=e,t}}class Io{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Eo{constructor(e){this.fields=e,e.sort(Bs.comparator)}static empty(){return new Eo([])}unionWith(e){let t=new To(Bs.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Eo(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Us(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class bo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Co{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new bo("Invalid base64 string: "+t):t}}(e);return new Co(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Co(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ds(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Co.EMPTY_BYTE_STRING=new Co("");const So=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ko(e){if(_s(!!e,39018),"string"==typeof e){let t=0;const n=So.exec(e);if(_s(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:No(e.seconds),nanos:No(e.nanos)}}function No(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ao(e){return"string"==typeof e?Co.fromBase64String(e):Co.fromUint8Array(e)}const Ro="server_timestamp",Po="__type__",Do="__previous_value__",Oo="__local_write_time__";function xo(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[Po])?void 0:n.stringValue)===Ro}function Lo(e){const t=e.mapValue.fields[Do];return xo(t)?Lo(t):t}function Mo(e){const t=ko(e.mapValue.fields[Oo].timestampValue);return new eo(t.seconds,t.nanos)}class Uo{constructor(e,t,n,i,r,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=c}}const Fo="(default)";class Vo{constructor(e,t){this.projectId=e,this.database=t||Fo}static empty(){return new Vo("","")}get isDefaultDatabase(){return this.database===Fo}isEqual(e){return e instanceof Vo&&e.projectId===this.projectId&&e.database===this.database}}const qo="__type__",jo={},Bo="__vector__",zo="value";function $o(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?xo(e)?4:function(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}(e)?9007199254740991:function(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[qo])?void 0:n.stringValue)===Bo}(e)?10:11:gs(28295,{value:e})}function Ho(e,t){if(e===t)return!0;const n=$o(e);if(n!==$o(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Mo(e).isEqual(Mo(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=ko(e.timestampValue),i=ko(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return i=t,Ao(e.bytesValue).isEqual(Ao(i.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return No(e.geoPointValue.latitude)===No(t.geoPointValue.latitude)&&No(e.geoPointValue.longitude)===No(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return No(e.integerValue)===No(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=No(e.doubleValue),i=No(t.doubleValue);return n===i?ho(n)===ho(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Us(e.arrayValue.values||[],t.arrayValue.values||[],Ho);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(go(n)!==go(i))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===i[r]||!Ho(n[r],i[r])))return!1;return!0}(e,t);default:return gs(52216,{left:e})}var i}function Wo(e,t){return void 0!==(e.values||[]).find(e=>Ho(e,t))}function Ko(e,t){if(e===t)return 0;const n=$o(e),i=$o(t);if(n!==i)return Ds(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ds(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=No(e.integerValue||e.doubleValue),i=No(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return Go(e.timestampValue,t.timestampValue);case 4:return Go(Mo(e),Mo(t));case 5:return Os(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ao(e),i=Ao(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let r=0;r<n.length&&r<i.length;r++){const e=Ds(n[r],i[r]);if(0!==e)return e}return Ds(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ds(No(e.latitude),No(t.latitude));return 0!==n?n:Ds(No(e.longitude),No(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Qo(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,i,r,s;const o=e.fields||{},a=t.fields||{},l=null==(n=o[zo])?void 0:n.arrayValue,c=null==(i=a[zo])?void 0:i.arrayValue,u=Ds((null==(r=null==l?void 0:l.values)?void 0:r.length)||0,(null==(s=null==c?void 0:c.values)?void 0:s.length)||0);return 0!==u?u:Qo(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===jo&&t===jo)return 0;if(e===jo)return 1;if(t===jo)return-1;const n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let o=0;o<i.length&&o<s.length;++o){const e=Os(i[o],s[o]);if(0!==e)return e;const t=Ko(n[i[o]],r[s[o]]);if(0!==t)return t}return Ds(i.length,s.length)}(e.mapValue,t.mapValue);default:throw gs(23264,{he:n})}}function Go(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ds(e,t);const n=ko(e),i=ko(t),r=Ds(n.seconds,i.seconds);return 0!==r?r:Ds(n.nanos,i.nanos)}function Qo(e,t){const n=e.values||[],i=t.values||[];for(let r=0;r<n.length&&r<i.length;++r){const e=Ko(n[r],i[r]);if(e)return e}return Ds(n.length,i.length)}function Yo(e){return Xo(e)}function Xo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=ko(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ao(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,zs.fromName(t).toString()):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=Xo(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const r of t)i?i=!1:n+=",",n+=`${r}:${Xo(e.fields[r])}`;return n+"}"}(e.mapValue):gs(61005,{value:e});var t}function Jo(e){switch($o(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Lo(e);return t?16+Jo(t):16;case 5:return 2*e.stringValue.length;case 6:return Ao(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+Jo(t),0);case 10:case 11:return function(e){let t=0;return mo(e.fields,(e,n)=>{t+=e.length+Jo(n)}),t}(e.mapValue);default:throw gs(13486,{value:e})}}function Zo(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ea(e){return!!e&&"integerValue"in e}function ta(e){return!!e&&"arrayValue"in e}function na(e){return!!e&&"nullValue"in e}function ia(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ra(e){return!!e&&"mapValue"in e}function sa(e){if(e.geoPointValue)return{geoPointValue:c({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:c({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return mo(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=sa(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=sa(e.arrayValue.values[n]);return t}return c({},e)}class oa{constructor(e){this.value=e}static empty(){return new oa({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ra(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sa(t)}setAll(e){let t=Bs.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=sa(e):i.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){const t=this.field(e.popLast());ra(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ho(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];ra(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){mo(t,(t,n)=>e[t]=n);for(const i of n)delete e[i]}clone(){return new oa(sa(this.value))}}function aa(e){const t=[];return mo(e.fields,(e,n)=>{const i=new Bs([e]);if(ra(n)){const e=aa(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)}),new Eo(t)}class la{constructor(e,t,n,i,r,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new la(e,0,to.min(),to.min(),to.min(),oa.empty(),0)}static newFoundDocument(e,t,n,i){return new la(e,1,t,to.min(),n,i,0)}static newNoDocument(e,t){return new la(e,2,t,to.min(),to.min(),oa.empty(),0)}static newUnknownDocument(e,t){return new la(e,3,t,to.min(),to.min(),oa.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(to.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=oa.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=oa.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=to.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof la&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new la(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ca{constructor(e,t){this.position=e,this.inclusive=t}}function ua(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){const s=t[r],o=e.position[r];if(i=s.field.isKeyField()?zs.comparator(zs.fromName(o.referenceValue),n.key):Ko(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function ha(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ho(e.position[n],t.position[n]))return!1;return!0}class da{constructor(e,t="asc"){this.field=e,this.dir=t}}function fa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class pa{}class ga extends pa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ia(e,t,n):"array-contains"===t?new Sa(e,n):"in"===t?new ka(e,n):"not-in"===t?new Na(e,n):"array-contains-any"===t?new Aa(e,n):new ga(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ea(e,n):new ba(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Ko(t,this.value)):null!==t&&$o(this.value)===$o(t)&&this.matchesComparison(Ko(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return gs(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ma extends pa{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ma(e,t)}matches(e){return _a(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function _a(e){return"and"===e.op}function ya(e){return function(e){for(const t of e.filters)if(t instanceof ma)return!1;return!0}(e)&&_a(e)}function va(e){if(e instanceof ga)return e.field.canonicalString()+e.op.toString()+Yo(e.value);if(ya(e))return e.filters.map(e=>va(e)).join(",");{const t=e.filters.map(e=>va(e)).join(",");return`${e.op}(${t})`}}function wa(e,t){return e instanceof ga?(n=e,(i=t)instanceof ga&&n.op===i.op&&n.field.isEqual(i.field)&&Ho(n.value,i.value)):e instanceof ma?function(e,t){return t instanceof ma&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,i)=>e&&wa(n,t.filters[i]),!0)}(e,t):void gs(19439);var n,i}function Ta(e){return e instanceof ga?`${(t=e).field.canonicalString()} ${t.op} ${Yo(t.value)}`:e instanceof ma?function(e){return e.op.toString()+" {"+e.getFilters().map(Ta).join(" ,")+"}"}(e):"Filter";var t}class Ia extends ga{constructor(e,t,n){super(e,t,n),this.key=zs.fromName(n.referenceValue)}matches(e){const t=zs.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ea extends ga{constructor(e,t){super(e,"in",t),this.keys=Ca(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ba extends ga{constructor(e,t){super(e,"not-in",t),this.keys=Ca(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ca(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>zs.fromName(e.referenceValue))}class Sa extends ga{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ta(t)&&Wo(t.arrayValue,this.value)}}class ka extends ga{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Wo(this.value.arrayValue,t)}}class Na extends ga{constructor(e,t){super(e,"not-in",t)}matches(e){if(Wo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Wo(this.value.arrayValue,t)}}class Aa extends ga{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ta(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Wo(this.value.arrayValue,e))}}class Ra{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.Te=null}}function Pa(e,t=null,n=[],i=[],r=null,s=null,o=null){return new Ra(e,t,n,i,r,s,o)}function Da(e){const t=ys(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>va(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),uo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Yo(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Yo(e)).join(",")),t.Te=e}return t.Te}function Oa(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!fa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!wa(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ha(e.startAt,t.startAt)&&ha(e.endAt,t.endAt)}function xa(e){return zs.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class La{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ma(e){return new La(e)}function Ua(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Fa(e){return null!==e.collectionGroup}function Va(e){const t=ys(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new To(Bs.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new da(i,n))}),e.has(Bs.keyField().canonicalString())||t.Ie.push(new da(Bs.keyField(),n))}return t.Ie}function qa(e){const t=ys(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return Pa(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new da(e.field,t)});const n=e.endAt?new ca(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new ca(e.startAt.position,e.startAt.inclusive):null;return Pa(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(t,Va(e))),t.Ee}function ja(e,t){const n=e.filters.concat([t]);return new La(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ba(e,t,n){return new La(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function za(e,t){return Oa(qa(e),qa(t))&&e.limitType===t.limitType}function $a(e){return`${Da(qa(e))}|lt:${e.limitType}`}function Ha(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>Ta(e)).join(", ")}]`),uo(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Yo(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Yo(e)).join(",")),`Target(${t})`}(qa(e))}; limitType=${e.limitType})`}function Wa(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):zs.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Va(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(i=t,!((n=e).startAt&&!function(e,t,n){const i=ua(e,t,n);return e.inclusive?i<=0:i<0}(n.startAt,Va(n),i)||n.endAt&&!function(e,t,n){const i=ua(e,t,n);return e.inclusive?i>=0:i>0}(n.endAt,Va(n),i)));var n,i}function Ka(e){return(t,n)=>{let i=!1;for(const r of Va(e)){const e=Ga(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}function Ga(e,t,n){const i=e.field.isKeyField()?zs.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?Ko(i,r):gs(42886)}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return gs(19790,{direction:e.dir})}}class Qa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,r]of n)if(this.equalsFn(i,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return void(i[r]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){mo(this.inner,(t,n)=>{for(const[i,r]of n)e(i,r)})}isEmpty(){return _o(this.inner)}size(){return this.innerSize}}const Ya=new yo(zs.comparator);function Xa(){return Ya}const Ja=new yo(zs.comparator);function Za(...e){let t=Ja;for(const n of e)t=t.insert(n.key,n);return t}function el(e){let t=Ja;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function tl(){return il()}function nl(){return il()}function il(){return new Qa(e=>e.toString(),(e,t)=>e.isEqual(t))}const rl=new yo(zs.comparator),sl=new To(zs.comparator);function ol(...e){let t=sl;for(const n of e)t=t.add(n);return t}const al=new To(Ds);function ll(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ho(t)?"-0":t}}function cl(e){return{integerValue:""+e}}function ul(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!ho(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?cl(t):ll(e,t)}class hl{constructor(){this._=void 0}}function dl(e,t,n){return e instanceof gl?function(e,t){const n={fields:{[Po]:{stringValue:Ro},[Oo]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&xo(t)&&(t=Lo(t)),t&&(n.fields[Do]=t),{mapValue:n}}(n,t):e instanceof ml?_l(e,t):e instanceof yl?vl(e,t):function(e,t){const n=pl(e,t),i=Tl(n)+Tl(e.Ae);return ea(n)&&ea(e.Ae)?cl(i):ll(e.serializer,i)}(e,t)}function fl(e,t,n){return e instanceof ml?_l(e,t):e instanceof yl?vl(e,t):n}function pl(e,t){return e instanceof wl?ea(n=t)||(i=n)&&"doubleValue"in i?t:{integerValue:0}:null;var n,i}class gl extends hl{}class ml extends hl{constructor(e){super(),this.elements=e}}function _l(e,t){const n=Il(t);for(const i of e.elements)n.some(e=>Ho(e,i))||n.push(i);return{arrayValue:{values:n}}}class yl extends hl{constructor(e){super(),this.elements=e}}function vl(e,t){let n=Il(t);for(const i of e.elements)n=n.filter(e=>!Ho(e,i));return{arrayValue:{values:n}}}class wl extends hl{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Tl(e){return No(e.integerValue||e.doubleValue)}function Il(e){return ta(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class El{constructor(e,t){this.field=e,this.transform=t}}class bl{constructor(e,t){this.version=e,this.transformResults=t}}class Cl{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Cl}static exists(e){return new Cl(void 0,e)}static updateTime(e){return new Cl(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Sl(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class kl{}function Nl(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Fl(e.key,Cl.none()):new Ol(e.key,e.data,Cl.none());{const n=e.data,i=oa.empty();let r=new To(Bs.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new xl(e.key,i,new Eo(r.toArray()),Cl.none())}}function Al(e,t,n){var i;e instanceof Ol?function(e,t,n){const i=e.value.clone(),r=Ml(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof xl?function(e,t,n){if(!Sl(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=Ml(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Ll(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):(i=n,t.convertToNoDocument(i.version).setHasCommittedMutations())}function Rl(e,t,n,i){return e instanceof Ol?function(e,t,n,i){if(!Sl(e.precondition,t))return n;const r=e.value.clone(),s=Ul(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof xl?function(e,t,n,i){if(!Sl(e.precondition,t))return n;const r=Ul(e.fieldTransforms,i,t),s=t.data;return s.setAll(Ll(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):(r=t,s=n,Sl(e.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):s);var r,s}function Pl(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),r=pl(i.transform,e||null);null!=r&&(null===n&&(n=oa.empty()),n.set(i.field,r))}return n||null}function Dl(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||n&&i&&Us(n,i,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof ml&&i instanceof ml||n instanceof yl&&i instanceof yl?Us(n.elements,i.elements,Ho):n instanceof wl&&i instanceof wl?Ho(n.Ae,i.Ae):n instanceof gl&&i instanceof gl);var n,i}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,i}class Ol extends kl{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class xl extends kl{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Ll(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}}),t}function Ml(e,t,n){const i=new Map;_s(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let r=0;r<n.length;r++){const s=e[r],o=s.transform,a=t.data.field(s.field);i.set(s.field,fl(o,a,n[r]))}return i}function Ul(e,t,n){const i=new Map;for(const r of e){const e=r.transform,s=n.data.field(r.field);i.set(r.field,dl(e,s,t))}return i}class Fl extends kl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Vl extends kl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ql{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&Al(t,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Rl(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Rl(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=nl();return this.mutations.forEach(i=>{const r=e.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=t.has(i.key)?null:o;const a=Nl(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(to.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ol())}isEqual(e){return this.batchId===e.batchId&&Us(this.mutations,e.mutations,(e,t)=>Dl(e,t))&&Us(this.baseMutations,e.baseMutations,(e,t)=>Dl(e,t))}}class jl{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){_s(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let i=function(){return rl}();const r=e.mutations;for(let s=0;s<r.length;s++)i=i.insert(r[s].key,n[s].version);return new jl(e,t,n,i)}}class Bl{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class zl{constructor(e,t){this.count=e,this.unchangedNames=t}}var $l,Hl;function Wl(e){if(void 0===e)return ds("GRPC error has no .code"),vs.UNKNOWN;switch(e){case $l.OK:return vs.OK;case $l.CANCELLED:return vs.CANCELLED;case $l.UNKNOWN:return vs.UNKNOWN;case $l.DEADLINE_EXCEEDED:return vs.DEADLINE_EXCEEDED;case $l.RESOURCE_EXHAUSTED:return vs.RESOURCE_EXHAUSTED;case $l.INTERNAL:return vs.INTERNAL;case $l.UNAVAILABLE:return vs.UNAVAILABLE;case $l.UNAUTHENTICATED:return vs.UNAUTHENTICATED;case $l.INVALID_ARGUMENT:return vs.INVALID_ARGUMENT;case $l.NOT_FOUND:return vs.NOT_FOUND;case $l.ALREADY_EXISTS:return vs.ALREADY_EXISTS;case $l.PERMISSION_DENIED:return vs.PERMISSION_DENIED;case $l.FAILED_PRECONDITION:return vs.FAILED_PRECONDITION;case $l.ABORTED:return vs.ABORTED;case $l.OUT_OF_RANGE:return vs.OUT_OF_RANGE;case $l.UNIMPLEMENTED:return vs.UNIMPLEMENTED;case $l.DATA_LOSS:return vs.DATA_LOSS;default:return gs(39323,{code:e})}}(Hl=$l||($l={}))[Hl.OK=0]="OK",Hl[Hl.CANCELLED=1]="CANCELLED",Hl[Hl.UNKNOWN=2]="UNKNOWN",Hl[Hl.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Hl[Hl.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Hl[Hl.NOT_FOUND=5]="NOT_FOUND",Hl[Hl.ALREADY_EXISTS=6]="ALREADY_EXISTS",Hl[Hl.PERMISSION_DENIED=7]="PERMISSION_DENIED",Hl[Hl.UNAUTHENTICATED=16]="UNAUTHENTICATED",Hl[Hl.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Hl[Hl.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Hl[Hl.ABORTED=10]="ABORTED",Hl[Hl.OUT_OF_RANGE=11]="OUT_OF_RANGE",Hl[Hl.UNIMPLEMENTED=12]="UNIMPLEMENTED",Hl[Hl.INTERNAL=13]="INTERNAL",Hl[Hl.UNAVAILABLE=14]="UNAVAILABLE",Hl[Hl.DATA_LOSS=15]="DATA_LOSS";const Kl=new Kr([4294967295,4294967295],0);function Gl(e){const t=(new TextEncoder).encode(e),n=new Gr;return n.update(t),new Uint8Array(n.digest())}function Ql(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Kr([n,i],0),new Kr([r,s],0)]}class Yl{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Xl(`Invalid padding: ${t}`);if(n<0)throw new Xl(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Xl(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Xl(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Kr.fromNumber(this.ge)}ye(e,t,n){let i=e.add(t.multiply(Kr.fromNumber(n)));return 1===i.compare(Kl)&&(i=new Kr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Gl(e),[n,i]=Ql(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,i,r);if(!this.we(e))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),s=new Yl(r,i,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.ge)return;const t=Gl(e),[n,i]=Ql(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,i,r);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Xl extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Jl{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Zl.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Jl(to.min(),i,new yo(Ds),Xa(),ol())}}class Zl{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Zl(n,t,ol(),ol(),ol())}}class ec{constructor(e,t,n,i){this.be=e,this.removedTargetIds=t,this.key=n,this.De=i}}class tc{constructor(e,t){this.targetId=e,this.Ce=t}}class nc{constructor(e,t,n=Co.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class ic{constructor(){this.ve=0,this.Fe=oc(),this.Me=Co.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ol(),t=ol(),n=ol();return this.Fe.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:gs(38017,{changeType:r})}}),new Zl(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=oc()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,_s(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class rc{constructor(e){this.Ge=e,this.ze=new Map,this.je=Xa(),this.Je=sc(),this.He=sc(),this.Ye=new yo(Ds)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:gs(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,i=this.ot(t);if(i){const r=i.target;if(xa(r))if(0===n){const e=new zs(r.path);this.et(t,e,la.newNoDocument(e,to.min()))}else _s(1===n,20013,{expectedCount:n});else{const i=this._t(t);if(i!==n){const n=this.ut(e),r=n?this.ct(n,e,i):1;if(0!==r){this.it(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:r=0}=t;let s,o;try{s=Ao(n).toUint8Array()}catch(a){if(a instanceof bo)return fs("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{o=new Yl(s,i,r)}catch(a){return fs(a instanceof Xl?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let i=0;return n.forEach(n=>{const r=this.Ge.ht(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),i++)}),i}Tt(e){const t=new Map;this.ze.forEach((n,i)=>{const r=this.ot(i);if(r){if(n.current&&xa(r.target)){const t=new zs(r.target.path);this.It(t).has(i)||this.Et(i,t)||this.et(i,t,la.newNoDocument(t,e))}n.Be&&(t.set(i,n.ke()),n.qe())}});let n=ol();this.He.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const i=new Jl(e,t,this.Ye,this.je,n);return this.je=Xa(),this.Je=sc(),this.He=sc(),this.Ye=new yo(Ds),i}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const i=this.nt(e);this.Et(e,t)?i.Qe(t,1):i.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ic,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new To(Ds),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new To(Ds),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||hs("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ic),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function sc(){return new yo(zs.comparator)}function oc(){return new yo(zs.comparator)}const ac=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),lc=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),cc=(()=>({and:"AND",or:"OR"}))();class uc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function hc(e,t){return e.useProto3Json||uo(t)?t:{value:t}}function dc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function fc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function pc(e,t){return dc(e,t.toTimestamp())}function gc(e){return _s(!!e,49232),to.fromTimestamp(function(e){const t=ko(e);return new eo(t.seconds,t.nanos)}(e))}function mc(e,t){return _c(e,t).canonicalString()}function _c(e,t){const n=(i=e,new qs(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===t?n:n.child(t)}function yc(e){const t=qs.fromString(e);return _s(Mc(t),10190,{key:t.toString()}),t}function vc(e,t){return mc(e.databaseId,t.path)}function wc(e,t){const n=yc(t);if(n.get(1)!==e.databaseId.projectId)throw new ws(vs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ws(vs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new zs(Ec(n))}function Tc(e,t){return mc(e.databaseId,t)}function Ic(e){return new qs(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ec(e){return _s(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function bc(e,t,n){return{name:vc(e,t),fields:n.value.mapValue.fields}}function Cc(e,t){return{documents:[Tc(e,t.path)]}}function Sc(e,t){const n={structuredQuery:{}},i=t.path;let r;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=Tc(e,r);const s=function(e){if(0!==e.length)return xc(ma.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map(e=>{return{field:Dc((t=e).field),direction:Ac(t.dir)};var t})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=hc(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt={before:(l=t.startAt).inclusive,values:l.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:r};var l}function kc(e){let t=function(e){const t=yc(e);return 4===t.length?qs.emptyPath():Ec(t)}(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){_s(1===i,65062);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Nc(e);return t instanceof ma&&ya(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>{return new da(Oc((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,uo(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new ca(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new ca(n,t)}(n.endAt)),function(e,t,n,i,r,s,o,a){return new La(e,t,n,i,r,"F",o,a)}(t,r,o,s,a,0,l,c)}function Nc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Oc(e.unaryFilter.field);return ga.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Oc(e.unaryFilter.field);return ga.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Oc(e.unaryFilter.field);return ga.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Oc(e.unaryFilter.field);return ga.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return gs(61313);default:return gs(60726)}}(e):void 0!==e.fieldFilter?(t=e,ga.create(Oc(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return gs(58110);default:return gs(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return ma.create(e.compositeFilter.filters.map(e=>Nc(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return gs(1026)}}(e.compositeFilter.op))}(e):gs(30097,{filter:e});var t}function Ac(e){return ac[e]}function Rc(e){return lc[e]}function Pc(e){return cc[e]}function Dc(e){return{fieldPath:e.canonicalString()}}function Oc(e){return Bs.fromServerFormat(e.fieldPath)}function xc(e){return e instanceof ga?function(e){if("=="===e.op){if(ia(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NAN"}};if(na(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ia(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NOT_NAN"}};if(na(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dc(e.field),op:Rc(e.op),value:e.value}}}(e):e instanceof ma?function(e){const t=e.getFilters().map(e=>xc(e));return 1===t.length?t[0]:{compositeFilter:{op:Pc(e.op),filters:t}}}(e):gs(54877,{filter:e})}function Lc(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Mc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Uc{constructor(e,t,n,i,r=to.min(),s=to.min(),o=Co.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Uc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Fc{constructor(e){this.yt=e}}function Vc(e){const t=kc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ba(t,t.limit,"L"):t}class qc{constructor(){this.Cn=new jc}addToCollectionParentIndex(e,t){return this.Cn.add(t),ao.resolve()}getCollectionParents(e,t){return ao.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ao.resolve()}deleteFieldIndex(e,t){return ao.resolve()}deleteAllFieldIndexes(e){return ao.resolve()}createTargetIndexes(e,t){return ao.resolve()}getDocumentsMatchingTarget(e,t){return ao.resolve(null)}getIndexType(e,t){return ao.resolve(0)}getFieldIndexes(e,t){return ao.resolve([])}getNextCollectionGroupToUpdate(e){return ao.resolve(null)}getMinOffset(e,t){return ao.resolve(io.min())}getMinOffsetFromCollectionGroup(e,t){return ao.resolve(io.min())}updateCollectionGroup(e,t,n){return ao.resolve()}updateIndexEntries(e,t){return ao.resolve()}}class jc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new To(qs.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new To(qs.comparator)).toArray()}}const Bc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zc=41943040;class $c{static withCacheSize(e){return new $c(e,$c.DEFAULT_COLLECTION_PERCENTILE,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}$c.DEFAULT_COLLECTION_PERCENTILE=10,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$c.DEFAULT=new $c(zc,$c.DEFAULT_COLLECTION_PERCENTILE,$c.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$c.DISABLED=new $c(-1,0,0);class Hc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Hc(0)}static cr(){return new Hc(-1)}}const Wc="LruGarbageCollector";function Kc([e,t],[n,i]){const r=Ds(e,n);return 0===r?Ds(t,i):r}class Gc{constructor(e){this.Ir=e,this.buffer=new To(Kc),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Kc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Qc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){hs(Wc,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>f(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){lo(e)?hs(Wc,"Ignoring IndexedDB error during garbage collection: ",e):yield oo(e)}yield this.Vr(3e5)}))}}class Yc{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ao.resolve(co.ce);const n=new Gc(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(hs("LruGarbageCollector","Garbage collection skipped; disabled"),ao.resolve(Bc)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(hs("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bc):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,i,r,s,o,a,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(hs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,s=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),us()<=_e.DEBUG&&hs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-c}ms\n\tDetermined least recently used ${i} in `+(o-s)+`ms\n\tRemoved ${r} targets in `+(a-o)+`ms\n\tRemoved ${e} documents in `+(l-a)+`ms\nTotal Duration: ${l-c}ms`),ao.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:e})))}}class Xc{constructor(){this.changes=new Qa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,la.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ao.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Jc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Zc{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Rl(n.mutation,e,Eo.empty(),eo.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,ol()).next(()=>t))}getLocalViewOfDocuments(e,t,n=ol()){const i=tl();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=Za();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=tl();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,ol()))}populateOverlays(e,t,n){const i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=Xa();const s=il(),o=il();return t.forEach((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof xl)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Rl(o.mutation,t,o.mutation.getFieldMask(),eo.now())):s.set(t.key,Eo.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Jc(t,null!=(n=s.get(e))?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=il();let i=new yo((e,t)=>e-t),r=ol();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Eo.empty();o=r.applyToLocalView(s,o),n.set(e,o);const a=(i.get(r.batchId)||ol()).add(e);i=i.insert(r.batchId,a)})}).next(()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,l=i.value,c=nl();l.forEach(e=>{if(!r.has(e)){const i=Nl(t.get(e),n.get(e));null!==i&&c.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,c))}return ao.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return r=t,zs.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Fa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var r}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):ao.resolve(tl());let o=-1,a=r;return s.next(t=>ao.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?ao.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,a,t,ol())).next(e=>({batchId:o,changes:el(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new zs(t)).next(e=>{let t=Za();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const r=t.collectionGroup;let s=Za();return this.indexManager.getCollectionParents(e,r).next(o=>ao.forEach(o,o=>{const a=(l=t,c=o.child(r),new La(c,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt));var l,c;return this.getDocumentsMatchingCollectionQuery(e,a,n,i).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,i))).next(e=>{r.forEach((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,la.newInvalidDocument(i)))});let n=Za();return e.forEach((e,i)=>{const s=r.get(e);void 0!==s&&Rl(s.mutation,i,Eo.empty(),eo.now()),Wa(t,i)&&(n=n.insert(e,i))}),n})}}class eu{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ao.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(n=t).id,version:n.version,createTime:gc(n.createTime)}),ao.resolve();var n}getNamedQuery(e,t){return ao.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(n=t).name,query:Vc(n.bundledQuery),readTime:gc(n.readTime)}),ao.resolve();var n}}class tu{constructor(){this.overlays=new yo(zs.comparator),this.qr=new Map}getOverlay(e,t){return ao.resolve(this.overlays.get(t))}getOverlays(e,t){const n=tl();return ao.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.St(e,t,i)}),ao.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.qr.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),ao.resolve()}getOverlaysForCollection(e,t,n){const i=tl(),r=t.length+1,s=new zs(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return ao.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new yo((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=tl(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=tl(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=i)););return ao.resolve(o)}St(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.qr.get(i.largestBatchId).delete(n.key);this.qr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Bl(t,n));let r=this.qr.get(t);void 0===r&&(r=ol(),this.qr.set(t,r)),this.qr.set(t,r.add(n.key))}}class nu{constructor(){this.sessionToken=Co.EMPTY_BYTE_STRING}getSessionToken(e){return ao.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ao.resolve()}}class iu{constructor(){this.Qr=new To(ru.$r),this.Ur=new To(ru.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new ru(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new ru(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new zs(new qs([])),n=new ru(t,e),i=new ru(t,e+1),r=[];return this.Ur.forEachInRange([n,i],e=>{this.Gr(e),r.push(e.key)}),r}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new zs(new qs([])),n=new ru(t,e),i=new ru(t,e+1);let r=ol();return this.Ur.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new ru(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class ru{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return zs.comparator(e.key,t.key)||Ds(e.Yr,t.Yr)}static Kr(e,t){return Ds(e.Yr,t.Yr)||zs.comparator(e.key,t.key)}}class su{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new To(ru.$r)}checkEmpty(e){return ao.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new ql(r,t,n,i);this.mutationQueue.push(s);for(const o of i)this.Zr=this.Zr.add(new ru(o.key,r)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return ao.resolve(s)}lookupMutationBatch(e,t){return ao.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.ei(n),r=i<0?0:i;return ao.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return ao.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return ao.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ru(t,0),i=new ru(t,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([n,i],e=>{const t=this.Xr(e.Yr);r.push(t)}),ao.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new To(Ds);return t.forEach(e=>{const t=new ru(e,0),i=new ru(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,i],e=>{n=n.add(e.Yr)})}),ao.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let r=n;zs.isDocumentKey(r)||(r=r.child(""));const s=new ru(new zs(r),0);let o=new To(Ds);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.Yr)),!0)},s),ao.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){_s(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return ao.forEach(t.mutations,i=>{const r=new ru(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new ru(t,0),i=this.Zr.firstAfterOrEqual(n);return ao.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,ao.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ou{constructor(e){this.ri=e,this.docs=new yo(zs.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ao.resolve(n?n.document.mutableCopy():la.newInvalidDocument(t))}getEntries(e,t){let n=Xa();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():la.newInvalidDocument(e))}),ao.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=Xa();const s=t.path,o=new zs(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||ro(no(o),n)<=0||(i.has(o.key)||Wa(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return ao.resolve(r)}getAllFromCollectionGroup(e,t,n,i){gs(9500)}ii(e,t){return ao.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new au(this)}getSize(e){return ao.resolve(this.size)}}class au extends Xc{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Nr.addEntry(e,i)):this.Nr.removeEntry(n)}),ao.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class lu{constructor(e){this.persistence=e,this.si=new Qa(e=>Da(e),Oa),this.lastRemoteSnapshotVersion=to.min(),this.highestTargetId=0,this.oi=0,this._i=new iu,this.targetCount=0,this.ai=Hc.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),ao.resolve()}getLastRemoteSnapshotVersion(e){return ao.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ao.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ao.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ao.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Hc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ao.resolve()}updateTargetData(e,t){return this.Pr(t),ao.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ao.resolve()}removeTargets(e,t,n){let i=0;const r=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),ao.waitFor(r).next(()=>i)}getTargetCount(e){return ao.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return ao.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ao.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),ao.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ao.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return ao.resolve(n)}containsKey(e,t){return ao.resolve(this._i.containsKey(t))}}class cu{constructor(e,t){this.ui={},this.overlays={},this.ci=new co(0),this.li=!1,this.li=!0,this.hi=new nu,this.referenceDelegate=e(this),this.Pi=new lu(this),this.indexManager=new qc,this.remoteDocumentCache=new ou(e=>this.referenceDelegate.Ti(e)),this.serializer=new Fc(t),this.Ii=new eu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new tu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new su(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){hs("MemoryPersistence","Starting transaction:",e);const i=new uu(this.ci.next());return this.referenceDelegate.Ei(),n(i).next(e=>this.referenceDelegate.di(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Ai(e,t){return ao.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class uu extends so{constructor(e){super(),this.currentSequenceNumber=e}}class hu{constructor(e){this.persistence=e,this.Ri=new iu,this.Vi=null}static mi(e){return new hu(e)}get fi(){if(this.Vi)return this.Vi;throw gs(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ao.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ao.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ao.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ao.forEach(this.fi,n=>{const i=zs.fromPath(n);return this.gi(e,i).next(e=>{e||t.removeEntry(i,to.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return ao.or([()=>ao.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class du{constructor(e,t){this.persistence=e,this.pi=new Qa(e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=po(t)),t=fo(e.get(n),t);return po(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Yc(e,t)}(this,t)}static mi(e,t){return new du(e,t)}Ei(){}di(e){return ao.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return ao.forEach(this.pi,(n,i)=>this.br(e,n,i).next(e=>e?ao.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.ii(e,i=>this.br(e,i,t).next(e=>{e||(n++,r.removeEntry(i,to.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ao.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ao.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ao.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ao.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Jo(e.data.value)),t}br(e,t,n){return ao.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return ao.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fu{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=i}static As(e,t){let n=ol(),i=ol();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:i=i.add(r.doc.key)}return new fu(e,t.fromCache,n,i)}}class pu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class gu{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=!function(){var e;const t=null==(e=S())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(n){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:function(){const e=F().match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}()>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,i){const r={result:null};return this.ys(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.ws(e,t,i,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const n=new pu;return this.Ss(e,t,n).next(i=>{if(r.result=i,this.Vs)return this.bs(e,t,n,i.size)})}).next(()=>r.result)}bs(e,t,n,i){return n.documentReadCount<this.fs?(us()<=_e.DEBUG&&hs("QueryEngine","SDK will not create cache indexes for query:",Ha(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ao.resolve()):(us()<=_e.DEBUG&&hs("QueryEngine","Query:",Ha(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.gs*i?(us()<=_e.DEBUG&&hs("QueryEngine","The SDK decides to create cache indexes for query:",Ha(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,qa(t))):ao.resolve())}ys(e,t){if(Ua(t))return ao.resolve(null);let n=qa(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Ba(t,null,"F"),n=qa(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const r=ol(...i);return this.ps.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.Ds(t,i);return this.Cs(t,s,r,n.readTime)?this.ys(e,Ba(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,i){return Ua(t)||i.isEqual(to.min())?ao.resolve(null):this.ps.getDocuments(e,n).next(r=>{const s=this.Ds(t,r);return this.Cs(t,s,n,i)?ao.resolve(null):(us()<=_e.DEBUG&&hs("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ha(t)),this.vs(e,s,t,function(e){const t=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,i=to.fromTimestamp(1e9===n?new eo(t+1,0):new eo(t,n));return new io(i,zs.empty(),-1)}(i)).next(e=>e))})}Ds(e,t){let n=new To(Ka(e));return t.forEach((t,i)=>{Wa(e,i)&&(n=n.add(i))}),n}Cs(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Ss(e,t,n){return us()<=_e.DEBUG&&hs("QueryEngine","Using full collection scan to execute query:",Ha(t)),this.ps.getDocumentsMatchingQuery(e,t,io.min(),n)}vs(e,t,n,i){return this.ps.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const mu="LocalStore";class _u{constructor(e,t,n,i){this.persistence=e,this.Fs=t,this.serializer=i,this.Ms=new yo(Ds),this.xs=new Qa(e=>Da(e),Oa),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Zc(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function yu(e,t){return f(this,null,function*(){const n=ys(e);return yield n.persistence.runTransaction("Handle user change","readonly",e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next(r=>(i=r,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],s=[];let o=ol();for(const e of i){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:r,addedBatchIds:s}))})})})}function vu(e){const t=ys(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function wu(e,t){const n=ys(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Tu(e,t,n){return f(this,null,function*(){const i=ys(e),r=i.Ms.get(t),s=n?"readwrite":"readwrite-primary";try{n||(yield i.persistence.runTransaction("Release target",s,e=>i.persistence.referenceDelegate.removeTarget(e,r)))}catch(o){if(!lo(o))throw o;hs(mu,`Failed to update sequence numbers for target ${t}: ${o}`)}i.Ms=i.Ms.remove(t),i.xs.delete(r.target)})}function Iu(e,t,n){const i=ys(e);let r=to.min(),s=ol();return i.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const i=ys(e),r=i.xs.get(n);return void 0!==r?ao.resolve(i.Ms.get(r)):i.Pi.getTargetData(t,n)}(i,e,qa(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>i.Fs.getDocumentsMatchingQuery(e,t,n?r:to.min(),n?s:ol())).next(e=>(function(e,t,n){let i=e.Os.get(t)||to.min();n.forEach((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)}),e.Os.set(t,i)}(i,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:s})))}class Eu{constructor(){this.activeTargetIds=al}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bu{constructor(){this.Mo=new Eu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Eu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Cu{Oo(e){}shutdown(){}}const Su="ConnectivityMonitor";class ku{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){hs(Su,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){hs(Su,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Nu=null;function Au(){return null===Nu?Nu=268435456+Math.round(2147483648*Math.random()):Nu++,"0x"+Nu.toString(16)}const Ru="RestConnection",Pu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Du{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${i}`,this.Wo=this.databaseId.database===Fo?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Go(e,t,n,i,r){const s=Au(),o=this.zo(e,t.toUriEncodedString());hs(Ru,`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,i,r);const{host:l}=new URL(o),c=D(l);return this.Jo(e,o,a,n,c).then(t=>(hs(Ru,`Received RPC '${e}' ${s}: `,t),t),t=>{throw fs(Ru,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,i,r,s){return this.Go(e,t,n,i,r)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ls,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=Pu[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class Ou{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const xu="WebChannelConnection";class Lu extends Du{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,i,r){const s=Au();return new Promise((r,o)=>{const a=new Yr;a.setWithCredentials(!0),a.listenOnce(Jr.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Zr.NO_ERROR:const t=a.getResponseJson();hs(xu,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),r(t);break;case Zr.TIMEOUT:hs(xu,`RPC '${e}' ${s} timed out`),o(new ws(vs.DEADLINE_EXCEEDED,"Request time out"));break;case Zr.HTTP_ERROR:const n=a.getStatus();if(hs(xu,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(vs).indexOf(t)>=0?t:vs.UNKNOWN}(t.status);o(new ws(e,t.message))}else o(new ws(vs.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ws(vs.UNAVAILABLE,"Connection failed."));break;default:gs(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{hs(xu,`RPC '${e}' ${s} completed.`)}});const l=JSON.stringify(i);hs(xu,`RPC '${e}' ${s} sending request:`,i),a.send(t,"POST",l,n,15)})}T_(e,t,n){const i=Au(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=is(),o=ns(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=r.join("");hs(xu,`Creating RPC '${e}' stream ${i}: ${c}`,a);const u=s.createWebChannel(c,a);this.I_(u);let h=!1,d=!1;const f=new Ou({Yo:t=>{d?hs(xu,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(h||(hs(xu,`Opening RPC '${e}' stream ${i} transport.`),u.open(),h=!0),hs(xu,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},Zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(u,Xr.EventType.OPEN,()=>{d||(hs(xu,`RPC '${e}' stream ${i} transport opened.`),f.o_())}),p(u,Xr.EventType.CLOSE,()=>{d||(d=!0,hs(xu,`RPC '${e}' stream ${i} transport closed`),f.a_(),this.E_(u))}),p(u,Xr.EventType.ERROR,t=>{d||(d=!0,fs(xu,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new ws(vs.UNAVAILABLE,"The operation could not be completed")))}),p(u,Xr.EventType.MESSAGE,t=>{var n;if(!d){const r=t.data[0];_s(!!r,16349);const s=r,o=(null==s?void 0:s.error)||(null==(n=s[0])?void 0:n.error);if(o){hs(xu,`RPC '${e}' stream ${i} received error:`,o);const t=o.status;let n=function(e){const t=$l[e];if(void 0!==t)return Wl(t)}(t),r=o.message;void 0===n&&(n=vs.INTERNAL,r="Unknown error status: "+t+" with message "+o.message),d=!0,f.a_(new ws(n,r)),u.close()}else hs(xu,`RPC '${e}' stream ${i} received:`,r),f.u_(r)}}),p(o,ts.STAT_EVENT,t=>{t.stat===es.PROXY?hs(xu,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===es.NOPROXY&&hs(xu,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Mu(){return"undefined"!=typeof document?document:null}function Uu(e){return new uc(e,!0)}class Fu{constructor(e,t,n=1e3,i=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=i,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),i=Math.max(0,t-n);i>0&&hs("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,i,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Vu="PersistentStream";class qu{constructor(e,t,n,i,r,s,o,a){this.Mi=e,this.S_=n,this.b_=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Fu(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}stop(){return f(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return f(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return f(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===vs.RESOURCE_EXHAUSTED?(ds(t.toString()),ds("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===vs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{const e=new ws(vs.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(()=>f(this,null,function*(){this.state=0,this.start()}))}z_(e){return hs(Vu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(hs(Vu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ju extends qu{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:gs(39313,{state:i}),s=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(_s(void 0===t||"string"==typeof t,58123),Co.fromBase64String(t||"")):(_s(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Co.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&function(e){const t=void 0===e.code?vs.UNKNOWN:Wl(e.code);return new ws(t,e.message||"")}(a);n=new nc(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const r=wc(e,i.document.name),s=gc(i.document.updateTime),o=i.document.createTime?gc(i.document.createTime):to.min(),a=new oa({mapValue:{fields:i.document.fields}}),l=la.newFoundDocument(r,s,o,a),c=i.targetIds||[],u=i.removedTargetIds||[];n=new ec(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const r=wc(e,i.document),s=i.readTime?gc(i.readTime):to.min(),o=la.newNoDocument(r,s),a=i.removedTargetIds||[];n=new ec([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const r=wc(e,i.document),s=i.removedTargetIds||[];n=new ec([],s,r,null)}else{if(!("filter"in t))return gs(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:r}=e,s=new zl(i,r),o=e.targetId;n=new tc(o,s)}}var i;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return to.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?to.min():t.readTime?gc(t.readTime):to.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Ic(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=xa(i)?{documents:Cc(e,i)}:{query:Sc(e,i).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=fc(e,t.resumeToken);const i=hc(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(to.min())>0){n.readTime=dc(e,t.snapshotVersion.toTimestamp());const i=hc(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return gs(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Ic(this.serializer),t.removeTarget=e,this.q_(t)}}class Bu extends qu{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return _s(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,_s(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){_s(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(_s(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?gc(e.updateTime):gc(t);return n.isEqual(to.min())&&(n=gc(t)),new bl(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=gc(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Ic(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof Ol)n={update:bc(e,t.key,t.value)};else if(t instanceof Fl)n={delete:vc(e,t.key)};else if(t instanceof xl)n={update:bc(e,t.key,t.data),updateMask:Lc(t.fieldMask)};else{if(!(t instanceof Vl))return gs(16599,{Vt:t.type});n={verify:vc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof gl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ml)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof yl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof wl)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw gs(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=(i=e,void 0!==(r=t.precondition).updateTime?{updateTime:pc(i,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:gs(27497))),n;var i,r}(this.serializer,e))};this.q_(t)}}class zu{}class $u extends zu{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ia=!1}sa(){if(this.ia)throw new ws(vs.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Go(e,_c(t,n),i,r,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===vs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ws(vs.UNKNOWN,e.toString())})}Ho(e,t,n,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Ho(e,_c(t,n),i,s,o,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===vs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new ws(vs.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Hu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ds(t),this.aa=!1):hs("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Wu="RemoteStore";class Ku{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(e=>{n.enqueueAndForget(()=>f(this,null,function*(){nh(this)&&(hs(Wu,"Restarting streams for network reachability change."),yield function(e){return f(this,null,function*(){const t=ys(e);t.Ea.add(4),yield Qu(t),t.Ra.set("Unknown"),t.Ea.delete(4),yield Gu(t)})}(this))}))}),this.Ra=new Hu(n,i)}}function Gu(e){return f(this,null,function*(){if(nh(e))for(const t of e.da)yield t(!0)})}function Qu(e){return f(this,null,function*(){for(const t of e.da)yield t(!1)})}function Yu(e,t){const n=ys(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),th(n)?eh(n):wh(n).O_()&&Ju(n,t))}function Xu(e,t){const n=ys(e),i=wh(n);n.Ia.delete(t),i.O_()&&Zu(n,t),0===n.Ia.size&&(i.O_()?i.L_():nh(n)&&n.Ra.set("Unknown"))}function Ju(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(to.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}wh(e).Y_(t)}function Zu(e,t){e.Va.Ue(t),wh(e).Z_(t)}function eh(e){e.Va=new rc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),wh(e).start(),e.Ra.ua()}function th(e){return nh(e)&&!wh(e).x_()&&e.Ia.size>0}function nh(e){return 0===ys(e).Ea.size}function ih(e){e.Va=void 0}function rh(e){return f(this,null,function*(){e.Ra.set("Online")})}function sh(e){return f(this,null,function*(){e.Ia.forEach((t,n)=>{Ju(e,t)})})}function oh(e,t){return f(this,null,function*(){ih(e),th(e)?(e.Ra.ha(t),eh(e)):e.Ra.set("Unknown")})}function ah(e,t,n){return f(this,null,function*(){if(e.Ra.set("Online"),t instanceof nc&&2===t.state&&t.cause)try{yield function(e,t){return f(this,null,function*(){const n=t.cause;for(const i of t.targetIds)e.Ia.has(i)&&(yield e.remoteSyncer.rejectListen(i,n),e.Ia.delete(i),e.Va.removeTarget(i))})}(e,t)}catch(i){hs(Wu,"Failed to remove targets %s: %s ",t.targetIds.join(","),i),yield lh(e,i)}else if(t instanceof ec?e.Va.Ze(t):t instanceof tc?e.Va.st(t):e.Va.tt(t),!n.isEqual(to.min()))try{const t=yield vu(e.localStore);n.compareTo(t)>=0&&(yield function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Ia.get(i);r&&e.Ia.set(i,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const i=e.Ia.get(t);if(!i)return;e.Ia.set(t,i.withResumeToken(Co.EMPTY_BYTE_STRING,i.snapshotVersion)),Zu(e,t);const r=new Uc(i.target,t,n,i.sequenceNumber);Ju(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n))}catch(r){hs(Wu,"Failed to raise snapshot:",r),yield lh(e,r)}})}function lh(e,t,n){return f(this,null,function*(){if(!lo(t))throw t;e.Ea.add(1),yield Qu(e),e.Ra.set("Offline"),n||(n=()=>vu(e.localStore)),e.asyncQueue.enqueueRetryable(()=>f(null,null,function*(){hs(Wu,"Retrying IndexedDB access"),yield n(),e.Ea.delete(1),yield Gu(e)}))})}function ch(e,t){return t().catch(n=>lh(e,n,t))}function uh(e){return f(this,null,function*(){const t=ys(e),n=Th(t);let i=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:-1;for(;hh(t);)try{const e=yield wu(t.localStore,i);if(null===e){0===t.Ta.length&&n.L_();break}i=e.batchId,dh(t,e)}catch(r){yield lh(t,r)}fh(t)&&ph(t)})}function hh(e){return nh(e)&&e.Ta.length<10}function dh(e,t){e.Ta.push(t);const n=Th(e);n.O_()&&n.X_&&n.ea(t.mutations)}function fh(e){return nh(e)&&!Th(e).x_()&&e.Ta.length>0}function ph(e){Th(e).start()}function gh(e){return f(this,null,function*(){Th(e).ra()})}function mh(e){return f(this,null,function*(){const t=Th(e);for(const n of e.Ta)t.ea(n.mutations)})}function _h(e,t,n){return f(this,null,function*(){const i=e.Ta.shift(),r=jl.from(i,t,n);yield ch(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),yield uh(e)})}function yh(e,t){return f(this,null,function*(){t&&Th(e).X_&&(yield function(e,t){return f(this,null,function*(){if(function(e){switch(e){case vs.OK:return gs(64938);case vs.CANCELLED:case vs.UNKNOWN:case vs.DEADLINE_EXCEEDED:case vs.RESOURCE_EXHAUSTED:case vs.INTERNAL:case vs.UNAVAILABLE:case vs.UNAUTHENTICATED:return!1;case vs.INVALID_ARGUMENT:case vs.NOT_FOUND:case vs.ALREADY_EXISTS:case vs.PERMISSION_DENIED:case vs.FAILED_PRECONDITION:case vs.ABORTED:case vs.OUT_OF_RANGE:case vs.UNIMPLEMENTED:case vs.DATA_LOSS:return!0;default:return gs(15467,{code:e})}}(n=t.code)&&n!==vs.ABORTED){const n=e.Ta.shift();Th(e).B_(),yield ch(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),yield uh(e)}var n})}(e,t)),fh(e)&&ph(e)})}function vh(e,t){return f(this,null,function*(){const n=ys(e);n.asyncQueue.verifyOperationInProgress(),hs(Wu,"RemoteStore received new credentials");const i=nh(n);n.Ea.add(3),yield Qu(n),i&&n.Ra.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),yield Gu(n)})}function wh(e){return e.ma||(e.ma=function(e,t,n){const i=ys(e);return i.sa(),new ju(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Xo:rh.bind(null,e),t_:sh.bind(null,e),r_:oh.bind(null,e),H_:ah.bind(null,e)}),e.da.push(t=>f(null,null,function*(){t?(e.ma.B_(),th(e)?eh(e):e.Ra.set("Unknown")):(yield e.ma.stop(),ih(e))}))),e.ma}function Th(e){return e.fa||(e.fa=function(e,t,n){const i=ys(e);return i.sa(),new Bu(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:gh.bind(null,e),r_:yh.bind(null,e),ta:mh.bind(null,e),na:_h.bind(null,e)}),e.da.push(t=>f(null,null,function*(){t?(e.fa.B_(),yield uh(e)):(yield e.fa.stop(),e.Ta.length>0&&(hs(Wu,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa}class Ih{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new Ts,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){const s=Date.now()+n,o=new Ih(e,t,s,i,r);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ws(vs.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Eh(e,t){if(ds("AsyncQueue",`${t}: ${e}`),lo(e))return new ws(vs.UNAVAILABLE,`${t}: ${e}`);throw e}class bh{static emptySet(e){return new bh(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||zs.comparator(t.key,n.key):(e,t)=>zs.comparator(e.key,t.key),this.keyedMap=Za(),this.sortedSet=new yo(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof bh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new bh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ch{constructor(){this.ga=new yo(zs.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):gs(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Sh{constructor(e,t,n,i,r,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Sh(e,t,bh.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&za(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class kh{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Nh{constructor(){this.queries=Ah(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=ys(e),i=n.queries;n.queries=Ah(),i.forEach((e,n)=>{for(const i of n.Sa)i.onError(t)})}(this,new ws(vs.ABORTED,"Firestore shutting down"))}}function Ah(){return new Qa(e=>$a(e),za)}function Rh(e,t){return f(this,null,function*(){const n=ys(e);let i=3;const r=t.query;let s=n.queries.get(r);s?!s.ba()&&t.Da()&&(i=2):(s=new kh,i=t.Da()?0:1);try{switch(i){case 0:s.wa=yield n.onListen(r,!0);break;case 1:s.wa=yield n.onListen(r,!1);break;case 2:yield n.onFirstRemoteStoreListen(r)}}catch(o){const e=Eh(o,`Initialization of query '${Ha(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,s),s.Sa.push(t),t.va(n.onlineState),s.wa&&t.Fa(s.wa)&&xh(n)})}function Ph(e,t){return f(this,null,function*(){const n=ys(e),i=t.query;let r=3;const s=n.queries.get(i);if(s){const e=s.Sa.indexOf(t);e>=0&&(s.Sa.splice(e,1),0===s.Sa.length?r=t.Da()?0:1:!s.ba()&&t.Da()&&(r=2))}switch(r){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}})}function Dh(e,t){const n=ys(e);let i=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(r)&&(i=!0);t.wa=r}}i&&xh(n)}function Oh(e,t,n){const i=ys(e),r=i.queries.get(t);if(r)for(const s of r.Sa)s.onError(n);i.queries.delete(t)}function xh(e){e.Ca.forEach(e=>{e.next()})}var Lh,Mh;(Mh=Lh||(Lh={})).Ma="default",Mh.Cache="cache";class Uh{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Sh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Sh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Lh.Cache}}class Fh{constructor(e){this.key=e}}class Vh{constructor(e){this.key=e}}class qh{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ol(),this.mutatedKeys=ol(),this.eu=Ka(e),this.tu=new bh(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new Ch,i=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{const c=i.get(e),u=Wa(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),f=!0):this.su(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||l&&this.eu(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:o,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const s=e.iu.ya();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return gs(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),i=null!=i&&i;const o=t&&!i?this._u():[],a=0===this.Xa.size&&this.current&&!i?1:0,l=a!==this.Za;return this.Za=a,0!==s.length||l?{snapshot:new Sh(this.query,e.tu,r,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ch,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=ol(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Vh(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new Fh(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=ol();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Sh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const jh="SyncEngine";class Bh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class zh{constructor(e){this.key=e,this.hu=!1}}class $h{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new Qa(e=>$a(e),za),this.Iu=new Map,this.Eu=new Set,this.du=new yo(zs.comparator),this.Au=new Map,this.Ru=new iu,this.Vu={},this.mu=new Map,this.fu=Hc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function Hh(e,t,n=!0){return f(this,null,function*(){const i=dd(e);let r;const s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=yield Kh(i,t,n,!0),r})}function Wh(e,t){return f(this,null,function*(){const n=dd(e);yield Kh(n,t,!0,!1)})}function Kh(e,t,n,i){return f(this,null,function*(){const r=yield function(e,t){const n=ys(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let i;return n.Pi.getTargetData(e,t).next(r=>r?(i=r,ao.resolve(i)):n.Pi.allocateTargetId(e).next(r=>(i=new Uc(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,i).next(()=>i))))}).then(e=>{const i=n.Ms.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}(e.localStore,qa(t)),s=r.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return i&&(a=yield function(e,t,n,i,r){return f(this,null,function*(){e.pu=(t,n,i)=>function(e,t,n,i){return f(this,null,function*(){let r=t.view.ru(n);r.Cs&&(r=yield Iu(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,r)));const s=i&&i.targetChanges.get(t.targetId),o=i&&null!=i.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s,o);return od(e,t.targetId,a.au),a.snapshot})}(e,t,n,i);const s=yield Iu(e.localStore,t,!0),o=new qh(t,s.Qs),a=o.ru(s.documents),l=Zl.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),c=o.applyChanges(a,e.isPrimaryClient,l);od(e,n,c.au);const u=new Bh(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),c.snapshot})}(e,t,s,"current"===o,r.resumeToken)),e.isPrimaryClient&&n&&Yu(e.remoteStore,r),a})}function Gh(e,t,n){return f(this,null,function*(){const i=ys(e),r=i.Tu.get(t),s=i.Iu.get(r.targetId);if(s.length>1)return i.Iu.set(r.targetId,s.filter(e=>!za(e,t))),void i.Tu.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Tu(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),n&&Xu(i.remoteStore,r.targetId),rd(i,r.targetId)}).catch(oo))):(rd(i,r.targetId),yield Tu(i.localStore,r.targetId,!0))})}function Qh(e,t){return f(this,null,function*(){const n=ys(e),i=n.Tu.get(t),r=n.Iu.get(i.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),Xu(n.remoteStore,i.targetId))})}function Yh(e,t,n){return f(this,null,function*(){const i=function(e){const t=ys(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=ed.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=td.bind(null,t),t}(e);try{const e=yield function(e,t){const n=ys(e),i=eo.now(),r=t.reduce((e,t)=>e.add(t.key),ol());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=Xa(),l=ol();return n.Ns.getEntries(e,r).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(r=>{s=r;const o=[];for(const e of t){const t=Pl(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new xl(e.key,t,aa(t.value.mapValue),Cl.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,o,t)}).next(t=>{o=t;const i=t.applyToLocalDocumentSet(s,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)})}).then(()=>({batchId:o.batchId,changes:el(s)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.Vu[e.currentUser.toKey()];i||(i=new yo(Ds)),i=i.insert(t,n),e.Vu[e.currentUser.toKey()]=i}(i,e.batchId,n),yield cd(i,e.changes),yield uh(i.remoteStore)}catch(r){const e=Eh(r,"Failed to persist write");n.reject(e)}})}function Xh(e,t){return f(this,null,function*(){const n=ys(e);try{const e=yield function(e,t){const n=ys(e),i=t.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.Ns.newChangeBuffer({trackRemovals:!0});r=n.Ms;const o=[];t.targetChanges.forEach((s,a)=>{const l=r.get(a);if(!l)return;o.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);var u,h,d;null!==t.targetMismatches.get(a)?c=c.withResumeToken(Co.EMPTY_BYTE_STRING,to.min()).withLastLimboFreeSnapshotVersion(to.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,i)),r=r.insert(a,c),h=c,d=s,(0===(u=l).resumeToken.approximateByteSize()||h.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||d.addedDocuments.size+d.modifiedDocuments.size+d.removedDocuments.size>0)&&o.push(n.Pi.updateTargetData(e,c))});let a=Xa(),l=ol();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),o.push(function(e,t,n){let i=ol(),r=ol();return n.forEach(e=>i=i.add(e)),t.getEntries(e,i).next(e=>{let i=Xa();return n.forEach((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(to.min())?(t.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),i=i.insert(n,s)):hs(mu,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{ks:i,qs:r}})}(e,s,t.documentUpdates).next(e=>{a=e.ks,l=e.qs})),!i.isEqual(to.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,i));o.push(t)}return ao.waitFor(o).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,l)).next(()=>a)}).then(e=>(n.Ms=r,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const i=n.Au.get(t);i&&(_s(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?i.hu=!0:e.modifiedDocuments.size>0?_s(i.hu,14607):e.removedDocuments.size>0&&(_s(i.hu,42227),i.hu=!1))}),yield cd(n,e,t)}catch(i){yield oo(i)}})}function Jh(e,t,n){const i=ys(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Tu.forEach((n,i)=>{const r=i.view.va(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const n=ys(e);n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(const r of n.Sa)r.va(t)&&(i=!0)}),i&&xh(n)}(i.eventManager,t),e.length&&i.Pu.H_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}function Zh(e,t,n){return f(this,null,function*(){const i=ys(e);i.sharedClientState.updateQueryState(t,"rejected",n);const r=i.Au.get(t),s=r&&r.key;if(s){let e=new yo(zs.comparator);e=e.insert(s,la.newNoDocument(s,to.min()));const n=ol().add(s),r=new Jl(to.min(),new Map,new yo(Ds),e,n);yield Xh(i,r),i.du=i.du.remove(s),i.Au.delete(t),ld(i)}else yield Tu(i.localStore,t,!1).then(()=>rd(i,t,n)).catch(oo)})}function ed(e,t){return f(this,null,function*(){const n=ys(e),i=t.batch.batchId;try{const e=yield function(e,t){const n=ys(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const i=t.batch.keys(),r=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const r=n.batch,s=r.keys();let o=ao.resolve();return s.forEach(e=>{o=o.next(()=>i.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);_s(null!==s,48541),t.version.compareTo(s)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=ol();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))})}(n.localStore,t);id(n,i,null),nd(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),yield cd(n,e)}catch(r){yield oo(r)}})}function td(e,t,n){return f(this,null,function*(){const i=ys(e);try{const e=yield function(e,t){const n=ys(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(_s(null!==t,37113),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i)).next(()=>n.localDocuments.getDocuments(e,i))})}(i.localStore,t);id(i,t,n),nd(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),yield cd(i,e)}catch(r){yield oo(r)}})}function nd(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function id(e,t,n){const i=ys(e);let r=i.Vu[i.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),i.Vu[i.currentUser.toKey()]=r}}function rd(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.Iu.get(t))e.Tu.delete(i),n&&e.Pu.yu(i,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||sd(e,t)})}function sd(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(Xu(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),ld(e))}function od(e,t,n){for(const i of n)i instanceof Fh?(e.Ru.addReference(i.key,t),ad(e,i)):i instanceof Vh?(hs(jh,"Document no longer in limbo: "+i.key),e.Ru.removeReference(i.key,t),e.Ru.containsKey(i.key)||sd(e,i.key)):gs(19791,{wu:i})}function ad(e,t){const n=t.key,i=n.path.canonicalString();e.du.get(n)||e.Eu.has(i)||(hs(jh,"New document in limbo: "+n),e.Eu.add(i),ld(e))}function ld(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new zs(qs.fromString(t)),i=e.fu.next();e.Au.set(i,new zh(n)),e.du=e.du.insert(n,i),Yu(e.remoteStore,new Uc(qa(Ma(n.path)),i,"TargetPurposeLimboResolution",co.ce))}}function cd(e,t,n){return f(this,null,function*(){const i=ys(e),r=[],s=[],o=[];i.Tu.isEmpty()||(i.Tu.forEach((e,a)=>{o.push(i.pu(a,t,n).then(e=>{var t;if((e||n)&&i.isPrimaryClient){const r=e?!e.fromCache:null==(t=null==n?void 0:n.targetChanges.get(a.targetId))?void 0:t.current;i.sharedClientState.updateQueryState(a.targetId,r?"current":"not-current")}if(e){r.push(e);const t=fu.As(a.targetId,e);s.push(t)}}))}),yield Promise.all(o),i.Pu.H_(r),yield function(e,t){return f(this,null,function*(){const n=ys(e);try{yield n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ao.forEach(t,t=>ao.forEach(t.Es,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>ao.forEach(t.ds,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(i){if(!lo(i))throw i;hs(mu,"Failed to update sequence numbers: "+i)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ms.get(t),i=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(i);n.Ms=n.Ms.insert(t,r)}}})}(i.localStore,s))})}function ud(e,t){return f(this,null,function*(){const n=ys(e);if(!n.currentUser.isEqual(t)){hs(jh,"User change. New user:",t.toKey());const e=yield yu(n.localStore,t);n.currentUser=t,(i=n).mu.forEach(e=>{e.forEach(e=>{e.reject(new ws(vs.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.mu.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield cd(n,e.Ls)}var i})}function hd(e,t){const n=ys(e),i=n.Au.get(t);if(i&&i.hu)return ol().add(i.key);{let e=ol();const i=n.Iu.get(t);if(!i)return e;for(const t of i){const i=n.Tu.get(t);e=e.unionWith(i.view.nu)}return e}}function dd(e){const t=ys(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Xh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=hd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Zh.bind(null,t),t.Pu.H_=Dh.bind(null,t.eventManager),t.Pu.yu=Oh.bind(null,t.eventManager),t}class fd{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return f(this,null,function*(){this.serializer=Uu(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,n,i){return new _u(e,t,n,i)}(this.persistence,new gu,e.initialUser,this.serializer)}Cu(e){return new cu(hu.mi,this.serializer)}Du(e){return new bu}terminate(){return f(this,null,function*(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}fd.provider={build:()=>new fd};class pd extends fd{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){_s(this.persistence.referenceDelegate instanceof du,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Qc(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?$c.withCacheSize(this.cacheSizeBytes):$c.DEFAULT;return new cu(e=>du.mi(e,t),this.serializer)}}class gd{initialize(e,t){return f(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Jh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ud.bind(null,this.syncEngine),yield function(e,t){return f(this,null,function*(){const n=ys(e);t?(n.Ea.delete(2),yield Gu(n)):t||(n.Ea.add(2),yield Qu(n),n.Ra.set("Unknown"))})}(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return new Nh}createDatastore(e){const t=Uu(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new Lu(i));var i;return function(e,t,n,i){return new $u(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,r=e=>Jh(this.syncEngine,e,0),s=ku.v()?new ku:new Cu,new Ku(t,n,i,r,s);var t,n,i,r,s}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){const a=new $h(e,t,n,i,r,s);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return f(this,null,function*(){var e,t;yield function(e){return f(this,null,function*(){const t=ys(e);hs(Wu,"RemoteStore shutting down."),t.Ea.add(5),yield Qu(t),t.Aa.shutdown(),t.Ra.set("Unknown")})}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()})}}gd.provider={build:()=>new gd};class md{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ds("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const _d="FirestoreClient";class yd{constructor(e,t,n,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=as.UNAUTHENTICATED,this.clientId=Ps.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,e=>f(this,null,function*(){hs(_d,"Received user=",e.uid),yield this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,e=>(hs(_d,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ts;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>f(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Eh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}function vd(e,t){return f(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),hs(_d,"Initializing OfflineComponentProvider");const n=e.configuration;yield t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(e=>f(null,null,function*(){i.isEqual(e)||(yield yu(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function wd(e,t){return f(this,null,function*(){e.asyncQueue.verifyOperationInProgress();const n=yield function(e){return f(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){hs(_d,"Using user provided OfflineComponentProvider");try{yield vd(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!("FirebaseError"===(n=r).name?n.code===vs.FAILED_PRECONDITION||n.code===vs.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;fs("Error using user provided cache. Falling back to memory cache: "+r),yield vd(e,new fd)}}else hs(_d,"Using default OfflineComponentProvider"),yield vd(e,new pd(void 0));var n;return e._offlineComponents})}(e);hs(_d,"Initializing OnlineComponentProvider"),yield t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>vh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>vh(t.remoteStore,n)),e._onlineComponents=t})}function Td(e){return f(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(hs(_d,"Using user provided OnlineComponentProvider"),yield wd(e,e._uninitializedComponentsProvider._online)):(hs(_d,"Using default OnlineComponentProvider"),yield wd(e,new gd))),e._onlineComponents})}function Id(e){return f(this,null,function*(){const t=yield Td(e),n=t.eventManager;return n.onListen=Hh.bind(null,t.syncEngine),n.onUnlisten=Gh.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Wh.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Qh.bind(null,t.syncEngine),n})}function Ed(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const bd=new Map,Cd="firestore.googleapis.com",Sd=!0;class kd{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new ws(vs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Cd,this.ssl=Sd}else this.host=e.host,this.ssl=null!=(t=e.ssl)?t:Sd;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=zc;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new ws(vs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new ws(vs.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ed(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ws(vs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new ws(vs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new ws(vs.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Nd{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kd({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ws(vs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ws(vs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kd(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Es;switch(e.type){case"firstParty":return new ks(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ws(vs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return f(this,null,function*(){"notTerminated"===this._terminateTask?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=bd.get(e);t&&(hs("ComponentProvider","Removing Datastore"),bd.delete(e),t.terminate())}(this),Promise.resolve()}}class Ad{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ad(this.firestore,e,this._query)}}class Rd{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Pd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Rd(this.firestore,e,this._key)}toJSON(){return{type:Rd._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Xs(t,Rd._jsonSchema))return new Rd(e,n||null,new zs(qs.fromString(t.referencePath)))}}Rd._jsonSchemaVersion="firestore/documentReference/1.0",Rd._jsonSchema={type:Ys("string",Rd._jsonSchemaVersion),referencePath:Ys("string")};class Pd extends Ad{constructor(e,t,n){super(e,t,Ma(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Rd(this.firestore,null,new zs(e))}withConverter(e){return new Pd(this.firestore,e,this._path)}}function Dd(e,t,...n){if(e=de(e),$s("collection","path",t),e instanceof Nd){const i=qs.fromString(t,...n);return Ws(i),new Pd(e,null,i)}{if(!(e instanceof Rd||e instanceof Pd))throw new ws(vs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(qs.fromString(t,...n));return Ws(i),new Pd(e.firestore,null,i)}}function Od(e,t,...n){if(e=de(e),1===arguments.length&&(t=Ps.newId()),$s("doc","path",t),e instanceof Nd){const i=qs.fromString(t,...n);return Hs(i),new Rd(e,null,new zs(i))}{if(!(e instanceof Rd||e instanceof Pd))throw new ws(vs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(qs.fromString(t,...n));return Hs(i),new Rd(e.firestore,e instanceof Pd?e.converter:null,new zs(i))}}const xd="AsyncQueue";class Ld{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Fu(this,"async_queue_retry"),this._c=()=>{const e=Mu();e&&hs(xd,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Mu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Mu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Ts;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return f(this,null,function*(){if(0!==this.Xu.length){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!lo(e))throw e;hs(xd,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,ds("INTERNAL UNHANDLED ERROR: ",Md(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const i=Ih.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(i),i}uc(){this.nc&&gs(47125,{Pc:Md(this.nc)})}verifyOperationInProgress(){}Tc(){return f(this,null,function*(){let e;do{e=this.ac,yield e}while(e!==this.ac)})}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Md(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function Ud(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return!0;return!1}(e)}class Fd extends Nd{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new Ld,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return f(this,null,function*(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ld(e),this._firestoreClient=void 0,yield e}})}}function Vd(e,t){const n="object"==typeof e?e:At(),i="string"==typeof e?e:Fo,r=Et(n,"firestore").getImmediate({identifier:i});if(!r._initialized){const e=N("firestore");e&&function(e,t,n,i={}){var r;e=Qs(e,Nd);const s=D(t),o=e._getSettings(),a=u(c({},o),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;s&&(O(`https://${l}`),U("Firestore",!0)),o.host!==Cd&&o.host!==l&&fs("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h=u(c({},o),{host:l,ssl:s,emulatorOptions:i});if(!te(h,a)&&(e._setSettings(h),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=as.MOCK_USER;else{t=x(i.mockUserToken,null==(r=e._app)?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new ws(vs.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new as(s)}e._authCredentials=new bs(new Is(t,n))}}(r,...e)}return r}function qd(e){if(e._terminated)throw new ws(vs.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,i;const r=e._freezeSettings(),s=(o=e._databaseId,a=(null==(t=e._app)?void 0:t.options.appId)||"",l=e._persistenceKey,new Uo(o,a,l,(c=r).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Ed(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator));var o,a,l,c;e._componentsProvider||(null==(n=r.localCache)?void 0:n._offlineComponentProvider)&&(null==(i=r.localCache)?void 0:i._onlineComponentProvider)&&(e._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),e._firestoreClient=new yd(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class jd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new jd(Co.fromBase64String(e))}catch(t){throw new ws(vs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new jd(Co.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:jd._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Xs(e,jd._jsonSchema))return jd.fromBase64String(e.bytes)}}jd._jsonSchemaVersion="firestore/bytes/1.0",jd._jsonSchema={type:Ys("string",jd._jsonSchemaVersion),bytes:Ys("string")};class Bd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ws(vs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class zd{constructor(e){this._methodName=e}}class $d{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ws(vs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ws(vs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ds(this._lat,e._lat)||Ds(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:$d._jsonSchemaVersion}}static fromJSON(e){if(Xs(e,$d._jsonSchema))return new $d(e.latitude,e.longitude)}}$d._jsonSchemaVersion="firestore/geoPoint/1.0",$d._jsonSchema={type:Ys("string",$d._jsonSchemaVersion),latitude:Ys("number"),longitude:Ys("number")};class Hd{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Hd._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Xs(e,Hd._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Hd(e.vectorValues);throw new ws(vs.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Hd._jsonSchemaVersion="firestore/vectorValue/1.0",Hd._jsonSchema={type:Ys("string",Hd._jsonSchemaVersion),vectorValues:Ys("object")};const Wd=/^__.*__$/;class Kd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new xl(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ol(e,this.data,t,this.fieldTransforms)}}class Gd{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new xl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Qd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw gs(40011,{Ac:e})}}class Yd{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Yd(c(c({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;const n=null==(t=this.path)?void 0:t.child(e),i=this.Vc({path:n,fc:!1});return i.gc(e),i}yc(e){var t;const n=null==(t=this.path)?void 0:t.child(e),i=this.Vc({path:n,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return df(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Qd(this.Ac)&&Wd.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Xd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Uu(e)}Cc(e,t,n,i=!1){return new Yd({Ac:e,methodName:t,Dc:n,path:Bs.emptyPath(),fc:!1,bc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Jd(e){const t=e._freezeSettings(),n=Uu(e._databaseId);return new Xd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Zd(e,t,n,i,r,s={}){const o=e.Cc(s.merge||s.mergeFields?2:0,t,n,r);lf("Data must be an object, but it was:",o,i);const a=of(i,o);let l,c;if(s.merge)l=new Eo(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const i of s.mergeFields){const r=cf(t,i,n);if(!o.contains(r))throw new ws(vs.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);ff(e,r)||e.push(r)}l=new Eo(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new Kd(new oa(a),l,c)}class ef extends zd{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ef}}class tf extends zd{_toFieldTransform(e){return new El(e.path,new gl)}isEqual(e){return e instanceof tf}}class nf extends zd{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new wl(e.serializer,ul(e.serializer,this.Fc));return new El(e.path,t)}isEqual(e){return e instanceof nf&&this.Fc===e.Fc}}function rf(e,t,n,i=!1){return sf(n,e.Cc(i?4:3,t))}function sf(e,t){if(af(e=de(e)))return lf("Unsupported field value:",t,e),of(e,t);if(e instanceof zd)return function(e,t){if(!Qd(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const r of e){let e=sf(r,t.wc(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=de(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ul(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=eo.fromDate(e);return{timestampValue:dc(t.serializer,n)}}if(e instanceof eo){const n=new eo(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:dc(t.serializer,n)}}if(e instanceof $d)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof jd)return{bytesValue:fc(t.serializer,e._byteString)};if(e instanceof Rd){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Sc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:mc(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Hd)return n=e,i=t,{mapValue:{fields:{[qo]:{stringValue:Bo},[zo]:{arrayValue:{values:n.toArray().map(e=>{if("number"!=typeof e)throw i.Sc("VectorValues must only contain numeric values.");return ll(i.serializer,e)})}}}}};var n,i;throw t.Sc(`Unsupported field value: ${Gs(e)}`)}(e,t)}function of(e,t){const n={};return _o(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):mo(e,(e,i)=>{const r=sf(i,t.mc(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function af(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof eo||e instanceof $d||e instanceof jd||e instanceof Rd||e instanceof zd||e instanceof Hd)}function lf(e,t,n){if(!af(n)||!Ks(n)){const i=Gs(n);throw"an object"===i?t.Sc(e+" a custom object"):t.Sc(e+" "+i)}}function cf(e,t,n){if((t=de(t))instanceof Bd)return t._internalPath;if("string"==typeof t)return hf(e,t);throw df("Field path arguments must be of type string or ",e,!1,void 0,n)}const uf=new RegExp("[~\\*/\\[\\]]");function hf(e,t,n){if(t.search(uf)>=0)throw df(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Bd(...t.split("."))._internalPath}catch(i){throw df(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function df(e,t,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new ws(vs.INVALID_ARGUMENT,a+e+l)}function ff(e,t){return e.some(e=>e.isEqual(t))}class pf{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Rd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new gf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(mf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class gf extends pf{data(){return super.data()}}function mf(e,t){return"string"==typeof t?hf(e,t):t instanceof Bd?t._internalPath:t._delegate._internalPath}function _f(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ws(vs.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yf{}class vf extends yf{}function wf(e,t,...n){let i=[];t instanceof yf&&i.push(t),i=i.concat(n),function(e){const t=e.filter(e=>e instanceof Ef).length,n=e.filter(e=>e instanceof Tf).length;if(t>1||t>0&&n>0)throw new ws(vs.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)e=r._apply(e);return e}class Tf extends vf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Tf(e,t,n)}_apply(e){const t=this._parse(e);return Df(e._query,t),new Ad(e.firestore,e.converter,ja(e._query,t))}_parse(e){const t=Jd(e.firestore);return function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new ws(vs.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Pf(o,s);const t=[];for(const n of o)t.push(Rf(i,e,n));a={arrayValue:{values:t}}}else a=Rf(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Pf(o,s),a=rf(n,"where",o,"in"===s||"not-in"===s);return ga.create(r,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function If(e,t,n){const i=t,r=mf("where",e);return Tf._create(r,i,n)}class Ef extends yf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ef(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ma.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const r of i)Df(n,r),n=ja(n,r)}(e._query,t),new Ad(e.firestore,e.converter,ja(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class bf extends vf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new bf(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new ws(vs.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ws(vs.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new da(t,n)}(e._query,this._field,this._direction);return new Ad(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new La(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Cf(e,t="asc"){const n=t,i=mf("orderBy",e);return bf._create(i,n)}class Sf extends vf{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Sf(e,t,n)}_apply(e){return new Ad(e.firestore,e.converter,Ba(e._query,this._limit,this._limitType))}}function kf(e){return function(e,t){if(t<=0)throw new ws(vs.INVALID_ARGUMENT,`Function limit() requires a positive number, but it was: ${t}.`)}(0,e),Sf._create("limit",e,"F")}class Nf extends vf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Nf(e,t,n)}_apply(e){const t=function(e,t,n,i){if(n[0]=de(n[0]),n[0]instanceof pf)return function(e,t,n,i,r){if(!i)throw new ws(vs.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of Va(e))if(o.field.isKeyField())s.push(Zo(t,i.key));else{const e=i.data.field(o.field);if(xo(e))throw new ws(vs.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new ws(vs.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ca(s,r)}(e._query,e.firestore._databaseId,t,n[0]._document,i);{const r=Jd(e.firestore);return function(e,t,n,i,r,s){const o=e.explicitOrderBy;if(r.length>o.length)throw new ws(vs.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let l=0;l<r.length;l++){const s=r[l];if(o[l].field.isKeyField()){if("string"!=typeof s)throw new ws(vs.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof s}`);if(!Fa(e)&&-1!==s.indexOf("/"))throw new ws(vs.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(qs.fromString(s));if(!zs.isDocumentKey(n))throw new ws(vs.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new zs(n);a.push(Zo(t,r))}else{const e=rf(n,i,s);a.push(e)}}return new ca(a,s)}(e._query,e.firestore._databaseId,r,t,n,i)}}(e,this.type,this._docOrFields,this._inclusive);return new Ad(e.firestore,e.converter,(n=e._query,i=t,new La(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,i,n.endAt)));var n,i}}function Af(...e){return Nf._create("startAfter",e,!1)}function Rf(e,t,n){if("string"==typeof(n=de(n))){if(""===n)throw new ws(vs.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fa(t)&&-1!==n.indexOf("/"))throw new ws(vs.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(qs.fromString(n));if(!zs.isDocumentKey(i))throw new ws(vs.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Zo(e,new zs(i))}if(n instanceof Rd)return Zo(e,n._key);throw new ws(vs.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Gs(n)}.`)}function Pf(e,t){if(!Array.isArray(e)||0===e.length)throw new ws(vs.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Df(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new ws(vs.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new ws(vs.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Of{convertValue(e,t="none"){switch($o(e)){case 0:return null;case 1:return e.booleanValue;case 2:return No(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ao(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw gs(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return mo(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,i;const r=null==(i=null==(n=null==(t=e.fields)?void 0:t[zo].arrayValue)?void 0:n.values)?void 0:i.map(e=>No(e.doubleValue));return new Hd(r)}convertGeoPoint(e){return new $d(No(e.latitude),No(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Lo(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Mo(e));default:return null}}convertTimestamp(e){const t=ko(e);return new eo(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=qs.fromString(e);_s(Mc(n),9688,{name:e});const i=new Vo(n.get(1),n.get(3)),r=new zs(n.popFirst(5));return i.isEqual(t)||ds(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class xf{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Lf extends pf{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Mf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(mf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ws(vs.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Lf._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Lf._jsonSchemaVersion="firestore/documentSnapshot/1.0",Lf._jsonSchema={type:Ys("string",Lf._jsonSchemaVersion),bundleSource:Ys("string","DocumentSnapshot"),bundleName:Ys("string"),bundle:Ys("string")};class Mf extends Lf{data(e={}){return super.data(e)}}class Uf{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new xf(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Mf(this._firestore,this._userDataWriter,n.key,n,new xf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ws(vs.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const i=new Mf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new xf(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const i=new Mf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new xf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Ff(t.type),doc:i,oldIndex:r,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ws(vs.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Uf._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ps.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),i.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Ff(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return gs(61501,{type:e})}}function Vf(e){e=Qs(e,Rd);const t=Qs(e.firestore,Fd);return function(e,t,n={}){const i=new Ts;return e.asyncQueue.enqueueAndForget(()=>f(null,null,function*(){return function(e,t,n,i,r){const s=new md({next:a=>{s.Nu(),t.enqueueAndForget(()=>Ph(e,o));const l=a.docs.has(n);!l&&a.fromCache?r.reject(new ws(vs.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&i&&"server"===i.source?r.reject(new ws(vs.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:e=>r.reject(e)}),o=new Uh(Ma(n.path),s,{includeMetadataChanges:!0,qa:!0});return Rh(e,o)}(yield Id(e),e.asyncQueue,t,n,i)})),i.promise}(qd(t),e._key).then(n=>Kf(t,e,n))}Uf._jsonSchemaVersion="firestore/querySnapshot/1.0",Uf._jsonSchema={type:Ys("string",Uf._jsonSchemaVersion),bundleSource:Ys("string","QuerySnapshot"),bundleName:Ys("string"),bundle:Ys("string")};class qf extends Of{constructor(e){super(),this.firestore=e}convertBytes(e){return new jd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Rd(this.firestore,null,t)}}function jf(e){e=Qs(e,Ad);const t=Qs(e.firestore,Fd),n=qd(t),i=new qf(t);return _f(e._query),function(e,t,n={}){const i=new Ts;return e.asyncQueue.enqueueAndForget(()=>f(null,null,function*(){return function(e,t,n,i,r){const s=new md({next:n=>{s.Nu(),t.enqueueAndForget(()=>Ph(e,o)),n.fromCache&&"server"===i.source?r.reject(new ws(vs.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new Uh(n,s,{includeMetadataChanges:!0,qa:!0});return Rh(e,o)}(yield Id(e),e.asyncQueue,t,n,i)})),i.promise}(n,e._query).then(n=>new Uf(t,i,e,n))}function Bf(e,t,n){e=Qs(e,Rd);const i=Qs(e.firestore,Fd),r=function(e,t){let n;return n=e?e.toFirestore(t):t,n}(e.converter,t);return Wf(i,[Zd(Jd(i),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,Cl.none())])}function zf(e,t,n,...i){e=Qs(e,Rd);const r=Qs(e.firestore,Fd),s=Jd(r);let o;return o="string"==typeof(t=de(t))||t instanceof Bd?function(e,t,n,i,r,s){const o=e.Cc(1,t,n),a=[cf(t,i,n)],l=[r];if(s.length%2!=0)throw new ws(vs.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(cf(t,s[d])),l.push(s[d+1]);const c=[],u=oa.empty();for(let d=a.length-1;d>=0;--d)if(!ff(c,a[d])){const e=a[d];let t=l[d];t=de(t);const n=o.yc(e);if(t instanceof ef)c.push(e);else{const i=sf(t,n);null!=i&&(c.push(e),u.set(e,i))}}const h=new Eo(c);return new Gd(u,h,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,i):function(e,t,n,i){const r=e.Cc(1,t,n);lf("Data must be an object, but it was:",r,i);const s=[],o=oa.empty();mo(i,(e,i)=>{const a=hf(t,e,n);i=de(i);const l=r.yc(a);if(i instanceof ef)s.push(a);else{const e=sf(i,l);null!=e&&(s.push(a),o.set(a,e))}});const a=new Eo(s);return new Gd(o,a,r.fieldTransforms)}(s,"updateDoc",e._key,t),Wf(r,[o.toMutation(e._key,Cl.exists(!0))])}function $f(e){return Wf(Qs(e.firestore,Fd),[new Fl(e._key,Cl.none())])}function Hf(e,...t){var n,i,r;e=de(e);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||Ud(t[o])||(s=t[o++]);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ud(t[o])){const e=t[o];t[o]=null==(n=e.next)?void 0:n.bind(e),t[o+1]=null==(i=e.error)?void 0:i.bind(e),t[o+2]=null==(r=e.complete)?void 0:r.bind(e)}let l,c,u;if(e instanceof Rd)c=Qs(e.firestore,Fd),u=Ma(e._key.path),l={next:n=>{t[o]&&t[o](Kf(c,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Qs(e,Ad);c=Qs(n.firestore,Fd),u=n._query;const i=new qf(c);l={next:e=>{t[o]&&t[o](new Uf(c,i,n,e))},error:t[o+1],complete:t[o+2]},_f(e._query)}return function(e,t,n,i){const r=new md(i),s=new Uh(t,r,n);return e.asyncQueue.enqueueAndForget(()=>f(null,null,function*(){return Rh(yield Id(e),s)})),()=>{r.Nu(),e.asyncQueue.enqueueAndForget(()=>f(null,null,function*(){return Ph(yield Id(e),s)}))}}(qd(c),u,a,l)}function Wf(e,t){return function(e,t){const n=new Ts;return e.asyncQueue.enqueueAndForget(()=>f(null,null,function*(){return Yh(yield function(e){return Td(e).then(e=>e.syncEngine)}(e),t,n)})),n.promise}(qd(e),t)}function Kf(e,t,n){const i=n.docs.get(t._key),r=new qf(e);return new Lf(e,r,t._key,i,new xf(n.hasPendingWrites,n.fromCache),t.converter)}function Gf(){return new tf("serverTimestamp")}function Qf(e){return new nf("increment",e)}!function(e,t=!0){ls=kt,It(new fe("firestore",(e,{instanceIdentifier:n,options:i})=>{const r=e.getProvider("app").getImmediate(),s=new Fd(new Cs(e.getProvider("auth-internal")),new As(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ws(vs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Vo(e.options.projectId,t)}(r,n),r);return i=c({useFetchStreams:t},i),s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),Rt(ss,os,e),Rt(ss,os,"esm2020")}();const Yf="firebasestorage.googleapis.com",Xf="storageBucket";class Jf extends H{constructor(e,t,n=0){super(ip(e),`Firebase Storage: ${t} (${ip(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Jf.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return ip(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Zf,ep,tp,np;function ip(e){return"storage/"+e}function rp(){return new Jf(Zf.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function sp(e){return new Jf(Zf.INVALID_ARGUMENT,e)}function op(){return new Jf(Zf.APP_DELETED,"The Firebase app was deleted.")}function ap(e,t){return new Jf(Zf.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function lp(e){throw new Jf(Zf.INTERNAL_ERROR,"Internal error: "+e)}(ep=Zf||(Zf={})).UNKNOWN="unknown",ep.OBJECT_NOT_FOUND="object-not-found",ep.BUCKET_NOT_FOUND="bucket-not-found",ep.PROJECT_NOT_FOUND="project-not-found",ep.QUOTA_EXCEEDED="quota-exceeded",ep.UNAUTHENTICATED="unauthenticated",ep.UNAUTHORIZED="unauthorized",ep.UNAUTHORIZED_APP="unauthorized-app",ep.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",ep.INVALID_CHECKSUM="invalid-checksum",ep.CANCELED="canceled",ep.INVALID_EVENT_NAME="invalid-event-name",ep.INVALID_URL="invalid-url",ep.INVALID_DEFAULT_BUCKET="invalid-default-bucket",ep.NO_DEFAULT_BUCKET="no-default-bucket",ep.CANNOT_SLICE_BLOB="cannot-slice-blob",ep.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",ep.NO_DOWNLOAD_URL="no-download-url",ep.INVALID_ARGUMENT="invalid-argument",ep.INVALID_ARGUMENT_COUNT="invalid-argument-count",ep.APP_DELETED="app-deleted",ep.INVALID_ROOT_OPERATION="invalid-root-operation",ep.INVALID_FORMAT="invalid-format",ep.INTERNAL_ERROR="internal-error",ep.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class cp{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=cp.makeFromUrl(e,t)}catch(r){return new cp(e,"")}if(""===n.path)return n;throw i=e,new Jf(Zf.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Yf?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let l=0;l<a.length;l++){const t=a[l],i=t.regex.exec(e);if(i){const e=i[t.indices.bucket];let r=i[t.indices.path];r||(r=""),n=new cp(e,r),t.postModify(n);break}}if(null==n)throw function(e){return new Jf(Zf.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class up{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function hp(e){return"string"==typeof e||e instanceof String}function dp(e){return fp()&&e instanceof Blob}function fp(){return"undefined"!=typeof Blob}function pp(e,t,n,i){if(i<t)throw sp(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw sp(`Invalid value for '${e}'. Expected ${n} or less.`)}function gp(e,t,n){let i=t;return null==n&&(i=`https://${t}`),`${n}://${i}/v0${e}`}function mp(e){const t=encodeURIComponent;let n="?";for(const i in e)e.hasOwnProperty(i)&&(n=n+(t(i)+"=")+t(e[i])+"&");return n=n.slice(0,-1),n}(np=tp||(tp={}))[np.NO_ERROR=0]="NO_ERROR",np[np.NETWORK_ERROR=1]="NETWORK_ERROR",np[np.ABORT=2]="ABORT";class _p{constructor(e,t,n,i,r,s,o,a,l,c,u,h=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=h,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{const n=this.resolve_,i=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0===e?n():n(e)}catch(s){i(s)}else if(null!==r){const e=rp();e.serverResponse=r.getErrorText(),this.errorCallback_?i(this.errorCallback_(r,e)):i(e)}else t.canceled?i(this.appDelete_?op():new Jf(Zf.CANCELED,"User canceled the upload/download.")):i(new Jf(Zf.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new yp(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,r=null,s=null,o=!1,a=0;function l(){return 2===a}let c=!1;function u(...e){c||(c=!0,t.apply(null,e))}function h(t){r=setTimeout(()=>{r=null,e(f,l())},t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(c)return void d();if(e)return d(),void u.call(null,e,...t);if(l()||o)return d(),void u.call(null,e,...t);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),h(n)}let p=!1;function g(e){p||(p=!0,d(),c||(null!==r?(e||(a=2),clearTimeout(r),h(0)):e||(a=1)))}return h(0),s=setTimeout(()=>{o=!0,g(!0)},n),g}((e,t)=>{if(t)return void e(!1,new yp(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===tp.NO_ERROR,r=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||i||r}(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===tp.ABORT;return void e(!1,new yp(!1,null,t))}const s=-1!==this.successCodes_.indexOf(r);e(!0,new yp(s,n))})},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class yp{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function vp(...e){const t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(fp())return new Blob(e);throw new Jf(Zf.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const wp="base64",Tp="base64url",Ip="data_url";class Ep{constructor(e,t){this.data=e,this.contentType=t||null}}function bp(e){const t=[];for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<=127?t.push(i):i<=2047?t.push(192|i>>6,128|63&i):55296==(64512&i)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(i=65536|(1023&i)<<10|1023&e.charCodeAt(++n),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)):t.push(239,191,189):56320==(64512&i)?t.push(239,191,189):t.push(224|i>>12,128|i>>6&63,128|63&i)}return new Uint8Array(t)}function Cp(e,t){switch(e){case wp:{const n=-1!==t.indexOf("-"),i=-1!==t.indexOf("_");if(n||i)throw ap(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case Tp:{const n=-1!==t.indexOf("+"),i=-1!==t.indexOf("/");if(n||i)throw ap(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new Jf(Zf.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(r){if(r.message.includes("polyfill"))throw r;throw ap(e,"Invalid character found")}const i=new Uint8Array(n.length);for(let s=0;s<n.length;s++)i[s]=n.charCodeAt(s);return i}class Sp{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw ap(Ip,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var i,r;null!=n&&(this.base64=(r=";base64",(i=n).length>=7&&i.substring(i.length-7)===r),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class kp{constructor(e,t){let n=0,i="";dp(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(dp(this.data_)){const s=(i=e,r=t,(n=this.data_).webkitSlice?n.webkitSlice(i,r):n.mozSlice?n.mozSlice(i,r):n.slice?n.slice(i,r):null);return null===s?null:new kp(s)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new kp(n,!0)}var n,i,r}static getBlob(...e){if(fp()){const t=e.map(e=>e instanceof kp?e.data_:e);return new kp(vp.apply(null,t))}{const t=e.map(e=>hp(e)?function(e,t){switch(e){case"raw":return new Ep(bp(t));case wp:case Tp:return new Ep(Cp(e,t));case Ip:return new Ep(function(e){const t=new Sp(e);return t.base64?Cp(wp,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw ap(Ip,"Malformed data URL.")}return bp(t)}(t.rest)}(t),new Sp(t).contentType)}throw rp()}("raw",e).data:e.data_);let n=0;t.forEach(e=>{n+=e.byteLength});const i=new Uint8Array(n);let r=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)i[r++]=e[t]}),new kp(i,!0)}}uploadData(){return this.data_}}function Np(e){let t;try{t=JSON.parse(e)}catch(i){return null}return"object"!=typeof(n=t)||Array.isArray(n)?null:t;var n}function Ap(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Rp(e,t){return t}class Pp{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||Rp}}let Dp=null;function Op(){if(Dp)return Dp;const e=[];e.push(new Pp("bucket")),e.push(new Pp("generation")),e.push(new Pp("metageneration")),e.push(new Pp("name","fullPath",!0));const t=new Pp("name");t.xform=function(e,t){return function(e){return!hp(e)||e.length<2?e:Ap(e)}(t)},e.push(t);const n=new Pp("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Pp("timeCreated")),e.push(new Pp("updated")),e.push(new Pp("md5Hash",null,!0)),e.push(new Pp("cacheControl",null,!0)),e.push(new Pp("contentDisposition",null,!0)),e.push(new Pp("contentEncoding",null,!0)),e.push(new Pp("contentLanguage",null,!0)),e.push(new Pp("contentType",null,!0)),e.push(new Pp("metadata","customMetadata",!0)),Dp=e,Dp}function xp(e,t,n){const i=Np(t);return null===i?null:function(e,t,n){const i={type:"file"},r=n.length;for(let s=0;s<r;s++){const e=n[s];i[e.local]=e.xform(i,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,i=e.fullPath,r=new cp(n,i);return t._makeStorageReference(r)}})}(i,e),i}(e,i,n)}class Lp{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Mp(e){if(!e)throw rp()}function Up(e){return function(t,n){let i;var r,s;return 401===t.getStatus()?i=t.getErrorText().includes("Firebase App Check token is invalid")?new Jf(Zf.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Jf(Zf.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,i=new Jf(Zf.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=e.path,i=new Jf(Zf.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}}function Fp(e){const t=Up(e);return function(n,i){let r=t(n,i);var s;return 404===n.getStatus()&&(s=e.path,r=new Jf(Zf.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),r.serverResponse=i.serverResponse,r}}class Vp{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=tp.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=tp.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=tp.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,i,r){if(this.sent_)throw lp("cannot .send() more than once");if(D(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const s in r)r.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,r[s].toString());return void 0!==i?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw lp("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw lp("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw lp("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw lp("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class qp extends Vp{initXhr(){this.xhr_.responseType="text"}}function jp(){return new qp}class Bp{constructor(e,t){this._service=e,this._location=t instanceof cp?t:cp.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Bp(e,t)}get root(){const e=new cp(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Ap(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new cp(this._location.bucket,e);return new Bp(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Jf(Zf.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function zp(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const i=gp(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,s=new Lp(i,"GET",function(e,t){return function(n,i){const r=xp(e,i,t);return Mp(null!==r),function(e,t,n,i){const r=Np(t);if(null===r)return null;if(!hp(r.downloadTokens))return null;const s=r.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map(t=>{const r=e.bucket,s=e.fullPath;return gp("/b/"+o(r)+"/o/"+o(s),n,i)+mp({alt:"media",token:t})})[0]}(r,i,e.host,e._protocol)}}(e,n),r);return s.errorHandler=Fp(t),s}(e.storage,e._location,Op());return e.storage.makeRequestWithTokens(t,jp).then(e=>{if(null===e)throw new Jf(Zf.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function $p(e,t){if(e instanceof Kp){const n=e;if(null==n._bucket)throw new Jf(Zf.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Xf+"' property when initializing the app?");const i=new Bp(n,n._bucket);return null!=t?$p(i,t):i}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),i=new cp(e._location.bucket,n);return new Bp(e.storage,i)}(e,t):e}function Hp(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Kp)return new Bp(e,t);throw sp("To use ref(service, url), the first argument must be a Storage instance.")}return $p(e,t)}function Wp(e,t){const n=null==t?void 0:t[Xf];return null==n?null:cp.makeFromBucketSpec(n,e)}class Kp{constructor(e,t,n,i,r,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=r,this._isUsingEmulator=s,this._bucket=null,this._host=Yf,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?cp.makeFromBucketSpec(i,this._host):Wp(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=cp.makeFromBucketSpec(this._url,e):this._bucket=Wp(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){pp("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){pp("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return f(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=yield e.getToken();if(null!==t)return t.accessToken}return null})}_getAppCheckToken(){return f(this,null,function*(){if(bt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Bp(this,e)}_makeRequest(e,t,n,i,r=!0){if(this._deleted)return new up(op());{const s=function(e,t,n,i,r,s,o=!0,a=!1){const l=mp(e.urlParams),c=e.url+l,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(u,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,i),new _p(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,o,a)}(e,this._appId,n,i,t,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}makeRequestWithTokens(e,t){return f(this,null,function*(){const[n,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()})}}const Gp="@firebase/storage",Qp="0.14.0",Yp="storage";function Xp(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const i=function(e,t,n,i,r){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const l=function(e,t,n){const i=Object.assign({},n);return i.fullPath=e.path,i.size=t.size(),i.contentType||(i.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),i}(t,i,r),c=function(e,t){const n={},i=t.length;for(let r=0;r<i;r++){const i=t[r];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}(l,n),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+c+"\r\n--"+a+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",h="\r\n--"+a+"--",d=kp.getBlob(u,i,h);if(null===d)throw new Jf(Zf.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const f={name:l.fullPath},p=gp(s,e.host,e._protocol),g=e.maxUploadRetryTime,m=new Lp(p,"POST",function(e,t){return function(n,i){const r=xp(e,i,t);return Mp(null!==r),r}}(e,n),g);return m.urlParams=f,m.headers=o,m.body=d.uploadData(),m.errorHandler=Up(t),m}(e.storage,e._location,Op(),new kp(t,!0),n);return e.storage.makeRequestWithTokens(i,jp).then(t=>({metadata:t,ref:e}))}(e=de(e),t,n)}function Jp(e){return zp(e=de(e))}function Zp(e){return function(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=gp(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,r=new Lp(n,"DELETE",function(e,t){},i);return r.successCodes=[200,204],r.errorHandler=Fp(t),r}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,jp)}(e=de(e))}function eg(e,t){return Hp(e=de(e),t)}function tg(e=At(),t){const n=Et(e=de(e),Yp).getImmediate({identifier:t}),i=N("storage");return i&&function(e,t,n,i={}){!function(e,t,n,i={}){e.host=`${t}:${n}`;const r=D(t);r&&(O(`https://${e.host}/b`),U("Storage",!0)),e._isUsingEmulator=!0,e._protocol=r?"https":"http";const{mockUserToken:s}=i;s&&(e._overrideAuthToken="string"==typeof s?s:x(s,e.app.options.projectId))}(e,t,n,i)}(n,...i),n}It(new fe(Yp,function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new Kp(n,i,r,t,kt)},"PUBLIC").setMultipleInstances(!0)),Rt(Gp,Qp,""),Rt(Gp,Qp,"esm2020");var ng={};const ig="@firebase/database",rg="1.1.0";let sg="";class og{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Q(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:G(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ag{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return X(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const lg=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new og(t)}}catch(t){}return new ag},cg=lg("localStorage"),ug=lg("sessionStorage"),hg=new Ee("@firebase/database"),dg=function(){let e=1;return function(){return e++}}(),fg=function(e){const t=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){const t=r-55296;i++,g(i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):r<65536?(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t}(e),n=new oe;n.update(t);const i=n.digest();return y.encodeByteArray(i)},pg=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=pg.apply(null,i):t+="object"==typeof i?Q(i):i,t+=" "}return t};let gg=null,mg=!0;const _g=function(...e){if(!0===mg&&(mg=!1,null===gg&&!0===ug.get("logging_enabled")&&(g(!0,"Can't turn on custom loggers persistently."),hg.logLevel=_e.VERBOSE,gg=hg.log.bind(hg))),gg){const t=pg.apply(null,e);gg(t)}},yg=function(e){return function(...t){_g(e,...t)}},vg=function(...e){const t="FIREBASE INTERNAL ERROR: "+pg(...e);hg.error(t)},wg=function(...e){const t=`FIREBASE FATAL ERROR: ${pg(...e)}`;throw hg.error(t),new Error(t)},Tg=function(...e){const t="FIREBASE WARNING: "+pg(...e);hg.warn(t)},Ig=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Eg="[MIN_NAME]",bg="[MAX_NAME]",Cg=function(e,t){if(e===t)return 0;if(e===Eg||t===bg)return-1;if(t===Eg||e===bg)return 1;{const n=Og(e),i=Og(t);return null!==n?null!==i?n-i===0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},Sg=function(e,t){return e===t?0:e<t?-1:1},kg=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Q(t))},Ng=function(e){if("object"!=typeof e||null===e)return Q(e);const t=[];for(const i in e)t.push(i);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=Q(t[i]),n+=":",n+=Ng(e[t[i]]);return n+="}",n},Ag=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function Rg(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Pg=function(e){g(!Ig(e),"Invalid JSON number");let t,n,i,r,s;0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=r+1023,i=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},Dg=new RegExp("^-?(0*)\\d{1,10}$"),Og=function(e){if(Dg.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},xg=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw Tg("Exception was thrown by user callback.",e),t},Math.floor(0))}},Lg=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class Mg{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,bt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Tg(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Ug{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(_g("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Tg(e)}}class Fg{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Fg.OWNER="owner";const Vg=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,qg="ac",jg="websocket",Bg="long_polling";class zg{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=cg.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&cg.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function $g(e,t,n){let i;if(g("string"==typeof t,"typeof type must == string"),g("object"==typeof n,"typeof params must == object"),t===jg)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Bg)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const r=[];return Rg(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class Hg{constructor(){this.counters_={}}incrementCounter(e,t=1){X(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return E(this.counters_)}}const Wg={},Kg={};function Gg(e){const t=e.toString();return Wg[t]||(Wg[t]=new Hg),Wg[t]}class Qg{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&xg(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Yg="start";class Xg{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=yg(e),this.stats_=Gg(t),this.urlFn=e=>(this.appCheckToken&&(e[qg]=this.appCheckToken),$g(t,Bg,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Qg(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Jg((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Yg)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const e={};e[Yg]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[qg]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Vg.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Xg.forceAllow_=!0}static forceDisallow(){Xg.forceDisallow_=!0}static isAvailable(){return!!Xg.forceAllow_||!(Xg.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Q(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=w(t),i=Ag(n,1840);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Q(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Jg{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=dg(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Jg.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(r){_g("frame writing exception"),r.stack&&_g(r.stack),_g(r)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||_g("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{_g("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}},Math.floor(1))}}let Zg=null;"undefined"!=typeof MozWebSocket?Zg=MozWebSocket:"undefined"!=typeof WebSocket&&(Zg=WebSocket);class em{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=yg(this.connId),this.stats_=Gg(t),this.connURL=em.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Vg.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s[qg]=i),r&&(s.p=r),$g(e,jg,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,cg.set("previous_websocket_failure",!0);try{let e;this.mySock=new Zg(this.connURL,[],e)}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){em.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Zg&&!em.forceDisallow_}static previouslyFailed(){return cg.isInMemoryStorage||!0===cg.get("previous_websocket_failure")}markConnectionHealthy(){cg.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=G(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(g(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Q(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Ag(t,16384);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}em.responsesRequiredToBeHealthy=2,em.healthyTimeout=3e4;class tm{static get ALL_TRANSPORTS(){return[Xg,em]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=em&&em.isAvailable();let n=t&&!em.previouslyFailed();if(e.webSocketOnly&&(t||Tg("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[em];else{const e=this.transports_=[];for(const t of tm.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);tm.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}tm.globalTransportInitialized_=!1;class nm{constructor(e,t,n,i,r,s,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=yg("c:"+this.id+":"),this.transportManager_=new tm(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Lg(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=kg("t",e),n=kg("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=kg("t",e),n=kg("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=kg("t",e);if("d"in e){const n=e.d;if("h"===t){const e=c({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?vg("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):vg("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Tg("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Lg(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Lg(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(cg.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class im{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class rm{constructor(e){this.allowedEvents_=e,this.listeners_={},g(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!n||n===i[r].context))return void i.splice(r,1)}validateEventType_(e){g(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class sm extends rm{static getInstance(){return new sm}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||V()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return g("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class om{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function am(){return new om("")}function lm(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function cm(e){return e.pieces_.length-e.pieceNum_}function um(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new om(e.pieces_,t)}function hm(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function dm(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function fm(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new om(t,0)}function pm(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof om)for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new om(n,0)}function gm(e){return e.pieceNum_>=e.pieces_.length}function mm(e,t){const n=lm(e),i=lm(t);if(null===n)return t;if(n===i)return mm(um(e),um(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function _m(e,t){const n=dm(e,0),i=dm(t,0);for(let r=0;r<n.length&&r<i.length;r++){const e=Cg(n[r],i[r]);if(0!==e)return e}return n.length===i.length?0:n.length<i.length?-1:1}function ym(e,t){if(cm(e)!==cm(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function vm(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(cm(e)>cm(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class wm{constructor(e,t){this.errorPrefix_=t,this.parts_=dm(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=ue(this.parts_[n]);Tm(this)}}function Tm(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Im(e))}function Im(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Em extends rm{static getInstance(){return new Em}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return g("visible"===e,"Unknown event type: "+e),[this.visible_]}}const bm=1e3;class Cm extends im{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Cm.nextPersistentConnectionId_++,this.log_=yg("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=bm,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Em.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&sm.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(Q(r)),g(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new P,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();const r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),g(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");const o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{const s=r.d,o=r.s;Cm.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&X(e,"w")){const n=J(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Tg(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=Y(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=Y(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),g(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Q(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):vg("Unrecognized action received from server: "+Q(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){g(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=bm,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=bm,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=bm),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){return f(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Cm.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,i())},c=function(e){g(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:l,sendRequest:c};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[e,l]=yield Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?_g("getToken() completed but was canceled"):(_g("getToken() completed. Creating connection."),this.authToken_=e&&e.accessToken,this.appCheckToken_=l&&l.token,a=new nm(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,i,e=>{Tg(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&Tg(e),l())}}})}interrupt(e){_g("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){_g("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Z(this.interruptReasons_)&&(this.reconnectDelay_=bm,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Ng(e)).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new om(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){_g("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){_g("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_&&this.securityDebugCallback_(e)}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+sg.replace(/\./g,"-")]=1,V()?e["framework.cordova"]=1:j()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=sm.getInstance().currentlyOnline();return Z(this.interruptReasons_)&&e}}Cm.nextPersistentConnectionId_=0,Cm.nextConnectionId_=0;class Sm{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Sm(e,t)}}class km{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Sm(Eg,e),i=new Sm(Eg,t);return 0!==this.compare(n,i)}minPost(){return Sm.MIN}}let Nm;class Am extends km{static get __EMPTY_NODE(){return Nm}static set __EMPTY_NODE(e){Nm=e}compare(e,t){return Cg(e.name,t.name)}isDefinedOn(e){throw m("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Sm.MIN}maxPost(){return new Sm(bg,Nm)}makePost(e,t){return g("string"==typeof e,"KeyIndex indexValue must always be a string."),new Sm(e,Nm)}toString(){return".key"}}const Rm=new Am;class Pm{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Dm{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Dm.RED,this.left=null!=i?i:Om.EMPTY_NODE,this.right=null!=r?r:Om.EMPTY_NODE}copy(e,t,n,i,r){return new Dm(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Om.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Om.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Dm.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Dm.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Dm.RED=!0,Dm.BLACK=!1;class Om{constructor(e,t=Om.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Om(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Dm.BLACK,null,null))}remove(e){return new Om(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Dm.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Pm(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Pm(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Pm(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Pm(this.root_,null,this.comparator_,!0,e)}}function xm(e,t){return Cg(e.name,t.name)}function Lm(e,t){return Cg(e,t)}let Mm;Om.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new Dm(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Um=function(e){return"number"==typeof e?"number:"+Pg(e):"string:"+e},Fm=function(e){if(e.isLeafNode()){const t=e.val();g("string"==typeof t||"number"==typeof t||"object"==typeof t&&X(t,".sv"),"Priority must be a string or number.")}else g(e===Mm||e.isEmpty(),"priority of unexpected type.");g(e===Mm||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Vm,qm,jm;class Bm{static set __childrenNodeConstructor(e){Vm=e}static get __childrenNodeConstructor(){return Vm}constructor(e,t=Bm.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,g(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Fm(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Bm(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Bm.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return gm(e)?this:".priority"===lm(e)?this.priorityNode_:Bm.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Bm.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=lm(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(g(".priority"!==n||1===cm(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Bm.__childrenNodeConstructor.EMPTY_NODE.updateChild(um(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Um(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Pg(this.value_):this.value_,this.lazyHash_=fg(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Bm.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Bm.__childrenNodeConstructor?-1:(g(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=Bm.VALUE_TYPE_ORDER.indexOf(t),r=Bm.VALUE_TYPE_ORDER.indexOf(n);return g(i>=0,"Unknown leaf type: "+t),g(r>=0,"Unknown leaf type: "+n),i===r?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Bm.VALUE_TYPE_ORDER=["object","boolean","number","string"];const zm=new class extends km{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?Cg(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Sm.MIN}maxPost(){return new Sm(bg,new Bm("[PRIORITY-POST]",jm))}makePost(e,t){const n=qm(e);return new Sm(t,new Bm("[PRIORITY-POST]",n))}toString(){return".priority"}},$m=Math.log(2);class Hm{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/$m,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Wm=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Dm(a,o.node,Dm.BLACK,null,null);{const l=parseInt(s/2,10)+t,c=r(t,l),u=r(l+1,i);return o=e[l],a=n?n(o):o,new Dm(a,o.node,Dm.BLACK,c,u)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const c=r(s+1,a),u=e[s],h=n?n(u):u;l(new Dm(h,u.node,i,null,c))},l=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Dm.BLACK):(a(i,Dm.BLACK),a(i,Dm.RED))}return s}(new Hm(e.length));return new Om(i||t,s)};let Km;const Gm={};class Qm{static get Default(){return g(Gm&&zm,"ChildrenNode.ts has not been loaded"),Km=Km||new Qm({".priority":Gm},{".priority":zm}),Km}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=J(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Om?t:null}hasIndex(e){return X(this.indexSet_,e.toString())}addIndex(e,t){g(e!==Rm,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const r=t.getIterator(Sm.Wrap);let s,o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),n.push(o),o=r.getNext();s=i?Wm(n,e.getCompare()):Gm;const a=e.toString(),l=c({},this.indexSet_);l[a]=e;const u=c({},this.indexes_);return u[a]=s,new Qm(u,l)}addToIndexes(e,t){const n=ee(this.indexes_,(n,i)=>{const r=J(this.indexSet_,i);if(g(r,"Missing index implementation for "+i),n===Gm){if(r.isDefinedOn(e.node)){const n=[],i=t.getIterator(Sm.Wrap);let s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),Wm(n,r.getCompare())}return Gm}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new Sm(e.name,i))),r.insert(e,e.node)}});return new Qm(n,this.indexSet_)}removeFromIndexes(e,t){const n=ee(this.indexes_,n=>{if(n===Gm)return n;{const i=t.get(e.name);return i?n.remove(new Sm(e.name,i)):n}});return new Qm(n,this.indexSet_)}}let Ym;class Xm{static get EMPTY_NODE(){return Ym||(Ym=new Xm(new Om(Lm),null,Qm.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Fm(this.priorityNode_),this.children_.isEmpty()&&g(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ym}updatePriority(e){return this.children_.isEmpty()?this:new Xm(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Ym:t}}getChild(e){const t=lm(e);return null===t?this:this.getImmediateChild(t).getChild(um(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(g(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Sm(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?Ym:this.priorityNode_;return new Xm(i,s,r)}}updateChild(e,t){const n=lm(e);if(null===n)return t;{g(".priority"!==lm(e)||1===cm(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(um(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(zm,(s,o)=>{t[s]=o.val(e),n++,r&&Xm.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Um(this.getPriority().val())+":"),this.forEachChild(zm,(t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":fg(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Sm(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Sm(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Sm(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,Sm.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,Sm.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Jm?-1:0}withIndex(e){if(e===Rm||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Xm(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Rm||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(zm),n=t.getIterator(zm);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===Rm?null:this.indexMap_.get(e.toString())}}Xm.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Jm=new class extends Xm{constructor(){super(new Om(Lm),Xm.EMPTY_NODE,Qm.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Xm.EMPTY_NODE}isEmpty(){return!1}};function Zm(e,t=null){if(null===e)return Xm.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),g(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Bm(e,Zm(t));if(e instanceof Array){let n=Xm.EMPTY_NODE;return Rg(e,(t,i)=>{if(X(e,t)&&"."!==t.substring(0,1)){const e=Zm(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}}),n.updatePriority(Zm(t))}{const n=[];let i=!1;if(Rg(e,(e,t)=>{if("."!==e.substring(0,1)){const r=Zm(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new Sm(e,r)))}}),0===n.length)return Xm.EMPTY_NODE;const r=Wm(n,xm,e=>e.name,Lm);if(i){const e=Wm(n,zm.getCompare());return new Xm(r,Zm(t),new Qm({".priority":e},{".priority":zm}))}return new Xm(r,Zm(t),Qm.Default)}}Object.defineProperties(Sm,{MIN:{value:new Sm(Eg,Xm.EMPTY_NODE)},MAX:{value:new Sm(bg,Jm)}}),Am.__EMPTY_NODE=Xm.EMPTY_NODE,Bm.__childrenNodeConstructor=Xm,Mm=Jm,jm=Jm,qm=Zm;class e_ extends km{constructor(e){super(),this.indexPath_=e,g(!gm(e)&&".priority"!==lm(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?Cg(e.name,t.name):r}makePost(e,t){const n=Zm(e),i=Xm.EMPTY_NODE.updateChild(this.indexPath_,n);return new Sm(t,i)}maxPost(){const e=Xm.EMPTY_NODE.updateChild(this.indexPath_,Jm);return new Sm(bg,e)}toString(){return dm(this.indexPath_,0).join("/")}}const t_=new class extends km{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Cg(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Sm.MIN}maxPost(){return Sm.MAX}makePost(e,t){const n=Zm(e);return new Sm(t,n)}toString(){return".value"}};function n_(e){return{type:"value",snapshotNode:e}}function i_(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function r_(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function s_(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class o_{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){g(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(r_(t,o)):g(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(i_(t,n)):s.trackChildChange(s_(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(zm,(e,i)=>{t.hasChild(e)||n.trackChildChange(r_(e,i))}),t.isLeafNode()||t.forEachChild(zm,(t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(s_(t,i,r))}else n.trackChildChange(i_(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Xm.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class a_{constructor(e){this.indexedFilter_=new o_(e.getIndex()),this.index_=e.getIndex(),this.startPost_=a_.getStartPost_(e),this.endPost_=a_.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new Sm(t,n))||(n=Xm.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Xm.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(Xm.EMPTY_NODE);const r=this;return t.forEachChild(zm,(e,t)=>{r.matches(new Sm(e,t))||(i=i.updateImmediateChild(e,Xm.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class l_{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new a_(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return this.rangedFilter_.matches(new Sm(t,n))||(n=Xm.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=Xm.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=Xm.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(Xm.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,Xm.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();const o=e;g(o.numChildren()===this.limit_,"");const a=new Sm(t,n),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(o.hasChild(t)){const e=o.getImmediateChild(t);let u=i.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=u&&(u.name===t||o.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);const h=null==u?1:s(u,a);if(c&&!n.isEmpty()&&h>=0)return null!=r&&r.trackChildChange(s_(t,n,e)),o.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(r_(t,e));const n=o.updateImmediateChild(t,Xm.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(i_(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:c&&s(l,a)>=0?(null!=r&&(r.trackChildChange(r_(l.name,l.node)),r.trackChildChange(i_(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(l.name,Xm.EMPTY_NODE)):e}}class c_{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=zm}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return g(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return g(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Eg}hasEnd(){return this.endSet_}getIndexEndValue(){return g(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return g(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:bg}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return g(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===zm}copy(){const e=new c_;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function u_(e){const t={};if(e.isDefault())return t;let n;if(e.index_===zm?n="$priority":e.index_===t_?n="$value":e.index_===Rm?n="$key":(g(e.index_ instanceof e_,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Q(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Q(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Q(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Q(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Q(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function h_(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==zm&&(t.i=e.index_.toString()),t}class d_ extends im{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(g(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=yg("p:rest:"),this.listens_={}}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const s=d_.getListenId_(e,n),o={};this.listens_[s]=o;const a=u_(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),J(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}})}unlisten(e,t){const n=d_.getListenId_(e,t);delete this.listens_[n]}get(e){const t=u_(e._queryParams),n=e._path.toString(),i=new P;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ie(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=G(o.responseText)}catch(e){Tg("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,t)}else 401!==o.status&&404!==o.status&&Tg("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class f_{constructor(){this.rootNode_=Xm.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function p_(){return{value:null,children:new Map}}function g_(e,t,n){if(gm(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=lm(t);e.children.has(i)||e.children.set(i,p_()),g_(e.children.get(i),t=um(t),n)}}function m_(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,i)=>{m_(i,new om(t.toString()+"/"+e),n)})}class __{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=c({},e);return this.last_&&Rg(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class y_{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new __(e);const n=1e4+2e4*Math.random();Lg(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Rg(e,(e,i)=>{i>0&&X(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),Lg(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var v_,w_;function T_(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(w_=v_||(v_={}))[w_.OVERWRITE=0]="OVERWRITE",w_[w_.MERGE=1]="MERGE",w_[w_.ACK_USER_WRITE=2]="ACK_USER_WRITE",w_[w_.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class I_{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=v_.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(gm(this.path)){if(null!=this.affectedTree.value)return g(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new om(e));return new I_(am(),t,this.revert)}}return g(lm(this.path)===e,"operationForChild called for unrelated child."),new I_(um(this.path),this.affectedTree,this.revert)}}class E_{constructor(e,t){this.source=e,this.path=t,this.type=v_.LISTEN_COMPLETE}operationForChild(e){return gm(this.path)?new E_(this.source,am()):new E_(this.source,um(this.path))}}class b_{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=v_.OVERWRITE}operationForChild(e){return gm(this.path)?new b_(this.source,am(),this.snap.getImmediateChild(e)):new b_(this.source,um(this.path),this.snap)}}class C_{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=v_.MERGE}operationForChild(e){if(gm(this.path)){const t=this.children.subtree(new om(e));return t.isEmpty()?null:t.value?new b_(this.source,am(),t.value):new C_(this.source,am(),t)}return g(lm(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new C_(this.source,um(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class S_{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(gm(e))return this.isFullyInitialized()&&!this.filtered_;const t=lm(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class k_{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function N_(e,t,n,i,r,s){const o=i.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw m("Should only compare child_ events.");const i=new Sm(t.childName,t.snapshotNode),r=new Sm(n.childName,n.snapshotNode);return e.index_.compare(i,r)}(e,t,n)),o.forEach(n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);r.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))})})}function A_(e,t){return{eventCache:e,serverCache:t}}function R_(e,t,n,i){return A_(new S_(t,n,i),e.serverCache)}function P_(e,t,n,i){return A_(e.eventCache,new S_(t,n,i))}function D_(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function O_(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let x_;class L_{static fromObject(e){let t=new L_(null);return Rg(e,(e,n)=>{t=t.set(new om(e),n)}),t}constructor(e,t=(()=>(x_||(x_=new Om(Sg)),x_))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:am(),value:this.value};if(gm(e))return null;{const n=lm(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(um(e),t);return null!=r?{path:pm(new om(n),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(gm(e))return this;{const t=lm(e),n=this.children.get(t);return null!==n?n.subtree(um(e)):new L_(null)}}set(e,t){if(gm(e))return new L_(t,this.children);{const n=lm(e),i=(this.children.get(n)||new L_(null)).set(um(e),t),r=this.children.insert(n,i);return new L_(this.value,r)}}remove(e){if(gm(e))return this.children.isEmpty()?new L_(null):new L_(null,this.children);{const t=lm(e),n=this.children.get(t);if(n){const i=n.remove(um(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new L_(null):new L_(this.value,r)}return this}}get(e){if(gm(e))return this.value;{const t=lm(e),n=this.children.get(t);return n?n.get(um(e)):null}}setTree(e,t){if(gm(e))return t;{const n=lm(e),i=(this.children.get(n)||new L_(null)).setTree(um(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new L_(this.value,r)}}fold(e){return this.fold_(am(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(pm(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,am(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(gm(e))return null;{const i=lm(e),r=this.children.get(i);return r?r.findOnPath_(um(e),pm(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,am(),t)}foreachOnPath_(e,t,n){if(gm(e))return this;{this.value&&n(t,this.value);const i=lm(e),r=this.children.get(i);return r?r.foreachOnPath_(um(e),pm(t,i),n):new L_(null)}}foreach(e){this.foreach_(am(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(pm(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class M_{constructor(e){this.writeTree_=e}static empty(){return new M_(new L_(null))}}function U_(e,t,n){if(gm(t))return new M_(new L_(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=mm(r,t);return s=s.updateChild(o,n),new M_(e.writeTree_.set(r,s))}{const i=new L_(n),r=e.writeTree_.setTree(t,i);return new M_(r)}}}function F_(e,t,n){let i=e;return Rg(n,(e,n)=>{i=U_(i,pm(t,e),n)}),i}function V_(e,t){if(gm(t))return M_.empty();{const n=e.writeTree_.setTree(t,new L_(null));return new M_(n)}}function q_(e,t){return null!=j_(e,t)}function j_(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(mm(n.path,t)):null}function B_(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(zm,(e,n)=>{t.push(new Sm(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new Sm(e,n.value))}),t}function z_(e,t){if(gm(t))return e;{const n=j_(e,t);return new M_(null!=n?new L_(n):e.writeTree_.subtree(t))}}function $_(e){return e.writeTree_.isEmpty()}function H_(e,t){return W_(am(),e.writeTree_,t)}function W_(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal((t,r)=>{".priority"===t?(g(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):n=W_(pm(e,t),r,n)}),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(pm(e,".priority"),i)),n}}function K_(e,t){return ry(t,e)}function G_(e,t){if(e.snap)return vm(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&vm(pm(e.path,n),t))return!0;return!1}function Q_(e){return e.visible}function Y_(e,t,n){let i=M_.empty();for(let r=0;r<e.length;++r){const s=e[r];if(t(s)){const e=s.path;let t;if(s.snap)vm(n,e)?(t=mm(n,e),i=U_(i,t,s.snap)):vm(e,n)&&(t=mm(e,n),i=U_(i,am(),s.snap.getChild(t)));else{if(!s.children)throw m("WriteRecord should have .snap or .children");if(vm(n,e))t=mm(n,e),i=F_(i,t,s.children);else if(vm(e,n))if(t=mm(e,n),gm(t))i=F_(i,am(),s.children);else{const e=J(s.children,lm(t));if(e){const n=e.getChild(um(t));i=U_(i,am(),n)}}}}}return i}function X_(e,t,n,i,r){if(i||r){const s=z_(e.visibleWrites,t);if(!r&&$_(s))return n;if(r||null!=n||q_(s,am())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(vm(e.path,t)||vm(t,e.path))};return H_(Y_(e.allWrites,s,t),n||Xm.EMPTY_NODE)}return null}{const i=j_(e.visibleWrites,t);if(null!=i)return i;{const i=z_(e.visibleWrites,t);return $_(i)?n:null!=n||q_(i,am())?H_(i,n||Xm.EMPTY_NODE):null}}}function J_(e,t,n,i){return X_(e.writeTree,e.treePath,t,n,i)}function Z_(e,t){return function(e,t,n){let i=Xm.EMPTY_NODE;const r=j_(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(zm,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(n){const r=z_(e.visibleWrites,t);return n.forEachChild(zm,(e,t)=>{const n=H_(z_(r,new om(e)),t);i=i.updateImmediateChild(e,n)}),B_(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}return B_(z_(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}(e.writeTree,e.treePath,t)}function ey(e,t,n,i){return function(e,t,n,i,r){g(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=pm(t,n);if(q_(e.visibleWrites,s))return null;{const t=z_(e.visibleWrites,s);return $_(t)?r.getChild(n):H_(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function ty(e,t){return function(e,t){return j_(e.visibleWrites,t)}(e.writeTree,pm(e.treePath,t))}function ny(e,t,n){return function(e,t,n,i){const r=pm(t,n),s=j_(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?H_(z_(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function iy(e,t){return ry(pm(e.treePath,t),e.writeTree)}function ry(e,t){return{treePath:e,writeTree:t}}class sy{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;g("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),g(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,s_(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,r_(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,i_(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw m("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,s_(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const oy=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class ay{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new S_(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ny(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:O_(this.viewCache_),r=function(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const l=z_(e.visibleWrites,t),c=j_(l,am());if(null!=c)a=c;else{if(null==n)return[];a=H_(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let l=n.getNext();for(;l&&e.length<r;)0!==t(l,i)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function ly(e,t,n,i,r,s){const o=t.eventCache;if(null!=ty(i,n))return t;{let a,l;if(gm(n))if(g(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=O_(t),r=Z_(i,n instanceof Xm?n:Xm.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{const n=J_(i,O_(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const c=lm(n);if(".priority"===c){g(1===cm(n),"Can't have a priority with additional path components");const r=o.getNode();l=t.serverCache.getNode();const s=ey(i,n,r,l);a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{const u=um(n);let h;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=ey(i,n,o.getNode(),l);h=null!=e?o.getNode().getImmediateChild(c).updateChild(u,e):o.getNode().getImmediateChild(c)}else h=ny(i,c,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),c,h,u,r,s):o.getNode()}}return R_(t,a,o.isFullyInitialized()||gm(n),e.filter.filtersNodes())}}function cy(e,t,n,i,r,s,o,a){const l=t.serverCache;let c;const u=o?e.filter:e.filter.getIndexedFilter();if(gm(n))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,i);c=u.updateFullNode(l.getNode(),e,null)}else{const e=lm(n);if(!l.isCompleteForPath(n)&&cm(n)>1)return t;const r=um(n),s=l.getNode().getImmediateChild(e).updateChild(r,i);c=".priority"===e?u.updatePriority(l.getNode(),s):u.updateChild(l.getNode(),e,s,r,oy,null)}const h=P_(t,c,l.isFullyInitialized()||gm(n),u.filtersNodes());return ly(e,h,n,r,new ay(r,h,s),a)}function uy(e,t,n,i,r,s,o){const a=t.eventCache;let l,c;const u=new ay(r,t,s);if(gm(n))c=e.filter.updateFullNode(t.eventCache.getNode(),i,o),l=R_(t,c,!0,e.filter.filtersNodes());else{const r=lm(n);if(".priority"===r)c=e.filter.updatePriority(t.eventCache.getNode(),i),l=R_(t,c,a.isFullyInitialized(),a.isFiltered());else{const s=um(n),c=a.getNode().getImmediateChild(r);let h;if(gm(s))h=i;else{const e=u.getCompleteChild(r);h=null!=e?".priority"===hm(s)&&e.getChild(fm(s)).isEmpty()?e:e.updateChild(s,i):Xm.EMPTY_NODE}l=c.equals(h)?t:R_(t,e.filter.updateChild(a.getNode(),r,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return l}function hy(e,t){return e.eventCache.isCompleteForChild(t)}function dy(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function fy(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=gm(n)?i:new L_(null).setTree(n,i);const u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){const l=dy(0,t.serverCache.getNode().getImmediateChild(n),i);c=cy(e,c,new om(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{const l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){const l=dy(0,t.serverCache.getNode().getImmediateChild(n),i);c=cy(e,c,new om(n),l,r,s,o,a)}}),c}class py{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new o_(n.getIndex()),r=(s=n).loadsAllData()?new o_(s.getIndex()):s.hasLimit()?new l_(s):new a_(s);var s;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,l=i.updateFullNode(Xm.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(Xm.EMPTY_NODE,a.getNode(),null),u=new S_(l,o.isFullyInitialized(),i.filtersNodes()),h=new S_(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=A_(h,u),this.eventGenerator_=new k_(this.query_)}get query(){return this.query_}}function gy(e,t){const n=O_(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!gm(t)&&!n.getImmediateChild(lm(t)).isEmpty())?n.getChild(t):null}function my(e){return 0===e.eventRegistrations_.length}function _y(e,t,n){const i=[];if(n){g(null==t,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function yy(e,t,n,i){t.type===v_.MERGE&&null!==t.source.queryId&&(g(O_(e.viewCache_),"We should always have a full cache before handling merges"),g(D_(e.viewCache_),"Missing event cache, even though we have a server cache"));const r=e.viewCache_,s=function(e,t,n,i,r){const s=new sy;let o,a;if(n.type===v_.OVERWRITE){const l=n;l.source.fromUser?o=uy(e,t,l.path,l.snap,i,r,s):(g(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!gm(l.path),o=cy(e,t,l.path,l.snap,i,r,a,s))}else if(n.type===v_.MERGE){const l=n;l.source.fromUser?o=function(e,t,n,i,r,s,o){let a=t;return i.foreach((i,l)=>{const c=pm(n,i);hy(t,lm(c))&&(a=uy(e,a,c,l,r,s,o))}),i.foreach((i,l)=>{const c=pm(n,i);hy(t,lm(c))||(a=uy(e,a,c,l,r,s,o))}),a}(e,t,l.path,l.children,i,r,s):(g(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=fy(e,t,l.path,l.children,i,r,a,s))}else if(n.type===v_.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,i,r,s){let o;if(null!=ty(i,n))return t;{const a=new ay(i,t,r),l=t.eventCache.getNode();let c;if(gm(n)||".priority"===lm(n)){let n;if(t.serverCache.isFullyInitialized())n=J_(i,O_(t));else{const e=t.serverCache.getNode();g(e instanceof Xm,"serverChildren would be complete if leaf node"),n=Z_(i,e)}c=e.filter.updateFullNode(l,n,s)}else{const r=lm(n);let u=ny(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=l.getImmediateChild(r)),c=null!=u?e.filter.updateChild(l,r,u,um(n),a,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(l,r,Xm.EMPTY_NODE,um(n),a,s):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=J_(i,O_(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=ty(i,am()),R_(t,c,o,e.filter.filtersNodes())}}(e,t,a.path,i,r,s):function(e,t,n,i,r,s,o){if(null!=ty(r,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value){if(gm(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return cy(e,t,n,l.getNode().getChild(n),r,s,a,o);if(gm(n)){let i=new L_(null);return l.getNode().forEachChild(Rm,(e,t)=>{i=i.set(new om(e),t)}),fy(e,t,n,i,r,s,a,o)}return t}{let c=new L_(null);return i.foreach((e,t)=>{const i=pm(n,e);l.isCompleteForPath(i)&&(c=c.set(e,l.getNode().getChild(i)))}),fy(e,t,n,c,r,s,a,o)}}(e,t,a.path,a.affectedTree,i,r,s)}else{if(n.type!==v_.LISTEN_COMPLETE)throw m("Unknown operation type: "+n.type);o=function(e,t,n,i,r){const s=t.serverCache;return ly(e,P_(t,s.getNode(),s.isFullyInitialized()||gm(n),s.isFiltered()),n,i,oy,r)}(e,t,n.path,i,s)}const l=s.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=D_(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(n_(D_(t)))}}(t,o,l),{viewCache:o,changes:l}}(e.processor_,r,t,n,i);var o,a;return o=e.processor_,a=s.viewCache,g(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),g(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),g(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,vy(e,s.changes,s.viewCache.eventCache.getNode(),null)}function vy(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach(t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}),N_(e,r,"child_removed",t,i,n),N_(e,r,"child_added",t,i,n),N_(e,r,"child_moved",s,i,n),N_(e,r,"child_changed",t,i,n),N_(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let wy,Ty;class Iy{constructor(){this.views=new Map}}function Ey(e,t,n,i){const r=t.source.queryId;if(null!==r){const s=e.views.get(r);return g(null!=s,"SyncTree gave us an op for an invalid query."),yy(s,t,n,i)}{let r=[];for(const s of e.views.values())r=r.concat(yy(s,t,n,i));return r}}function by(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Cy(e,t){let n=null;for(const i of e.views.values())n=n||gy(i,t);return n}function Sy(e,t){if(t._queryParams.loadsAllData())return Ay(e);{const n=t._queryIdentifier;return e.views.get(n)}}function ky(e,t){return null!=Sy(e,t)}function Ny(e){return null!=Ay(e)}function Ay(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Ry=1;class Py{constructor(e){this.listenProvider_=e,this.syncPointTree_=new L_(null),this.pendingWriteTree_={visibleWrites:M_.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Dy(e,t,n,i,r){return function(e,t,n,i,r){g(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:r}),r&&(e.visibleWrites=U_(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,r),r?Fy(e,new b_({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Oy(e,t,n=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);g(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let r=i.visible,s=!1,o=e.allWrites.length-1;for(;r&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&G_(t,i.path)?r=!1:vm(i.path,t.path)&&(s=!0)),o--}return!!r&&(s?(function(e){e.visibleWrites=Y_(e.allWrites,Q_,am()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(i.snap?e.visibleWrites=V_(e.visibleWrites,i.path):Rg(i.children,t=>{e.visibleWrites=V_(e.visibleWrites,pm(i.path,t))}),!0))}(e.pendingWriteTree_,t)){let t=new L_(null);return null!=i.snap?t=t.set(am(),!0):Rg(i.children,e=>{t=t.set(new om(e),!0)}),Fy(e,new I_(i.path,t,n))}return[]}function xy(e,t,n){return Fy(e,new b_({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Ly(e,t,n,i,r=!1){const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||ky(o,t))){const l=function(e,t,n,i){const r=t._queryIdentifier,s=[];let o=[];const a=Ny(e);if("default"===r)for(const[l,c]of e.views.entries())o=o.concat(_y(c,n,i)),my(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const t=e.views.get(r);t&&(o=o.concat(_y(t,n,i)),my(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!Ny(e)&&s.push(new(g(wy,"Reference.ts has not been loaded"),wy)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!r){const n=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>Ny(t));if(n&&!r){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold((e,t,n)=>{if(t&&Ny(t))return[Ay(t)];{let e=[];return t&&(e=by(t)),Rg(n,(t,n)=>{e=e.concat(n)}),e}})}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,s=jy(e,i);e.listenProvider_.startListening(Ky(r),By(e,r),s.hashFn,s.onComplete)}}}if(!r&&c.length>0&&!i)if(n){const n=null;e.listenProvider_.stopListening(Ky(t),n)}else c.forEach(t=>{const n=e.queryToTagMap.get(zy(t));e.listenProvider_.stopListening(Ky(t),n)})}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=zy(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,c)}return a}function My(e,t,n,i=!1){const r=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(r,(e,t)=>{const n=mm(e,r);s=s||Cy(t,n),o=o||Ny(t)});let a,l=e.syncPointTree_.get(r);l?(o=o||Ny(l),s=s||Cy(l,am())):(l=new Iy,e.syncPointTree_=e.syncPointTree_.set(r,l)),null!=s?a=!0:(a=!1,s=Xm.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild((e,t)=>{const n=Cy(t,am());n&&(s=s.updateImmediateChild(e,n))}));const c=ky(l,t);if(!c&&!t._queryParams.loadsAllData()){const n=zy(t);g(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=Ry++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let u=function(e,t,n,i,r,s){const o=function(e,t,n,i,r){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=J_(n,r?i:null),s=!1;e?s=!0:i instanceof Xm?(e=Z_(n,i),s=!1):(e=Xm.EMPTY_NODE,s=!1);const o=A_(new S_(e,s,!1),new S_(i,r,!1));return new py(t,o)}return o}(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(zm,(e,t)=>{i.push(i_(e,t))}),n.isFullyInitialized()&&i.push(n_(n.getNode())),vy(e,i,n.getNode(),t)}(o,n)}(l,t,n,K_(e.pendingWriteTree_,r),s,a);if(!c&&!o&&!i){const n=Sy(l,t);u=u.concat(function(e,t,n){const i=t._path,r=By(e,t),s=jy(e,n),o=e.listenProvider_.startListening(Ky(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)g(!Ny(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold((e,t,n)=>{if(!gm(e)&&t&&Ny(t))return[Ay(t).query];{let e=[];return t&&(e=e.concat(by(t).map(e=>e.query))),Rg(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(Ky(i),By(e,i))}}return o}(e,t,n))}return u}function Uy(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{const i=Cy(n,mm(e,t));if(i)return i});return X_(i,t,r,n,!0)}function Fy(e,t){return Vy(t,e.syncPointTree_,null,K_(e.pendingWriteTree_,am()))}function Vy(e,t,n,i){if(gm(e.path))return qy(e,t,n,i);{const r=t.get(am());null==n&&null!=r&&(n=Cy(r,am()));let s=[];const o=lm(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=iy(i,o);s=s.concat(Vy(a,l,e,t))}return r&&(s=s.concat(Ey(r,e,i,n))),s}}function qy(e,t,n,i){const r=t.get(am());null==n&&null!=r&&(n=Cy(r,am()));let s=[];return t.children.inorderTraversal((t,r)=>{const o=n?n.getImmediateChild(t):null,a=iy(i,t),l=e.operationForChild(t);l&&(s=s.concat(qy(l,r,o,a)))}),r&&(s=s.concat(Ey(r,e,i,n))),s}function jy(e,t){const n=t.query,i=By(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Xm.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=$y(e,n);if(i){const n=Hy(i),r=n.path,s=n.queryId,o=mm(r,t);return Wy(e,r,new E_(T_(s),o))}return[]}(e,n._path,i):function(e,t){return Fy(e,new E_({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Ly(e,n,null,i)}}}}function By(e,t){const n=zy(t);return e.queryToTagMap.get(n)}function zy(e){return e._path.toString()+"$"+e._queryIdentifier}function $y(e,t){return e.tagToQueryMap.get(t)}function Hy(e){const t=e.indexOf("$");return g(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new om(e.substr(0,t))}}function Wy(e,t,n){const i=e.syncPointTree_.get(t);return g(i,"Missing sync point for query tag that we're tracking"),Ey(i,n,K_(e.pendingWriteTree_,t),null)}function Ky(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(g(Ty,"Reference.ts has not been loaded"),Ty)(e._repo,e._path):e}class Gy{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Gy(t)}node(){return this.node_}}class Qy{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=pm(this.path_,e);return new Qy(this.syncTree_,t)}node(){return Uy(this.syncTree_,this.path_)}}const Yy=function(e,t,n){return e&&"object"==typeof e?(g(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Xy(e[".sv"],t,n):"object"==typeof e[".sv"]?Jy(e[".sv"],t):void g(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Xy=function(e,t,n){if("timestamp"===e)return n.timestamp;g(!1,"Unexpected server value: "+e)},Jy=function(e,t,n){e.hasOwnProperty("increment")||g(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!=typeof i&&g(!1,"Unexpected increment value: "+i);const r=t.node();if(g(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const s=r.getValue();return"number"!=typeof s?i:s+i},Zy=function(e,t,n,i){return tv(t,new Qy(n,e),i)},ev=function(e,t,n){return tv(e,new Gy(t),n)};function tv(e,t,n){const i=e.getPriority().val(),r=Yy(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=Yy(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new Bm(s,Zm(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new Bm(r))),i.forEachChild(zm,(e,i)=>{const r=tv(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))}),s}}class nv{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function iv(e,t){let n=t instanceof om?t:new om(t),i=e,r=lm(n);for(;null!==r;){const e=J(i.node.children,r)||{children:{},childCount:0};i=new nv(r,i,e),n=um(n),r=lm(n)}return i}function rv(e){return e.node.value}function sv(e,t){e.node.value=t,uv(e)}function ov(e){return e.node.childCount>0}function av(e,t){Rg(e.node.children,(n,i)=>{t(new nv(n,e,i))})}function lv(e,t,n,i){n&&t(e),av(e,e=>{lv(e,t,!0)})}function cv(e){return new om(null===e.parent?e.name:cv(e.parent)+"/"+e.name)}function uv(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===rv(e)&&!ov(e)}(n),r=X(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,uv(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,uv(e))}(e.parent,e.name,e)}const hv=/[\[\].#$\/\u0000-\u001F\u007F]/,dv=/[\[\].#$\u0000-\u001F\u007F]/,fv=10485760,pv=function(e){return"string"==typeof e&&0!==e.length&&!hv.test(e)},gv=function(e){return"string"==typeof e&&0!==e.length&&!dv.test(e)},mv=function(e,t,n,i){i&&void 0===t||_v(ce(e,"value"),t,n)},_v=function(e,t,n){const i=n instanceof om?new wm(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Im(i));if("function"==typeof t)throw new Error(e+"contains a function "+Im(i)+" with contents = "+t.toString());if(Ig(t))throw new Error(e+"contains "+t.toString()+" "+Im(i));if("string"==typeof t&&t.length>fv/3&&ue(t)>fv)throw new Error(e+"contains a string greater than "+fv+" utf8 bytes "+Im(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(Rg(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!pv(t)))throw new Error(e+" contains an invalid key ("+t+") "+Im(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,a;a=t,(o=i).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(a),o.byteLength_+=ue(a),Tm(o),_v(e,s,i),function(e){const t=e.parts_.pop();e.byteLength_-=ue(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)}),n&&r)throw new Error(e+' contains ".value" child '+Im(i)+" in addition to actual children.")}},yv=function(e,t,n,i){if(!gv(n))throw new Error(ce(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},vv=function(e,t){if(".info"===lm(t))throw new Error(e+" failed = Can't modify data under /.info/")};class wv{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Tv(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||ym(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function Iv(e,t,n){Tv(e,n),bv(e,e=>ym(e,t))}function Ev(e,t,n){Tv(e,n),bv(e,e=>vm(e,t)||vm(t,e))}function bv(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];r&&(t(r.path)?(Cv(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function Cv(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();gg&&_g("event: "+n.toString()),xg(i)}}}class Sv{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new wv,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=p_(),this.transactionQueueTree_=new nv,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function kv(e,t,n){if(e.stats_=Gg(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new d_(e.repoInfo_,(t,n,i,r)=>{Rv(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>Pv(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Q(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}e.persistentConnection_=new Cm(e.repoInfo_,t,(t,n,i,r)=>{Rv(e,t,n,i,r)},t=>{Pv(e,t)},t=>{!function(e,t){Rg(t,(t,n)=>{Dv(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(t){const n=t.toString();return Kg[n]||(Kg[n]=new y_(e.stats_,e.server_)),Kg[n]}(e.repoInfo_),e.infoData_=new f_,e.infoSyncTree_=new Py({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=xy(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),Dv(e,"connected",!1),e.serverSyncTree_=new Py({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{const s=r(n,i);Ev(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Nv(e){const t=e.infoData_.getNode(new om(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Av(e){return(t=(t={timestamp:Nv(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function Rv(e,t,n,i,r){e.dataUpdateCount++;const s=new om(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){const t=ee(n,e=>Zm(e));o=function(e,t,n,i){const r=$y(e,i);if(r){const i=Hy(r),s=i.path,o=i.queryId,a=mm(s,t),l=L_.fromObject(n);return Wy(e,s,new C_(T_(o),a,l))}return[]}(e.serverSyncTree_,s,t,r)}else{const t=Zm(n);o=function(e,t,n,i){const r=$y(e,i);if(null!=r){const i=Hy(r),s=i.path,o=i.queryId,a=mm(s,t);return Wy(e,s,new b_(T_(o),a,n))}return[]}(e.serverSyncTree_,s,t,r)}else if(i){const t=ee(n,e=>Zm(e));o=function(e,t,n){const i=L_.fromObject(n);return Fy(e,new C_({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,s,t)}else{const t=Zm(n);o=xy(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=Fv(e,s)),Ev(e.eventQueue_,a,o)}function Pv(e,t){Dv(e,"connected",t),!1===t&&function(e){xv(e,"onDisconnectEvents");const t=Av(e),n=p_();m_(e.onDisconnect_,am(),(i,r)=>{const s=Zy(i,r,e.serverSyncTree_,t);g_(n,i,s)});let i=[];m_(n,am(),(t,n)=>{i=i.concat(xy(e.serverSyncTree_,t,n));const r=zv(e,t);Fv(e,r)}),e.onDisconnect_=p_(),Ev(e.eventQueue_,am(),i)}(e)}function Dv(e,t,n){const i=new om("/.info/"+t),r=Zm(n);e.infoData_.updateSnapshot(i,r);const s=xy(e.infoSyncTree_,i,r);Ev(e.eventQueue_,i,s)}function Ov(e){return e.nextWriteId_++}function xv(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),_g(n,...t)}function Lv(e,t,n,i){t&&xg(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const s=new Error(r);s.code=e,t(s)}})}function Mv(e,t,n){return Uy(e.serverSyncTree_,t,n)||Xm.EMPTY_NODE}function Uv(e,t=e.transactionQueueTree_){if(t||Bv(e,t),rv(t)){const n=qv(e,t);g(n.length>0,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(e,t,n){const i=n.map(e=>e.currentWriteId),r=Mv(e,t,i);let s=r;const o=r.hash();for(let c=0;c<n.length;c++){const e=n[c];g(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const i=mm(t,e.path);s=s.updateChild(i,e.currentOutputSnapshotRaw)}const a=s.val(!0),l=t;e.server_.put(l.toString(),a,i=>{xv(e,"transaction put response",{path:l.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(Oy(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();Bv(e,iv(e.transactionQueueTree_,t)),Uv(e,e.transactionQueueTree_),Ev(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)xg(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{Tg("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}Fv(e,t)}},o)}(e,cv(t),n)}else ov(t)&&av(t,t=>{Uv(e,t)})}function Fv(e,t){const n=Vv(e,t),i=cv(n);return function(e,t,n){if(0===t.length)return;const i=[];let r=[];const s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){const a=t[o],l=mm(n,a.path);let c,u=!1;if(g(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)u=!0,c=a.abortReason,r=r.concat(Oy(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)u=!0,c="maxretry",r=r.concat(Oy(e.serverSyncTree_,a.currentWriteId,!0));else{const n=Mv(e,a.path,s);a.currentInputSnapshot=n;const i=t[o].update(n.val());if(void 0!==i){_v("transaction failed: Data returned ",i,a.path);let t=Zm(i);"object"==typeof i&&null!=i&&X(i,".priority")||(t=t.updatePriority(n.getPriority()));const o=a.currentWriteId,l=Av(e),c=ev(t,n,l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=c,a.currentWriteId=Ov(e),s.splice(s.indexOf(o),1),r=r.concat(Dy(e.serverSyncTree_,a.path,c,a.currentWriteId,a.applyLocally)),r=r.concat(Oy(e.serverSyncTree_,o,!0))}else u=!0,c="nodata",r=r.concat(Oy(e.serverSyncTree_,a.currentWriteId,!0))}Ev(e.eventQueue_,n,r),r=[],u&&(t[o].status=2,function(e){setTimeout(e,Math.floor(0))}(t[o].unwatcher),t[o].onComplete&&("nodata"===c?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(new Error(c),!1,null))))}Bv(e,e.transactionQueueTree_);for(let o=0;o<i.length;o++)xg(i[o]);Uv(e,e.transactionQueueTree_)}(e,qv(e,n),i),i}function Vv(e,t){let n,i=e.transactionQueueTree_;for(n=lm(t);null!==n&&void 0===rv(i);)i=iv(i,n),n=lm(t=um(t));return i}function qv(e,t){const n=[];return jv(e,t,n),n.sort((e,t)=>e.order-t.order),n}function jv(e,t,n){const i=rv(t);if(i)for(let r=0;r<i.length;r++)n.push(i[r]);av(t,t=>{jv(e,t,n)})}function Bv(e,t){const n=rv(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,sv(t,n.length>0?n:void 0)}av(t,t=>{Bv(e,t)})}function zv(e,t){const n=cv(Vv(e,t)),i=iv(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(i,t=>{$v(e,t)}),$v(e,i),lv(i,t=>{$v(e,t)}),n}function $v(e,t){const n=rv(t);if(n){const i=[];let r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(g(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(g(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(Oy(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?sv(t,void 0):n.length=s+1,Ev(e.eventQueue_,cv(t),r);for(let e=0;e<i.length;e++)xg(i[e])}}const Hv=function(e,t){const n=Wv(e),i=n.namespace;"firebase.com"===n.domain&&wg(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||wg("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Tg("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new zg(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new om(n.pathString)}},Wv=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(r=function(e){let t="";const n=e.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(i){}t+="/"+e}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Tg(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const f=t.slice(0,c);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},Kv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Gv=function(){let e=0;const t=[];return function(n){const i=n===e;let r;e=n;const s=new Array(8);for(r=7;r>=0;r--)s[r]=Kv.charAt(n%64),n=Math.floor(n/64);g(0===n,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&63===t[r];r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)o+=Kv.charAt(t[r]);return g(20===o.length,"nextPushId: Length should be 20."),o}}();class Qv{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Q(this.snapshot.exportVal())}}class Yv{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Xv{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return g(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Jv{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return gm(this._path)?null:hm(this._path)}get ref(){return new Zv(this._repo,this._path)}get _queryIdentifier(){const e=h_(this._queryParams),t=Ng(e);return"{}"===t?"default":t}get _queryObject(){return h_(this._queryParams)}isEqual(e){if(!((e=de(e))instanceof Jv))return!1;const t=this._repo===e._repo,n=ym(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Zv extends Jv{constructor(e,t){super(e,t,new c_,!1)}get parent(){const e=fm(this._path);return null===e?null:new Zv(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ew{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new om(e),n=nw(this.ref,e);return new ew(this._node.getChild(t),n,zm)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new ew(n,nw(this.ref,t),zm)))}hasChild(e){const t=new om(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function tw(e,t){return(e=de(e))._checkNotDeleted("ref"),void 0!==t?nw(e._root,t):e._root}function nw(e,t){var n;return null===lm((e=de(e))._path)?((n=t)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),yv("child","path",n)):yv("child","path",t),new Zv(e._repo,pm(e._path,t))}function iw(e,t){e=de(e),vv("push",e._path),mv("push",t,e._path,!0);const n=Nv(e._repo),i=Gv(n),r=nw(e,i),s=nw(e,i);let o;return o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function rw(e,t){e=de(e),vv("set",e._path),mv("set",t,e._path,!1);const n=new P;return function(e,t,n,i,r){xv(e,"set",{path:t.toString(),value:n,priority:null});const s=Av(e),o=Zm(n,null),a=Uy(e.serverSyncTree_,t),l=ev(o,a,s),c=Ov(e),u=Dy(e.serverSyncTree_,t,l,c,!0);Tv(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,i)=>{const s="ok"===n;s||Tg("set at "+t+" failed: "+n);const o=Oy(e.serverSyncTree_,c,!s);Ev(e.eventQueue_,t,o),Lv(0,r,n,i)});const h=zv(e,t);Fv(e,h),Ev(e.eventQueue_,h,[])}(e._repo,e._path,t,0,n.wrapCallback(()=>{})),n.promise}function sw(e,t){!function(e,t,n){const i=ce(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const r=[];Rg(t,(e,t)=>{const s=new om(e);if(_v(i,t,pm(n,s)),".priority"===hm(s)&&!(null===(o=t)||"string"==typeof o||"number"==typeof o&&!Ig(o)||o&&"object"==typeof o&&X(o,".sv")))throw new Error(i+"contains an invalid value for '"+s.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");var o;r.push(s)}),function(e,t){let n,i;for(n=0;n<t.length;n++){i=t[n];const r=dm(i);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!pv(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(_m);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&vm(r,i))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}}(i,r)}("update",t,e._path);const n=new P;return function(e,t,n,i){xv(e,"update",{path:t.toString(),value:n});let r=!0;const s=Av(e),o={};if(Rg(n,(n,i)=>{r=!1,o[n]=Zy(pm(t,n),Zm(i),e.serverSyncTree_,s)}),r)_g("update() called with empty data.  Don't do anything."),Lv(0,i,"ok",void 0);else{const r=Ov(e),s=function(e,t,n,i){!function(e,t,n,i){g(i>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:i,visible:!0}),e.visibleWrites=F_(e.visibleWrites,t,n),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i);const r=L_.fromObject(n);return Fy(e,new C_({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,t,o,r);Tv(e.eventQueue_,s),e.server_.merge(t.toString(),n,(n,s)=>{const o="ok"===n;o||Tg("update at "+t+" failed: "+n);const a=Oy(e.serverSyncTree_,r,!o),l=a.length>0?Fv(e,t):t;Ev(e.eventQueue_,l,a),Lv(0,i,n,s)}),Rg(n,n=>{const i=zv(e,pm(t,n));Fv(e,i)}),Ev(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}class ow{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Qv("value",this,new ew(e.snapshotNode,new Zv(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Yv(this,e,t):null}matches(e){return e instanceof ow&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}function aw(e,t,n,i){return function(e,t,n){const i=new Xv(n,void 0),r=new ow(i);return function(e,t,n){let i;i=".info"===lm(t._path)?My(e.infoSyncTree_,t,n):My(e.serverSyncTree_,t,n),Iv(e.eventQueue_,t._path,i)}(e._repo,e,r),()=>function(e,t,n){let i;i=".info"===lm(t._path)?Ly(e.infoSyncTree_,t,n):Ly(e.serverSyncTree_,t,n),Iv(e.eventQueue_,t._path,i)}(e._repo,e,r)}(e,0,t)}var lw;lw=Zv,g(!wy,"__referenceConstructor has already been defined"),wy=lw,function(e){g(!Ty,"__referenceConstructor has already been defined"),Ty=e}(Zv);const cw={};function uw(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||wg("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),_g("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a=Hv(s,r),l=a.repoInfo;"undefined"!=typeof process&&ng&&(o=ng.FIREBASE_DATABASE_EMULATOR_HOST),o?(s=`http://${o}?ns=${l.namespace}`,a=Hv(s,r),l=a.repoInfo):a.repoInfo.secure;const c=new Ug(e.name,e.options,t);(function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!pv(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),gv(e)}(n))throw new Error(ce(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",a),gm(a.path)||wg("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let r=cw[t.name];r||(r={},cw[t.name]=r);let s=r[e.toURLString()];return s&&wg("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Sv(e,false,n,i),r[e.toURLString()]=s,s}(l,e,c,new Mg(e,n));return new hw(u,e)}class hw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(kv(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Zv(this._repo,am())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=cw[t];n&&n[e.key]===e||wg(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&wg("Cannot call "+e+" on a deleted database.")}}function dw(e=At(),t){const n=Et(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=N("database");e&&function(e,t,n,i={}){(e=de(e))._checkNotDeleted("useEmulator");const r=`${t}:${n}`,s=e._repoInternal;if(e._instanceStarted){if(r===e._repoInternal.repoInfo_.host&&te(i,s.repoInfo_.emulatorOptions))return;wg("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&wg('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Fg(Fg.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:x(i.mockUserToken,e.app.options.projectId);o=new Fg(t)}D(t)&&(O(t),U("Database",!0)),function(e,t,n,i){const r=t.lastIndexOf(":"),s=D(t.substring(0,r));e.repoInfo_=new zg(t,s,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(e.authTokenProvider_=i)}(s,r,i,o)}(n,...e)}return n}Cm.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Cm.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},sg=kt,It(new fe("database",(e,{instanceIdentifier:t})=>uw(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),Rt(ig,rg,void 0),Rt(ig,rg,"esm2020");const fw="functions";class pw{constructor(e,t,n,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,bt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||n.get().then(e=>this.messaging=e,()=>{}),this.appCheck||null==i||i.get().then(e=>this.appCheck=e,()=>{})}getAuthToken(){return f(this,null,function*(){if(this.auth)try{const e=yield this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}})}getMessagingToken(){return f(this,null,function*(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return yield this.messaging.getToken()}catch(e){return}})}getAppCheckToken(e){return f(this,null,function*(){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?yield this.appCheck.getLimitedUseToken():yield this.appCheck.getToken();return t.error?null:t.token}return null})}getContext(e){return f(this,null,function*(){return{authToken:yield this.getAuthToken(),messagingToken:yield this.getMessagingToken(),appCheckToken:yield this.getAppCheckToken(e)}})}}const gw="us-central1";class mw{constructor(e,t,n,i,r=gw,s=(...e)=>fetch(...e)){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new pw(e,t,n,i),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(r);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=gw}catch(o){this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}const _w="@firebase/functions",yw="0.13.0";function vw(e=At(),t=gw){const n=Et(de(e),fw).getImmediate({identifier:t}),i=N("functions");return i&&function(e,t,n){!function(e,t,n){const i=D(t);e.emulatorOrigin=`http${i?"s":""}://${t}:${n}`,i&&(O(e.emulatorOrigin),U("Functions",!0))}(de(e),t,n)}(n,...i),n}It(new fe(fw,(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new mw(n,i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),Rt(_w,yw,void 0),Rt(_w,yw,"esm2020");export{eg as $,pr as A,Fi as B,fe as C,Pi as D,W as E,H as F,Ti as G,zf as H,Mi as I,Vi as J,tw as K,Ee as L,aw as M,wf as N,Cf as O,If as P,Dd as Q,Hf as R,kf as S,Ei as T,rw as U,sw as V,iw as W,Gf as X,Af as Y,jf as Z,It as _,Et as a,Zp as a0,$f as a1,Qf as a2,Xp as a3,Jp as a4,B as b,he as c,At as d,te as e,$ as f,de as g,_e as h,q as i,Nt as j,Hr as k,Vd as l,tg as m,dw as n,vw as o,wi as p,Ui as q,Rt as r,Vf as s,Od as t,Di as u,z as v,xi as w,Li as x,Bf as y,Oi as z};
